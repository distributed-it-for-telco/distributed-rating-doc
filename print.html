<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Distributed Rating Engine with wasmCloud</title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="./mdbook-admonish.css">

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "light" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="about.html">About</a></li><li class="chapter-item expanded affix "><li class="part-title">Concepts</li><li class="chapter-item expanded "><a href="CONCEPTS/concepts.html"><strong aria-hidden="true">1.</strong> Concepts</a></li><li class="chapter-item expanded affix "><li class="part-title">Architecture</li><li class="chapter-item expanded "><a href="ARCHITECTURE/architecture.html"><strong aria-hidden="true">2.</strong> Software Architecture</a></li><li class="chapter-item expanded "><a href="ARCHITECTURE/functional-specification.html"><strong aria-hidden="true">3.</strong> Functional Specification</a></li><li class="chapter-item expanded affix "><li class="part-title">Use Cases</li><li class="chapter-item expanded "><a href="USE-CASES/UC-01/index.html"><strong aria-hidden="true">4.</strong> UC-01: Customer product inventory</a></li><li class="chapter-item expanded "><a href="USE-CASES/UC-02/index.html"><strong aria-hidden="true">5.</strong> UC-02: Rate usage - Overview</a></li><li class="chapter-item expanded "><a href="USE-CASES/UC-03/index.html"><strong aria-hidden="true">6.</strong> UC-03: Rate usage - Regular</a></li><li class="chapter-item expanded "><a href="USE-CASES/UC-04/index.html"><strong aria-hidden="true">7.</strong> UC-04: Rate usage - Threshold</a></li><li class="chapter-item expanded "><a href="USE-CASES/UC-05/index.html"><strong aria-hidden="true">8.</strong> UC-05: Rate usage - Bundle</a></li><li class="chapter-item expanded "><a href="USE-CASES/UC-06/index.html"><strong aria-hidden="true">9.</strong> UC-06: CQRS - Usage Proof</a></li><li class="chapter-item expanded "><a href="USE-CASES/UC-07/index.html"><strong aria-hidden="true">10.</strong> UC-07: Rate usage - MetaVerse</a></li><li class="chapter-item expanded affix "><li class="part-title">Architecture decision records</li><li class="chapter-item expanded "><a href="ADR/ard001-monorepo_code_organization.html"><strong aria-hidden="true">11.</strong> Monorepo code organization</a></li><li class="chapter-item expanded affix "><li class="part-title">How-to</li><li class="chapter-item expanded "><a href="HOW-TO/kickstart.html"><strong aria-hidden="true">12.</strong> WasmCloud Kickstart</a></li><li class="chapter-item expanded "><a href="HOW-TO/smithy-notes.html"><strong aria-hidden="true">13.</strong> Smithy</a></li><li class="chapter-item expanded affix "><li class="part-title">Handbook</li><li class="chapter-item expanded "><a href="HANDBOOK/kv-store-management.html"><strong aria-hidden="true">14.</strong> Key-Value store management</a></li><li class="chapter-item expanded "><a href="HANDBOOK/link-management.html"><strong aria-hidden="true">15.</strong> Link management</a></li><li class="chapter-item expanded "><a href="HANDBOOK/shutdown-host.html"><strong aria-hidden="true">16.</strong> Shutdown host</a></li><li class="chapter-item expanded affix "><li class="part-title">Archives</li><li class="chapter-item expanded "><a href="ARCHIVE/rationale.html"><strong aria-hidden="true">17.</strong> Rationale</a></li><li class="chapter-item expanded "><a href="ARCHIVE/requirements.html"><strong aria-hidden="true">18.</strong> Requirements</a></li><li class="chapter-item expanded "><a href="ARCHIVE/model.html"><strong aria-hidden="true">19.</strong> Model</a></li><li class="chapter-item expanded "><a href="ARCHIVE/model-solution1.html"><strong aria-hidden="true">20.</strong> Solution 1</a></li><li class="chapter-item expanded "><a href="ARCHIVE/about-wasmcloud.html"><strong aria-hidden="true">21.</strong> About wasmCloud</a></li><li class="chapter-item expanded "><a href="ARCHIVE/architecture.html"><strong aria-hidden="true">22.</strong> wasmCloud Architecture</a></li><li class="chapter-item expanded "><a href="ARCHIVE/prototype-architecture.html"><strong aria-hidden="true">23.</strong> Prototype Architecture</a></li><li class="chapter-item expanded "><a href="ARCHIVE/technical-requirements.html"><strong aria-hidden="true">24.</strong> Technical requirements</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Distributed Rating Engine with wasmCloud</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/distributed-it-for-telco" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="about-the-distributed-rating-project"><a class="header" href="#about-the-distributed-rating-project">About the distributed-rating project</a></h1>
<p>This project aims to explore the use of distributed architecture in various processes in the teleco industry, starting with the rating and charging process.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="concepts"><a class="header" href="#concepts">Concepts</a></h1>
<h2 id="third-party-management"><a class="header" href="#third-party-management">third party management</a></h2>
<ul>
<li>definitions
<ul>
<li>service vendor: customer-facing tier, manages the customer subscription, billing and payments</li>
<li>service provider: provides a technical service, also acts as a service vendor in B2B2X scenarios</li>
</ul>
</li>
</ul>
<h3 id="basic-case-the-service-vendor-is-the-service-provider"><a class="header" href="#basic-case-the-service-vendor-is-the-service-provider">basic case: the service vendor is the service provider</a></h3>
<ul>
<li>
<p>key ideas</p>
<ul>
<li>usage rating is done client-side via a <strong>rating agent</strong> deployed inside the service client app</li>
<li>a rating agent also acts as an authorization for consuming the service</li>
<li>a rating agents is the implementation of a commercial offer subscibed by the customer, it is managed like a contract</li>
</ul>
</li>
<li>
<p>communication diagram</p>
<p><img src="CONCEPTS/./sequence-3rdparty-basic.drawio.svg" alt="" /></p>
</li>
</ul>
<h3 id="complex-case-service-vendor-and-service-provider"><a class="header" href="#complex-case-service-vendor-and-service-provider">complex case: service vendor and service provider</a></h3>
<ul>
<li>
<p>key ideas</p>
<ul>
<li>the service vendor subscribes to a service provider (exactly like an end-user customer)</li>
<li>the users rating agent is a composite of service vendor and service provider rating agents</li>
<li>the service provider's rating agent is used as the authorization for consuming the service</li>
<li>end-user usage is uploaded to both service vendor and service provider</li>
</ul>
</li>
<li>
<p>communication diagram: service subscription</p>
<p><img src="CONCEPTS/./sequence-3rdparty-complex-subscription.drawio.svg" alt="" /></p>
</li>
<li>
<p>communication diagram: service usage</p>
<p><img src="CONCEPTS/./sequence-3rdparty-complex-usage.drawio.svg" alt="" /></p>
</li>
</ul>
<blockquote>
<p>and what about provisionning?</p>
</blockquote>
<h2 id="counting-and-rating"><a class="header" href="#counting-and-rating">counting and rating</a></h2>
<ul>
<li>
<p>a rating agent is a program specific a service / a commercial offer / a payment mode</p>
</li>
<li>
<p>its implementation will depend on the use cases</p>
<p><img src="CONCEPTS/./contract-agent.drawio.svg" alt="" /></p>
</li>
</ul>
<h3 id="post-paid"><a class="header" href="#post-paid">post-paid</a></h3>
<p>rating agent will</p>
<ul>
<li>authorize the customer to consume the service</li>
<li>generate <strong>rated proofs of service usage</strong> that will be aggregated on the customer bill (maintained by the service vendor)</li>
</ul>
<h3 id="prepaid--bucket-management"><a class="header" href="#prepaid--bucket-management">prepaid / bucket management</a></h3>
<p>rating agent will</p>
<ul>
<li>manage a <strong>stateful service bucket</strong> and consume it according to customer usage</li>
<li>report on the consuption of the service bucket</li>
<li>authorize the customer to consume the service</li>
<li>generates rated proofs of service usage, used for auditing / fraud detection</li>
</ul>
<h3 id="µ-payments"><a class="header" href="#µ-payments">µ-payments</a></h3>
<p>rating agent will</p>
<ul>
<li>trigger payment request and expect payment proof before allowing the usage of the service</li>
<li>authorize the customer to consume the service</li>
<li>generates rated proofs of service usage, used for auditing / fraud detection</li>
</ul>
<h2 id="agent-mandatory-traits"><a class="header" href="#agent-mandatory-traits">agent mandatory traits</a></h2>
<ul>
<li>authorizer trait: <code>authorize(identity) -&gt; key</code></li>
<li>rater trait: <code>rate(usage) -&gt; void</code></li>
</ul>
<h3 id="basic-case"><a class="header" href="#basic-case">basic case</a></h3>
<p><img src="CONCEPTS/./contract-agent-detailed.drawio.svg" alt="" /></p>
<h3 id="composite-case"><a class="header" href="#composite-case">composite case</a></h3>
<p><img src="CONCEPTS/./contract-agent-detailed-composite.drawio.svg" alt="" /></p>
<ul>
<li>note that there is "shortcut" in <code>3. get vendor identity</code>. It does not really return an identity but a "vendor service subscription" authorization token. Check next paragraph</li>
</ul>
<h2 id="identity-management"><a class="header" href="#identity-management">identity management</a></h2>
<p>The IAM have been simplified in the previous diagrams.</p>
<p>We distinguish</p>
<ul>
<li>Client identity (OIDC profile, OAuth token)</li>
<li>Client service subscription authorization token (OAuth token): traded from the client identity, represents the fact that the client has subscribed to the service, regardless its right to access the service (for instance with an empty bucket on a prepaid service)</li>
</ul>
<p>And the same for Service Vendors (which are Clients of Service Providers)</p>
<p>The authorizer trait signature is <code>authorize(service subscription authorization token) -&gt; key</code></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="software-architecture"><a class="header" href="#software-architecture">Software Architecture</a></h1>
<h2 id="actors"><a class="header" href="#actors">Actors</a></h2>
<pre class="mermaid">flowchart LR

  vod(VOD Application)
  subgraph common [Common Sub-lattice]
    authz(Client AuthZ Service)
    coordinator(Rating Coordinator)
    crypto(Crypto Provider)
    facade(&quot;Customer Product &lt;br&gt; Inventory Facade&quot;)
    gateway(API gateway)
    httpd(HTTP server provider)
  end
  subgraph orange [Orange Sub-lattice]
    orange_agent_http(&quot;HTTP client Provider &lt;br&gt; (fetch auth keys)&quot;)
    orange_agent_kv(&quot;KV Provider &lt;br&gt; (agent, conf, buckets)&quot;)
    orange_agent(&quot;Orange VOD &lt;br&gt; Rating Agent&quot;)
    orange_collector_kv(KV/SQL Provider)
    orange_collector(&quot;Usage Collector&quot;)
    orange_inventory_kv(KV Provider)
    orange_inventory(&quot;Orange Customer &lt;br&gt; Product Inventory&quot;)
  end
  subgraph partner_x [Partner X Sub-lattice]
    partner_x_agent(&quot;Partner X VOD &lt;br&gt; Rating Agent&quot;)
    partner_x_inventory(&quot;Partner X Customer &lt;br&gt; Product Inventory&quot;)
  end
  subgraph partner_y [Partner Y Sub-lattice]
    partner_y_agent(&quot;Partner Y VOD &lt;br&gt; Rating Agent&quot;)
    partner_y_inventory(&quot;Partner Y Customer &lt;br&gt; Product Inventory&quot;)
  end

  coordinator --&gt; orange_agent
  coordinator --&gt; partner_x_agent
  coordinator --&gt; partner_y_agent
  crypto -.-&gt; authz
  facade --&gt;|Search|orange_inventory
  facade --&gt;|Search|partner_x_inventory
  facade --&gt;|Search|partner_y_inventory
  gateway --&gt; authz
  gateway --&gt; coordinator
  gateway --&gt; facade
  gateway &lt;-.- httpd
  orange_agent --&gt; orange_collector
  orange_agent &lt;-.- orange_agent_http
  orange_agent &lt;-.- orange_agent_kv
  orange_collector_kv -.-&gt; orange_collector
  orange_inventory_kv -.-&gt; orange_inventory
  vod --&gt; httpd
  
  classDef domain fill:#fffff7,stroke-dasharray:10,stroke-width:2px,font-weight:bold
  class common,orange,partner_x,partner_y domain

  classDef offer fill:#d6e8d5
  class vod,orange_agent,partner_x_agent,partner_y_agent offer

  classDef provider fill:#ffe6cc
  class crypto,httpd,orange_agent_http,orange_agent_kv,orange_collector_kv,orange_inventory_kv provider

  classDef actor fill:#dae8fc
  class authz,gateway,facade,coordinator,orange_collector,orange_inventory,partner_x_inventory,partner_y_inventory actor
</pre>
<div class="table-wrapper"><table><thead><tr><th>Legend</th><th></th></tr></thead><tbody>
<tr><td>ORANGE</td><td>Capability Providers</td></tr>
<tr><td>BLUE</td><td>Non offer-dependent Actors</td></tr>
<tr><td>GREEN</td><td>Offer-dependent Actors <br><ins><em>There is as many actor types as offers</em></ins></td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="functional-specification"><a class="header" href="#functional-specification">Functional Specification</a></h1>
<p><strong>TABLE OF CONTENT</strong></p>
<ul>
<li><a href="ARCHITECTURE/functional-specification.html#introduction">Introduction</a>
<ul>
<li><a href="ARCHITECTURE/functional-specification.html#context">Context</a></li>
<li><a href="ARCHITECTURE/functional-specification.html#assumptions">Assumptions</a></li>
</ul>
</li>
<li><a href="ARCHITECTURE/functional-specification.html#charging--billing">Charging &amp; Billing</a></li>
<li><a href="ARCHITECTURE/functional-specification.html#charging-and-billing-within-etom">Charging and Billing within eTOM</a>
<ul>
<li><a href="ARCHITECTURE/functional-specification.html#product-usage-management">Product Usage Management</a></li>
<li><a href="ARCHITECTURE/functional-specification.html#product-rating--rate-assignment">Product Rating &amp; Rate Assignment</a></li>
<li><a href="ARCHITECTURE/functional-specification.html#product-balance-management">Product Balance Management</a></li>
<li><a href="ARCHITECTURE/functional-specification.html#bill-calculation">Bill Calculation</a></li>
<li><a href="ARCHITECTURE/functional-specification.html#managed-entities">Managed entities</a>
<ul>
<li><a href="ARCHITECTURE/functional-specification.html#customer-product-inventory">Customer Product Inventory</a></li>
<li><a href="ARCHITECTURE/functional-specification.html#rated-usage-inventory">Rated Usage Inventory</a></li>
</ul>
</li>
<li><a href="ARCHITECTURE/functional-specification.html#system-personas">System Personas</a>
<ul>
<li><a href="ARCHITECTURE/functional-specification.html#customer">Customer</a></li>
<li><a href="ARCHITECTURE/functional-specification.html#vendor">Vendor</a></li>
<li><a href="ARCHITECTURE/functional-specification.html#provider">Provider</a></li>
<li><a href="ARCHITECTURE/functional-specification.html#partner">Partner</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="introduction"><a class="header" href="#introduction">Introduction</a></h2>
<p>The aim of this page is to describe the business aspects for the distributed charging and rating process. The specification should try to describe when possible the similarities between the <em>distributed rating</em> and the charging and billing components in TMF.</p>
<h3 id="context"><a class="header" href="#context">Context</a></h3>
<p><em>Distributed rating</em> aims to explore the use of distributed architecture for the rating and part of the charging process to optimize the utilization of the various infrastructure components. For reference the software architecture for the stream can be found <a href="ARCHITECTURE/./architecture.html">here</a>.</p>
<h3 id="assumptions"><a class="header" href="#assumptions">Assumptions</a></h3>
<p>Given the fact that this part is a research activity, this component will aim to comply with the TMF guidelines while allowing room for the needs of its innovative nature. in the first evolution the system may mock any external components to expedite the research activities.</p>
<p>The first evolution should focus on products provided over IP through a client application to facilitate the tracking of their usage through the client application.</p>
<h2 id="charging--billing"><a class="header" href="#charging--billing">Charging &amp; Billing</a></h2>
<p><img src="ARCHITECTURE/./charging_billing_overview.svg" alt="Charging &amp; Billing BPM" /></p>
<p>The process called "Billing" consists of a set of different processes, each working on one type of data:</p>
<ul>
<li><strong>Charging</strong>
in charge of controlling the usage and decrementation of bundles. It is part of the "Factory" platform and uses the Charging rules and features described at the Product level.</li>
<li><strong>Rating</strong>
which valuates the usage tickets sent by the Charging. It is part of the "Offer &amp; Products" platform and uses the tariffs and tariff plans described in the Offers to determine the tariff codes (InstalledTariff) that will be used to make the invoice.</li>
<li><strong>Bill</strong>
alculation, which calculates the billable items (AppliedTariff) that will be sent to billing to be put on the bill. It is part of the "Offer &amp; Products" platform and uses the rates and tariff plan described in the Offers</li>
<li><strong>Invoicing</strong>
which establishes the invoice from billable items received. It is part of the "Party" platform and uses commercial catalog information to calculate invoice elements and layout.</li>
</ul>
<p>Part of the charging and rating will be distributed in the new architecture, the rating component should then feed the generated tariff to the billing component. There's no direct impact from the invoicing component so it will not be discussed in this document's scope.</p>
<h2 id="charging-and-billing-within-etom"><a class="header" href="#charging-and-billing-within-etom">Charging and Billing within eTOM</a></h2>
<p>Below are listed level 2 business processes that are related to Product rating &amp; Bill Calculation from within the eTOM business process framework, these processes should be used as a guide while distributing the operations on the new architecture.</p>
<h3 id="product-usage-management"><a class="header" href="#product-usage-management">Product Usage Management</a></h3>
<p>The Product Usage management processes encompass the functions required to guide, distribute, mediate, summarize, accumulate, and analyze Product Usage records. These processes may occur in real-time, near real-time (i.e. just at the end of the usage), or may be executed on a periodic basis.</p>
<p>Conventionally the usage is collected on the network component and forwarded to be processed in the usage management component.</p>
<p>In the <em>distributed rating</em>, the Client SDK should do the usage collection and forward it to the <em>Rating Agent</em> to be processed in real-time.</p>
<p>Below is the data schema of the product usage management as defined in TMF-635, the main entity used in the usage management process is the Usage and UsageSpecification</p>
<pre class="mermaid">%%{init: {'theme': 'base', 'themeVariables': {
  'lineColor': '#a8201a',
  'primaryColor': '#fae5c7',
  'primaryBorderColor': '#0f8b8d'
}}}%%
classDiagram
  direction LR
  class RelatedParty{
    URI href
    String id
    String name
    String role
    String @type
    String @baseType
    String @referredType
    URI @schemaLocation
  }
  class UsageSpecificationRef{
    URI href
    String id
    String name
    String @type
    String @baseType
    String @referredType
    URI @schemaLocation
  }
  class Usage{
    URI href
    String id
    String usageType
    Date usageDate
    UsageStatusType status
    String @type
    String @baseType
    URI @schemaLocation
  }
  class UsageStatusType{
    &lt;&lt;Enumeration&gt;&gt;
    received
    rejected
    recycled
    guided
    rated
    rerated
  }
  class UsageCharacteristic{
    String id
    String name
    String valueType
    Any value
    String @type
    String @baseType
    URI @schemaLocation
  }
  class CharacteristicRelationship{
    URI href
    String id
    String relationshipType
    String @type
    String @baseType
    URI @schemaLocation
  }
  RelatedParty &quot;0..*&quot; &lt;--* Usage
  UsageSpecificationRef &quot;0..1&quot; &lt;--* Usage
  Usage -- &quot;1&quot; UsageStatusType
  Usage *--&gt; &quot;0..*&quot; UsageCharacteristic
  UsageCharacteristic *--&gt; &quot;0..*&quot; CharacteristicRelationship
</pre>
<h3 id="product-rating--rate-assignment"><a class="header" href="#product-rating--rate-assignment">Product Rating &amp; Rate Assignment</a></h3>
<p>The purpose of Product Rating &amp; Assignment is to rate a value (monetary or other) to Product Usage or a set of Product Usages and assign the result to a Product and a Billing Account. The charge may be either a credit or a debit and can be handled either online or offline.</p>
<p>Online charging is performed in real-time, necessitating an authorization component that can impact the delivery of the product and enables the operator to provide prepaid products to their customers. Conversely, offline charging takes place after the product has been delivered and does not necessitate real-time processing, and typically pertains to subscription-based products.</p>
<p>in the <em>distributed rating</em>, optimally the process of usage and rating should be done on the edge or the FOG levels to minimize the loud on the infrastructure.</p>
<p>Below is the data schema of the product usage management as defined in TMF-635, the main entity used in the product rating and rate assignment process is the RatedProductUsage entity</p>
<pre class="mermaid">%%{init: {'theme': 'base', 'themeVariables': {
  'lineColor': '#a8201a',
  'primaryColor': '#fae5c7',
  'primaryBorderColor': '#0f8b8d'
}}}%%
classDiagram
  direction LR
  class RelatedParty{
    URI href
    String id
    String name
    String role
    String @type
    String @baseType
    String @referredType
    URI @schemaLocation
  }
  class UsageSpecificationRef{
    URI href
    String id
    String name
    String @type
    String @baseType
    String @referredType
    URI @schemaLocation
  }
  class Usage{
    URI href
    String id
    String usageType
    Date usageDate
    UsageStatusType status
    String @type
    String @baseType
    URI @schemaLocation
  }
  class UsageCharacteristic{
    String id
    String name
    String valueType
    Any value
    String @type
    String @baseType
    URI @schemaLocation
  }
  class CharacteristicRelationship{
    URI href
    String id
    String relationshipType
    String @type
    String @baseType
    URI @schemaLocation
  }
  class UsageStatusType{
    &lt;&lt;Enumeration&gt;&gt;
    received
    rejected
    recycled
    guided
    rated
    rerated
  }
  class RatedProductUsage{
    Money bucketValueConvertedInAmount
    bool isBilled
    bool isTaxExempted
    String offerTariffType
    String ratingAmountType
    Date ratingDate
    Money taxExcludedRatingAmount
    Money taxIncludedRatingAmount
    float taxRate
    String usageRatingTag
    String @type
    String @baseType
    URI @schemaLocation
  }
  class ProductRef{
    URI href
    String id
    String name
    String @type
    String @baseType
    String @referredType
    URI @schemaLocation
  }
  RelatedParty &quot;0..*&quot; &lt;--* Usage
  UsageSpecificationRef &quot;0..1&quot; &lt;--* Usage
  Usage -- &quot;1&quot; UsageStatusType
  Usage *--&gt; &quot;0..*&quot; UsageCharacteristic
  Usage *--&gt; &quot;0..*&quot; RatedProductUsage
  UsageCharacteristic *--&gt; &quot;0..*&quot; CharacteristicRelationship
  RatedProductUsage *--&gt; &quot;0..1&quot; ProductRef
</pre>
<h3 id="product-balance-management"><a class="header" href="#product-balance-management">Product Balance Management</a></h3>
<p>This process is responsible for holding, calculating, applying policies and managing functionality/interfaces for the Product balances, Here the values resulting from rating and the application of discounts are applied to a Product balance. The balance affected by the value may be monetary or other balances such as minutes, points, or tokens.</p>
<p>The <em>Rating Agent</em> should ensure that the balance is impacted and reduce it to match the product usage. The aim is to ensure that the balance is impacted instantly and is managed in a distributed manner. The operations for balance management (like top-up operations) will be out of scope of the first evolution and only the reduction of balance based on usage will be represented.</p>
<p>Below is the data schema of the balance as defined in TMF-654</p>
<pre class="mermaid">%%{init: {'theme': 'base', 'themeVariables': {
  'lineColor': '#a8201a',
  'primaryColor': '#fae5c7',
  'primaryBorderColor': '#0f8b8d'
}}}%%
classDiagram
  direction LR
  class PartyAccountRef{
    String id
    String href
    String name
  }
  class RelatedPartyRef{
    String id
    String href
    String role
    String name
  }
  class BucketBalance{
    [ SID CustomerAccountBalance ]
    String id
    String href
    String name
    String discription
    String bucketType
    TimePeriod validFor
    Quantity remainedAmount
    Quantity reservedAmount
    String status
  }
  class RealizingResourceRef{
    String id
    String href
    String name
    String @type
    String value
  }
  class ProductRef{
    String id
    String href
    String name
  }
  PartyAccountRef &quot;1&quot; --o &quot;1&quot; BucketBalance
  RelatedPartyRef &quot;0..*&quot; --o &quot;1&quot; BucketBalance
  BucketBalance &quot;1&quot; o-- &quot;0..*&quot; RealizingResourceRef
  BucketBalance &quot;1&quot; o-- &quot;0..*&quot; ProductRef
  RealizingResourceRef &quot;*&quot; -- &quot;1&quot; ProductRef
</pre>
<h3 id="bill-calculation"><a class="header" href="#bill-calculation">Bill Calculation</a></h3>
<p>Customer Bill Invoice Management processes ensure the bill invoice is created, physically and/or electronically produced and distributed to customers, and that the appropriate taxes, discounts, adjustments, rebates and credits for the products delivered to customers have been applied. These processes are accountable for assuring that enterprise revenue is billed and invoices delivered appropriately to customers.</p>
<p>These processes are responsible for, but not limited to:</p>
<ul>
<li>Establishment and application of taxes and charges to the products delivered to customers;</li>
<li>Application of the adjustment (adjustment decision done in Customer Bill Inquiry Handling);</li>
<li>Creation of accurate Customer bill invoices including all adjustments, rebates, discounts, credits, etc.</li>
<li>Production &amp; distribution of Customer bill in physical and/or electronic form to customers in accordance with the billing cycle;</li>
<li>Forecasting of physical resources associated with Customer bill production, such as paper and envelope quantities;</li>
<li>Alignment and management of promotional material insertion into distributed Customer bills</li>
<li>Establishment and management of third party arrangements to support Customer bill invoice generation, production and distribution.</li>
</ul>
<p>The implementation of the Bill Calculation component is out of scope of the <em>distributed rating</em> however the system should ensure that it can generate Proof of Usages and rated events that can be forwarded to the Bill calculation component - through events or shared storage - to support post paid business scenarios. The support for aggregated rating will not be addressed in the first release and can be included in later evolution due to the technical complexity associated with it.</p>
<h3 id="managed-entities"><a class="header" href="#managed-entities">Managed entities</a></h3>
<h4 id="customer-product-inventory"><a class="header" href="#customer-product-inventory">Customer Product Inventory</a></h4>
<p>The customer product inventory component holds the information about the customer and his installed products. it's used to track all the products that the customer has subscribed to as well as their cost. in the first release the customer inventory will be a simple key-value store that holds the customer id as the key and party information with a list of their installed product in the value. the figure below show the schema of the data stored in the value.</p>
<pre class="mermaid">%%{init: {'theme': 'base', 'themeVariables': {
  'lineColor': '#a8201a',
  'primaryColor': '#fae5c7',
  'primaryBorderColor': '#0f8b8d'
}}}%%
classDiagram
  direction LR
  class Party {
    string id
    string name
  }
  class CustomerInventory {
    Party relatedParty
    List~Product~ products
  }
  class ProductOfferingRef {
    string id
    string name
    string agentId
    Quantity unitOfMeasure
  }
  class Quantity {
    string amount
    string units
  }
  class Product {
    string id
    string partnerId
    string description
    ProductOfferingRef productOffering
    ProductPrice productPrice
  }
  class ProductPrice {
    PriceType priceType
    DataTime validTill
    string description
    Quantity unitOfMeasure
    Price price
  }
  class PriceType {
    &lt;&lt;Enumeration&gt;&gt;
    recurring
    none-recurring
    penalty
    one-time
  }
  class Price {
    string unit
    float value
  }
  Party --o CustomerInventory
  CustomerInventory *-- Product
  ProductOfferingRef --o Product
  ProductOfferingRef *-- Quantity
  Product o-- ProductPrice
  Quantity --* ProductPrice
  ProductPrice o-- PriceType
  ProductPrice *-- Price
</pre>
<p>productPrice: An amount, usually of money, that represents the actual price paid by a Customer for a purchase, a rent or a lease of a Product. The price is valid for a defined period of time.
price: A money (Money). The amount of money that characterizes the price.</p>
<p>Money sub-resource
A base / value business entity used to represent money.
unit: A string. Currency (ISO4217 norm uses 3 letters to define the currency).
value: A float. A positive floating point number.</p>
<details id="admonition-customer-product-inventory-field-descriptions" class="admonition admonish-abstract">
<summary class="admonition-title">
<p>Customer product inventory field descriptions</p>
<p><a class="admonition-anchor-link" href="ARCHITECTURE/functional-specification.html#admonition-customer-product-inventory-field-descriptions"></a></p>
</summary>
<div>
<p>RelatedParty sub-resource:
Related Entity reference. A related party defines party or party role linked to a specific entity.</p>
<ul>
<li>name: A string. Name of the related entity.</li>
<li>id: A string. unique identifier.</li>
</ul>
<p>productOffering A product offering reference (ProductOfferingRef). A product offering represents entities that are orderable from the provider of the catalog.</p>
<ul>
<li>name: A string. Name of the related entity.</li>
<li>id: A string. unique identifier.</li>
<li>agentId: the identifier for the agent in charge of rating this offer</li>
</ul>
<p>productPrice: An amount, usually of money, that represents the actual price paid by a Customer for a purchase, a rent or a lease of a Product. The price is valid for a defined period of time.</p>
<ul>
<li>price: A money (Money). The amount of money that characterizes the price.</li>
<li>priceType: A string. A category that describes the price charge, such as recurring, penalty, One time fee and so forth.</li>
<li>unitOfMeasure A quantity (Quantity). A number and unit representing how many (for instance 1 dozen) of an ProductOffering is available at the offered price. Its meaning depends on the priceType. It could be a price, a rate, or a discount.</li>
</ul>
<p>Money sub-resource:
A base / value business entity used to represent money.</p>
<ul>
<li>unit: A string. Currency (ISO4217 norm uses 3 letters to define the currency).</li>
<li>value: A float. A positive floating point number.</li>
</ul>
</div>
</details>
<h4 id="rated-usage-inventory"><a class="header" href="#rated-usage-inventory">Rated Usage Inventory</a></h4>
<p>The rated usage inventory component holds the information about the customer's usage and its associated cost. it's used to hold the rated usage information that can be forwarded later on to the billing component. the figure below show the schema of the rated usage.</p>
<pre class="mermaid">%%{init: {'theme': 'base', 'themeVariables': {
  'lineColor': '#a8201a',
  'primaryColor': '#fae5c7',
  'primaryBorderColor': '#0f8b8d'
}}}%%
classDiagram
  direction TB
  class Party {
    string id
    string name
    string role
    string @referredType
  }
  class RatedUsage {
    string id
    string usageDate
    string description
    string usageType
    string status
    Party relatedParty
    RatedProductUsage ratedProductUsage
    List~UsageCharacteristic~ usageCharacteristics
  }
  class UsageCharacteristic {
    string id
    string name
    string valueType
    string value
  }
  class RatedProductUsage {
    bool isBilled
    string ratingAmountType
    string ratingDate
    BucketValueConvertedInAmount bucketValueConvertedInAmount
    ProductRef productRef
  }
  class BucketValueConvertedInAmount {
    string unit
    int value
  }
  class ProductRef {
    string id
    string name
  }
  Party --o RatedUsage
  UsageCharacteristic --* RatedUsage
  RatedUsage *-- RatedProductUsage
  RatedProductUsage o-- ProductRef
  RatedProductUsage o-- BucketValueConvertedInAmount
</pre>
<details id="admonition-rated-usage-inventory-field-descriptions" class="admonition admonish-abstract">
<summary class="admonition-title">
<p>Rated usage inventory field descriptions</p>
<p><a class="admonition-anchor-link" href="ARCHITECTURE/functional-specification.html#admonition-rated-usage-inventory-field-descriptions"></a></p>
</summary>
<div>
<p>RatedUsage fields:</p>
<ul>
<li>id: A string. unique identifier.</li>
<li>usageDate: A date time (DateTime). Date of usage.</li>
<li>description:  A string. Description of usage.</li>
<li>ratedProductUsage: rated product usages (RatedProductUsage). An occurrence of employing a product for its intended purpose with all rating details.</li>
<li>relatedParty: related party (RelatedParty ). Related Entity reference. A related party defines party or party role linked to a specific entity.</li>
<li>status: A usage status type (UsageStatusType). Possible values for the status of the Usage.</li>
<li>usageCharacteristic: A list of usage characteristics (UsageCharacteristic [*]). Provides the value of a given characteristic.</li>
<li>usageType: A string. Type of usage.</li>
</ul>
<p>Money sub-resource:
A base / value business entity used to represent money.</p>
<ul>
<li>unit: A string. Currency (ISO4217 norm uses 3 letters to define the currency).</li>
<li>value: A float. A positive floating point number.</li>
</ul>
<p>RatedProductUsage sub-resource:
An occurrence of employing a product for its intended purpose with all rating details.</p>
<ul>
<li>bucketValueConvertedInAmount: A money (Money). A base / value business entity used to represent money.</li>
<li>isBilled: A boolean. Boolean indicating if usage have been billed or not.</li>
<li>productRef: A product reference (ProductRef).</li>
<li>ratingAmountType: A string. Type of amount.</li>
<li>ratingDate: A date time (DateTime). Date of usage rating.</li>
<li>usageRatingTag A string. Tag value: [usage]: the usage is always rated outside a usage bundle [included usage]: the usage is rated inside a usage bundle, [non included usage]: the usage bundle is exhausted. The usage is rated outside the usage bundle.</li>
</ul>
<p>RelatedParty sub-resource:
Related Entity reference. A related party defines party or party role linked to a specific entity.</p>
<ul>
<li>name A string. Name of the related entity.</li>
<li>id A string. unique identifier.</li>
<li>role A string. Role played by the related party.</li>
</ul>
<p>UsageCharacteristic sub-resource:
Provides the value of a given characteristic.</p>
<ul>
<li>id: A string. Unique identifier of the characteristic.</li>
<li>name: A string. Name of the characteristic.</li>
<li>valueType: A string. Data type of the value of the characteristic.</li>
</ul>
</div>
</details>
<h3 id="system-personas"><a class="header" href="#system-personas">System Personas</a></h3>
<h4 id="customer"><a class="header" href="#customer">Customer</a></h4>
<p>The end user that is benefiting from the product irrespective of his relation with different entities involved.</p>
<div id="admonition-customer-example" class="admonition admonish-example">
<div class="admonition-title">
<p>Customer Example</p>
<p><a class="admonition-anchor-link" href="ARCHITECTURE/functional-specification.html#admonition-customer-example"></a></p>
</div>
<div>
<ul>
<li>Person requesting to watch a movie on a streaming provider through his teleco account.</li>
<li>Person requesting to use a hosting products from a cloud provider which relies on a teleco products for connectivity</li>
</ul>
</div>
</div>
<h4 id="vendor"><a class="header" href="#vendor">Vendor</a></h4>
<p>The entity that's managing the customer account. a vendor can be reselling a product, building a composite product or providing his own products as well.</p>
<p>Depending on the usecase the same entity can be regarded as vendor, provider or a partner.</p>
<h4 id="provider"><a class="header" href="#provider">Provider</a></h4>
<p>The entity providing their products for partners with a revenue sharing model. providers can also be represented as the Vendor in case of selling directly yo the Customer.</p>
<h4 id="partner"><a class="header" href="#partner">Partner</a></h4>
<p>Describes the relation between Vendors and providers, providers are considered a partner for the vendor that's reselling/composing their products. Providers are also considered partners to other providers if the use other products.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="retrival-of-customer-product-inventory"><a class="header" href="#retrival-of-customer-product-inventory">Retrival of customer product inventory</a></h1>
<div id="admonition-pertaining-to" class="admonition admonish-abstract">
<div class="admonition-title">
<p>Pertaining to</p>
<p><a class="admonition-anchor-link" href="USE-CASES/UC-01/index.html#admonition-pertaining-to"></a></p>
</div>
<div>
<ul>
<li>Customer account type: <strong>ANY</strong></li>
<li>Product offer type: <strong>ANY</strong></li>
</ul>
</div>
</div>
<div id="admonition-customer-use-case" class="admonition admonish-example">
<div class="admonition-title">
<p>Customer Use case</p>
<p><a class="admonition-anchor-link" href="USE-CASES/UC-01/index.html#admonition-customer-use-case"></a></p>
</div>
<div>
<p><strong>As a</strong> customer of a <em>Teleco provider</em><br />
<strong>I want to</strong> list products available to me<br />
<strong>so that I can</strong> use some of them</p>
</div>
</div>
<div id="admonition-vendor-use-case" class="admonition admonish-example">
<div class="admonition-title">
<p>Vendor Use case</p>
<p><a class="admonition-anchor-link" href="USE-CASES/UC-01/index.html#admonition-vendor-use-case"></a></p>
</div>
<div>
<p><strong>As a</strong> vendor providing products <em>over IP</em> through a <em>Teleco provider</em><br />
<strong>I want to</strong> have integration with the Teleco provider product inventory<br />
<strong>so that I can</strong> list the products I provide<br />
<strong>and</strong> make the products available for usage</p>
</div>
</div>
<h2 id="business-processes"><a class="header" href="#business-processes">Business processes</a></h2>
<h3 id="process-model-for-the-retrival-of-customer-product-inventory"><a class="header" href="#process-model-for-the-retrival-of-customer-product-inventory">Process model for the retrival of customer product inventory</a></h3>
<p><img src="USE-CASES/UC-01/./list-bpm.svg" alt="Process model for the retrival of customer product inventory" /></p>
<h3 id="legend"><a class="header" href="#legend">Legend</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Term</th><th>description</th></tr></thead><tbody>
<tr><td><em>Party</em></td><td>A customer that has subscribed to a product</td></tr>
<tr><td><em>Vendor/Partner</em></td><td>An entity that sells products provided by another entity through a partnership agreement</td></tr>
<tr><td><em>Client SDK</em></td><td>The application from which the product are used</td></tr>
<tr><td><em>Product Offer</em></td><td>A product offering represents entities that are orderable from the provider of the catalog</td></tr>
<tr><td><em>Product</em></td><td>An instantiated offer for a specific party</td></tr>
<tr><td><em>Rating agent</em></td><td>The contract for the rating</td></tr>
<tr><td><em>Actor</em></td><td>An instantiated <em>Rating Agent</em></td></tr>
<tr><td><em>Rating coordinator</em></td><td>A component responsible for orchestrating the rating requests to different <em>Rating Agents</em></td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="overview-of-product-usage-rating"><a class="header" href="#overview-of-product-usage-rating">Overview of product usage rating</a></h1>
<div id="admonition-pertaining-to" class="admonition admonish-abstract">
<div class="admonition-title">
<p>Pertaining to</p>
<p><a class="admonition-anchor-link" href="USE-CASES/UC-02/index.html#admonition-pertaining-to"></a></p>
</div>
<div>
<ul>
<li>Customer account type: <strong>ANY</strong></li>
<li>Product offer type: <strong>ANY</strong></li>
</ul>
</div>
</div>
<div id="admonition-vendor-use-case" class="admonition admonish-example">
<div class="admonition-title">
<p>Vendor Use case</p>
<p><a class="admonition-anchor-link" href="USE-CASES/UC-02/index.html#admonition-vendor-use-case"></a></p>
</div>
<div>
<p><strong>As a</strong> Vendor providing products <em>over IP</em> through a <em>Teleco provider</em><br />
<strong>I want to</strong> build new products based on products offered by other vendors<br />
<strong>and</strong> integrate with the rating platform of the <em>Teleco provider</em><br />
<strong>so that I can</strong> rate the usage of products I provide<br />
<strong>and</strong> relay the rating to product dependencies vendors</p>
</div>
</div>
<div id="admonition-teleco-provider-use-case" class="admonition admonish-example">
<div class="admonition-title">
<p>Teleco Provider Use case</p>
<p><a class="admonition-anchor-link" href="USE-CASES/UC-02/index.html#admonition-teleco-provider-use-case"></a></p>
</div>
<div>
<p><strong>As a</strong> Teleco Provider<br />
<strong>I want to</strong> provide products from multiple partners<br />
<strong>and</strong> relay the rating to partner's agent<br />
<strong>so that</strong> I can ensure all partners have rated the product before usage</p>
</div>
</div>
<h2 id="product-composition"><a class="header" href="#product-composition">Product composition</a></h2>
<p>For a composed product that depend on existing products,
the rating platform needs to build product dependency model,
and map it to corresponding agents for product usage rating,
allowing each individual product vendor to rate its products</p>
<p>As shown in the following diagram a <em>Streaming</em> product can use
<em>Network</em>, <em>Storage</em>, and <em>Telemetry</em> products to compose its functionality,
in turn each of its product dependencies may have other dependencies.</p>
<pre class="mermaid">%%{init: {'theme': 'base', 'themeVariables': {
  'lineColor': '#a8201a',
  'primaryColor': '#fae5c7',
  'primaryBorderColor': '#0f8b8d'
}}}%%
flowchart LR
  streaming(Streaming product)
  storage(Storage product)
  network(Network product)
  telemetry(Telemetry product)

  streaming --&gt; storage
  streaming --&gt; network
  streaming --&gt; telemetry
  telemetry --&gt; storage
  telemetry --&gt; network
  storage --&gt; network
  storage --&gt; telemetry

  classDef domain fill:#fffff7
  class streaming domain

  classDef offer fill:#d6e8d5
  class storage offer

  classDef provider fill:#ffe6cc
  class network provider

  classDef actor fill:#dae8fc
  class telemetry actor
</pre>
<h2 id="business-processes-1"><a class="header" href="#business-processes-1">Business processes</a></h2>
<h3 id="product-usage-overview"><a class="header" href="#product-usage-overview">Product usage overview</a></h3>
<p>The process of product usage in the <em>distributed rating</em> system, which is
illustrated in the model below, begins with the client request going through
the <em>Rating Coordinator</em> and each <em>Rating Agent</em> before finally issuing
the <em>Usage Proof</em>, which is collected and stored by the <em>Usage Collector</em>,
focusing on the crucial role of the <em>Rating Coordinator</em> in decoupling
the <em>Rating Agent</em> and standardizing the communication between them.</p>
<p>Also, the process model illustrates the iterative approach used by
the <em>Usage Collector</em> to carry out its main three tasks:</p>
<ol>
<li>Construct the agent dependency graph, by recursively quering each agent for its dependencies.</li>
<li>Validate the usage request by all the agents.</li>
<li>Trigger rating for each agent in order of their dependencies.</li>
</ol>
<p><img src="USE-CASES/UC-02/../UC-02/rating-bpm.svg" alt="Diagram depicting the product usage process" /></p>
<h3 id="legend-1"><a class="header" href="#legend-1">Legend</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Term</th><th>description</th></tr></thead><tbody>
<tr><td><em>Party</em></td><td>A customer that has subscribed to a product</td></tr>
<tr><td><em>Vendor/Partner</em></td><td>An entity that sells products provided by another entity through a partnership agreement</td></tr>
<tr><td><em>Client SDK</em></td><td>The application from which the product are used</td></tr>
<tr><td><em>Product Offer</em></td><td>A product offering represents entities that are orderable from the provider of the catalog</td></tr>
<tr><td><em>Product</em></td><td>An instantiated offer for a specific party</td></tr>
<tr><td><em>Rating agent</em></td><td>The contract for the rating</td></tr>
<tr><td><em>Actor</em></td><td>An instantiated <em>Rating Agent</em></td></tr>
<tr><td><em>Rating coordinator</em></td><td>A component responsible for orchestrating the rating requests to different <em>Rating Agents</em></td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="rating-of-regular-product"><a class="header" href="#rating-of-regular-product">Rating of regular product</a></h1>
<div id="admonition-pertaining-to" class="admonition admonish-abstract">
<div class="admonition-title">
<p>Pertaining to</p>
<p><a class="admonition-anchor-link" href="USE-CASES/UC-03/index.html#admonition-pertaining-to"></a></p>
</div>
<div>
<ul>
<li>Customer account type: <strong>POSTPAID</strong></li>
<li>Product offer type: <strong>REGULAR</strong></li>
</ul>
</div>
</div>
<div id="admonition-customer-use-case" class="admonition admonish-example">
<div class="admonition-title">
<p>Customer Use case</p>
<p><a class="admonition-anchor-link" href="USE-CASES/UC-03/index.html#admonition-customer-use-case"></a></p>
</div>
<div>
<p><strong>As a</strong> customer of a <em>Teleco provider</em> with <em>postpaid</em> account<br />
<strong>I want to</strong> select some regular product from the <em>Teleco provider</em> mobile app<br />
<strong>so that</strong> the cost will be reflected in my bill</p>
</div>
</div>
<div id="admonition-vendor-use-case" class="admonition admonish-example">
<div class="admonition-title">
<p>Vendor Use case</p>
<p><a class="admonition-anchor-link" href="USE-CASES/UC-03/index.html#admonition-vendor-use-case"></a></p>
</div>
<div>
<p><strong>As a</strong> vendor providing products <em>over IP</em> through a <em>Teleco provider</em><br />
<strong>I want to</strong> have integration with the Teleco provider rating process<br />
<strong>so that I can</strong> monitor the usage of the products I provide<br />
<strong>and</strong> track revenue of the products based on usage</p>
</div>
</div>
<div id="admonition-teleco-provider-use-case" class="admonition admonish-example">
<div class="admonition-title">
<p>Teleco Provider Use case</p>
<p><a class="admonition-anchor-link" href="USE-CASES/UC-03/index.html#admonition-teleco-provider-use-case"></a></p>
</div>
<div>
<p><strong>As a</strong> Teleco Provider
<strong>I want to</strong> rate the usage of movie streaming products
<strong>so that</strong> I can charge the customer for his usage.</p>
</div>
</div>
<h2 id="business-processes-2"><a class="header" href="#business-processes-2">Business processes</a></h2>
<h3 id="product-usage-overview-1"><a class="header" href="#product-usage-overview-1">Product usage overview</a></h3>
<p>The process of product usage in the <em>distributed rating</em> system, which is
illustrated in the model below, begins with the client request going through
the <em>Rating Coordinator</em> and each <em>Rating Agent</em> before finally issuing
the <em>Usage Proof</em>, which is collected and stored by the <em>Usage Collector</em>,
focusing on the crucial role of the <em>Rating Coordinator</em> in decoupling
the <em>Rating Agent</em> and standardizing the communication between them.</p>
<p>Also, the process model illustrates the iterative approach used by
the <em>Usage Collector</em> to carry out its main three tasks:</p>
<ol>
<li>Construct the agent dependency graph, by recursively quering each agent for its dependencies.</li>
<li>Validate the usage request by all the agents.</li>
<li>Trigger rating for each agent in order of their dependencies.</li>
</ol>
<p><img src="USE-CASES/UC-03/../UC-02/rating-bpm.svg" alt="Diagram depicting the product usage process" /></p>
<h3 id="regular-product-rating"><a class="header" href="#regular-product-rating">Regular product rating</a></h3>
<p><img src="USE-CASES/UC-03/./rating-bpm.svg" alt="Diagram depicting the rating process of a regular product" /></p>
<h3 id="legend-2"><a class="header" href="#legend-2">Legend</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Term</th><th>description</th></tr></thead><tbody>
<tr><td><em>Party</em></td><td>A customer that has subscribed to a product</td></tr>
<tr><td><em>Vendor/Partner</em></td><td>An entity that sells products provided by another entity through a partnership agreement</td></tr>
<tr><td><em>Client SDK</em></td><td>The application from which the product are used</td></tr>
<tr><td><em>Product Offer</em></td><td>A product offering represents entities that are orderable from the provider of the catalog</td></tr>
<tr><td><em>Product</em></td><td>An instantiated offer for a specific party</td></tr>
<tr><td><em>Rating agent</em></td><td>The contract for the rating</td></tr>
<tr><td><em>Actor</em></td><td>An instantiated <em>Rating Agent</em></td></tr>
<tr><td><em>Rating coordinator</em></td><td>A component responsible for orchestrating the rating requests to different <em>Rating Agents</em></td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="rating-of-threshold-product"><a class="header" href="#rating-of-threshold-product">Rating of threshold product</a></h1>
<div id="admonition-pertaining-to" class="admonition admonish-abstract">
<div class="admonition-title">
<p>Pertaining to</p>
<p><a class="admonition-anchor-link" href="USE-CASES/UC-04/index.html#admonition-pertaining-to"></a></p>
</div>
<div>
<ul>
<li>Customer account type: <strong>POSTPAID</strong></li>
<li>Product offer type: <strong>THRESHOLD</strong></li>
</ul>
</div>
</div>
<div id="admonition-customer-use-case" class="admonition admonish-example">
<div class="admonition-title">
<p>Customer Use case</p>
<p><a class="admonition-anchor-link" href="USE-CASES/UC-04/index.html#admonition-customer-use-case"></a></p>
</div>
<div>
<p><strong>As a</strong> customer of a <em>Teleco provider</em> with <em>postpaid</em> account<br />
<strong>I want to</strong> select some product with <em>threshold</em> product offer<br />
<strong>so that I can</strong> use it from a providers mobile app<br />
<strong>and</strong> the cost will be reflected in my bill</p>
</div>
</div>
<div id="admonition-teleco-provider-use-case" class="admonition admonish-example">
<div class="admonition-title">
<p>Teleco provider Use case</p>
<p><a class="admonition-anchor-link" href="USE-CASES/UC-04/index.html#admonition-teleco-provider-use-case"></a></p>
</div>
<div>
<p><strong>As a</strong> <em>Teleco provider</em> with <em>threshold</em> product offer<br />
<strong>I want to</strong> calculate rated usage for it in a distributed manner<br />
<strong>so that I can</strong> be reflected in the customers bill</p>
</div>
</div>
<h2 id="business-processes-3"><a class="header" href="#business-processes-3">Business processes</a></h2>
<h3 id="product-usage-overview-2"><a class="header" href="#product-usage-overview-2">Product usage overview</a></h3>
<p>The process of product usage in the <em>distributed rating</em> system, which is
illustrated in the model below, begins with the client request going through
the <em>Rating Coordinator</em> and each <em>Rating Agent</em> before finally issuing
the <em>Usage Proof</em>, which is collected and stored by the <em>Usage Collector</em>,
focusing on the crucial role of the <em>Rating Coordinator</em> in decoupling
the <em>Rating Agent</em> and standardizing the communication between them.</p>
<p>Also, the process model illustrates the iterative approach used by
the <em>Usage Collector</em> to carry out its main three tasks:</p>
<ol>
<li>Construct the agent dependency graph, by recursively quering each agent for its dependencies.</li>
<li>Validate the usage request by all the agents.</li>
<li>Trigger rating for each agent in order of their dependencies.</li>
</ol>
<p><img src="USE-CASES/UC-04/../UC-02/rating-bpm.svg" alt="Diagram depicting the product usage process" /></p>
<h3 id="threshold-product-rating"><a class="header" href="#threshold-product-rating">Threshold product rating</a></h3>
<p><img src="USE-CASES/UC-04/./rating-bpm.svg" alt="Diagram depicting the rating process of a threshold product" /></p>
<h3 id="legend-3"><a class="header" href="#legend-3">Legend</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Term</th><th>description</th></tr></thead><tbody>
<tr><td><em>Party</em></td><td>A customer that has subscribed to a product</td></tr>
<tr><td><em>Vendor/Partner</em></td><td>An entity that sells products provided by another entity through a partnership agreement</td></tr>
<tr><td><em>Client SDK</em></td><td>The application from which the product are used</td></tr>
<tr><td><em>Product Offer</em></td><td>A product offering represents entities that are orderable from the provider of the catalog</td></tr>
<tr><td><em>Product</em></td><td>An instantiated offer for a specific party</td></tr>
<tr><td><em>Rating agent</em></td><td>The contract for the rating</td></tr>
<tr><td><em>Actor</em></td><td>An instantiated <em>Rating Agent</em></td></tr>
<tr><td><em>Rating coordinator</em></td><td>A component responsible for orchestrating the rating requests to different <em>Rating Agents</em></td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="rating-of-bundle-product-offer"><a class="header" href="#rating-of-bundle-product-offer">Rating of bundle product offer</a></h1>
<div id="admonition-pertaining-to" class="admonition admonish-abstract">
<div class="admonition-title">
<p>Pertaining to</p>
<p><a class="admonition-anchor-link" href="USE-CASES/UC-05/index.html#admonition-pertaining-to"></a></p>
</div>
<div>
<ul>
<li>Customer account type: <strong>POSTPAID</strong></li>
<li>Product offer type: <strong>REGULAR</strong></li>
</ul>
</div>
</div>
<div id="admonition-customer-use-case" class="admonition admonish-example">
<div class="admonition-title">
<p>Customer Use case</p>
<p><a class="admonition-anchor-link" href="USE-CASES/UC-05/index.html#admonition-customer-use-case"></a></p>
</div>
<div>
<p><strong>As a</strong> postpaid customer of a teleco provider<br />
<strong>I want to</strong> select a bundled product of 3 movies for 1 dollar<br />
<strong>so that</strong> I can use this product from a providers mobile app<br />
<strong>and</strong> the cost of this product will be reflected in my bill</p>
</div>
</div>
<div id="admonition-teleco-provider-use-case" class="admonition admonish-example">
<div class="admonition-title">
<p>Teleco Provider Use case</p>
<p><a class="admonition-anchor-link" href="USE-CASES/UC-05/index.html#admonition-teleco-provider-use-case"></a></p>
</div>
<div>
<p><strong>As a</strong> Teleco Provider<br />
<strong>I want to</strong> sell a bundled product like 3 movies for 1 dollar in a distributed mode<br />
<strong>so that</strong> I will deduct the correct cost from the customer bundle</p>
</div>
</div>
<h2 id="business-processes-4"><a class="header" href="#business-processes-4">Business processes</a></h2>
<h3 id="product-usage-overview-3"><a class="header" href="#product-usage-overview-3">Product usage overview</a></h3>
<p>The process of product usage in the <em>distributed rating</em> system, which is
illustrated in the model below, begins with the client request going through
the <em>Rating Coordinator</em> and each <em>Rating Agent</em> before finally issuing
the <em>Usage Proof</em>, which is collected and stored by the <em>Usage Collector</em>,
focusing on the crucial role of the <em>Rating Coordinator</em> in decoupling
the <em>Rating Agent</em> and standardizing the communication between them.</p>
<p>Also, the process model illustrates the iterative approach used by
the <em>Usage Collector</em> to carry out its main three tasks:</p>
<ol>
<li>Construct the agent dependency graph, by recursively quering each agent for its dependencies.</li>
<li>Validate the usage request by all the agents.</li>
<li>Trigger rating for each agent in order of their dependencies.</li>
</ol>
<p><img src="USE-CASES/UC-05/../UC-02/rating-bpm.svg" alt="Diagram depicting the product usage process" /></p>
<h3 id="bundle-product-rating"><a class="header" href="#bundle-product-rating">Bundle product rating</a></h3>
<p><img src="USE-CASES/UC-05/./rating-bpm.svg" alt="Diagram depicting the rating process of a bundle product" /></p>
<h3 id="legend-4"><a class="header" href="#legend-4">Legend</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Term</th><th>description</th></tr></thead><tbody>
<tr><td><em>Party</em></td><td>A customer that has subscribed to a product</td></tr>
<tr><td><em>Vendor/Partner</em></td><td>An entity that sells products provided by another entity through a partnership agreement</td></tr>
<tr><td><em>Client SDK</em></td><td>The application from which the product are used</td></tr>
<tr><td><em>Product Offer</em></td><td>A product offering represents entities that are orderable from the provider of the catalog</td></tr>
<tr><td><em>Product</em></td><td>An instantiated offer for a specific party</td></tr>
<tr><td><em>Rating agent</em></td><td>The contract for the rating</td></tr>
<tr><td><em>Actor</em></td><td>An instantiated <em>Rating Agent</em></td></tr>
<tr><td><em>Rating coordinator</em></td><td>A component responsible for orchestrating the rating requests to different <em>Rating Agents</em></td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="uc-06-cqrs---usage-proof-command"><a class="header" href="#uc-06-cqrs---usage-proof-command">UC-06: CQRS - Usage Proof command</a></h1>
<p>In the context of the <em>distributed rating</em> system, <em>event sourcing</em> plays a
vital role in ensuring a reliable and accurate log of product usage events.
This log serves as a foundation for auditing, monitoring, and enhancing
the performance, scalability, and responsiveness of the system.</p>
<p>While the <strong>Edge</strong> handles the collection, storage, and computation of
necessary information for the <em>rating</em> procedure, it is essential to maintain
records of product usage to be consistent throughout the entirety of the system.</p>
<p>The <strong>Cloud</strong> takes responsibility for persisting the records propagated by
the <em>Edge</em> and performing data consolidation over multiple sources.
Thus eliminating the need for synchronizing the data model and the
business domain, while also enabling future compensating actions.</p>
<h2 id="business-processes-5"><a class="header" href="#business-processes-5">Business processes</a></h2>
<h3 id="product-usage-overview-4"><a class="header" href="#product-usage-overview-4">Product usage overview</a></h3>
<p>The process of product usage in the <em>distributed rating</em> system, which is
illustrated in the model below, begins with the client request going through
the <em>Rating Coordinator</em> and each <em>Rating Agent</em> before finally issuing
the <em>Usage Proof</em>, which is collected and stored by the <em>Usage Collector</em>,
focusing on the crucial role of the <em>Rating Coordinator</em> in decoupling
the <em>Rating Agent</em> and standardizing the communication between them.</p>
<p>Also, the process model illustrates the iterative approach used by
the <em>Usage Collector</em> to carry out its main three tasks:</p>
<ol>
<li>Construct the agent dependency graph, by recursively quering each agent for its dependencies.</li>
<li>Validate the usage request by all the agents.</li>
<li>Trigger rating for each agent in order of their dependencies.</li>
</ol>
<p><img src="USE-CASES/UC-06/../UC-02/rating-bpm.svg" alt="Diagram depicting the product usage process" /></p>
<h3 id="usage-proof-command-propagation"><a class="header" href="#usage-proof-command-propagation">Usage Proof command propagation</a></h3>
<p>The <em>Usage proof</em> is the command that outlines a product usage event.</p>
<p><img src="USE-CASES/UC-06/./rating-bpm.svg" alt="Diagram depicting the Usage Proof propagation process" /></p>
<div id="admonition-vendor-use-case" class="admonition admonish-example">
<div class="admonition-title">
<p>Vendor Use case</p>
<p><a class="admonition-anchor-link" href="USE-CASES/UC-06/index.html#admonition-vendor-use-case"></a></p>
</div>
<div>
<p><strong>As a</strong> vendor providing products <em>over IP</em> through a <em>Teleco provider</em><br />
<strong>I want to</strong> collect all <em>Usage Proof</em> generated by the <em>Edge</em>
<strong>so that I can</strong> calculate charges of the products based on usage<br />
<strong>and</strong> have the ability to analyse the usage data</p>
</div>
</div>
<h4 id="scenario-rating-agent-issues-a-usage-proof"><a class="header" href="#scenario-rating-agent-issues-a-usage-proof">Scenario: Rating Agent issues a Usage Proof</a></h4>
<blockquote>
<p><strong>Given</strong> the <em>Rating Agent</em> had received a valid usage request
<strong>And</strong> generated a <em>Usage Proof</em></p>
<p><strong>When</strong> querying the <em>Usage Collector</em> at the <em>Cloud</em> side for the last record</p>
<p><strong>Then</strong> it should respond with the correct <em>Usage Proof</em> generated by the <em>Edge</em></p>
</blockquote>
<h3 id="legend-5"><a class="header" href="#legend-5">Legend</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Term</th><th>description</th></tr></thead><tbody>
<tr><td><em>Party</em></td><td>A customer that has subscribed to a product</td></tr>
<tr><td><em>Vendor/Partner</em></td><td>An entity that sells products provided by another entity through a partnership agreement</td></tr>
<tr><td><em>Client SDK</em></td><td>The application from which the product are used</td></tr>
<tr><td><em>Product Offer</em></td><td>A product offering represents entities that are orderable from the provider of the catalog</td></tr>
<tr><td><em>Product</em></td><td>An instantiated offer for a specific party</td></tr>
<tr><td><em>Rating agent</em></td><td>The contract for the rating</td></tr>
<tr><td><em>Actor</em></td><td>An instantiated <em>Rating Agent</em></td></tr>
<tr><td><em>Rating coordinator</em></td><td>A component responsible for orchestrating the rating requests to different <em>Rating Agents</em></td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="overview-of-metaverse-distributed-rating"><a class="header" href="#overview-of-metaverse-distributed-rating">Overview of MetaVerse distributed rating</a></h1>
<div id="admonition-pertaining-to" class="admonition admonish-abstract">
<div class="admonition-title">
<p>Pertaining to</p>
<p><a class="admonition-anchor-link" href="USE-CASES/UC-07/index.html#admonition-pertaining-to"></a></p>
</div>
<div>
<ul>
<li>Customer account type: <strong>B2B</strong></li>
<li>Product offer type: <strong>Bundle</strong></li>
</ul>
</div>
</div>
<div id="admonition-enter-room-use-case" class="admonition admonish-example">
<div class="admonition-title">
<p>Enter Room Use case</p>
<p><a class="admonition-anchor-link" href="USE-CASES/UC-07/index.html#admonition-enter-room-use-case"></a></p>
</div>
<div>
<p><strong>As a</strong> <em>Teleco provider</em>  providing ads <em>over the MetaVerse</em><br />
<strong>I want to</strong> avail virtual rooms where people can watch ads and movies
<strong>so that I can</strong> control the number of avatars entering a virtual room
And offer ads services to advertisers</p>
</div>
</div>
<div id="admonition-watch-ad-use-case" class="admonition admonish-example">
<div class="admonition-title">
<p>Watch Ad Use case</p>
<p><a class="admonition-anchor-link" href="USE-CASES/UC-07/index.html#admonition-watch-ad-use-case"></a></p>
</div>
<div>
<p><strong>As a</strong> Teleco Provider<br />
<strong>I want to</strong> offer advertisement as a service through viewing it to the avatars in a virtual room
<strong>and</strong> rate the views of ads<br />
<strong>so that</strong> I can charge the advertisers for the viewed ads and leverage the benefits from the MetaVerse</p>
</div>
</div>
<h2 id="product-composition-1"><a class="header" href="#product-composition-1">Product composition</a></h2>
<p>In this use case, we are managing one offer with two related products. The first product is the virtual room and the second product is the advertisement viewed in these rooms.</p>
<p>Unlike other use cases, the products are provided by the teleco provider.
The customer of the teleco provider is the advertising company. while the user of the service is the avatar entering the room and watching the advertisement.
Each virtual room has a capacity for the number of avatars that can enter the room. Once the quota is reached the room is closed. The advertiser should be able to avail a room again by recharging his balance for the virtual room.
Balance recharge is out of scope for this release.</p>
<p>Once avatar enters the room, they can watch an advertisement, these views are then charged to the advertisers account.</p>
<pre class="mermaid">%%{init: {'theme': 'base', 'themeVariables': {
  'lineColor': '#a8201a',
  'primaryColor': '#fae5c7',
  'primaryBorderColor': '#0f8b8d'
}}}%%
flowchart LR
  meta(MetaVerse Bundle)
  room(Virtual Room)
  ads(Advertisements)

  meta --&gt; room
  meta --&gt; ads

classDef domain fill:#fffff7
class meta domain

classDef offer fill:#d6e8d5
class room offer
class ads offer
</pre>
<h2 id="business-processes-6"><a class="header" href="#business-processes-6">Business processes</a></h2>
<p>there's no change in the business process for rating as the rating logic is the same</p>
<?xml version="1.0" encoding="UTF-8"?>
<!-- Do not edit this file with editors other than draw.io -->
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<p><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="861px" height="802px" viewBox="-0.5 -0.5 861 802" content="&lt;mxfile host=&quot;Electron&quot; modified=&quot;2024-01-21T21:56:12.609Z&quot; agent=&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) draw.io/22.1.21 Chrome/120.0.6099.109 Electron/28.1.0 Safari/537.36&quot; etag=&quot;MEPaSw2a827nEx026XUd&quot; version=&quot;22.1.21&quot; type=&quot;device&quot;&gt;&#10;  &lt;diagram name=&quot;Page-1&quot; id=&quot;EluNH7dTlYd5i1NG8PyD&quot;&gt;&#10;    &lt;mxGraphModel dx=&quot;553&quot; dy=&quot;413&quot; grid=&quot;1&quot; gridSize=&quot;10&quot; guides=&quot;1&quot; tooltips=&quot;1&quot; connect=&quot;1&quot; arrows=&quot;1&quot; fold=&quot;1&quot; page=&quot;1&quot; pageScale=&quot;1&quot; pageWidth=&quot;1600&quot; pageHeight=&quot;1200&quot; math=&quot;0&quot; shadow=&quot;0&quot;&gt;&#10;      &lt;root&gt;&#10;        &lt;mxCell id=&quot;0&quot; /&gt;&#10;        &lt;mxCell id=&quot;1&quot; parent=&quot;0&quot; /&gt;&#10;        &lt;mxCell id=&quot;XcGYwYxuShUCubh08BWd-2&quot; value=&quot;&quot; style=&quot;rounded=1;whiteSpace=wrap;html=1;strokeColor=#0066CC;fontColor=#143642;fillColor=default;dashed=1;absoluteArcSize=1;strokeWidth=1;dropTarget=1;fontStyle=1;align=left;verticalAlign=top;fontSize=16;spacingLeft=4;labelBackgroundColor=none;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;20&quot; y=&quot;410&quot; width=&quot;850&quot; height=&quot;390&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;XcGYwYxuShUCubh08BWd-1&quot; value=&quot;&quot; style=&quot;rounded=1;whiteSpace=wrap;html=1;strokeColor=#0066CC;fontColor=#143642;fillColor=default;dashed=1;absoluteArcSize=1;strokeWidth=1;dropTarget=1;fontStyle=1;align=left;verticalAlign=top;fontSize=16;spacingLeft=4;labelBackgroundColor=none;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;15&quot; y=&quot;415&quot; width=&quot;850&quot; height=&quot;390&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;CSb4gJTQkcSrw3-_E3FB-11&quot; value=&quot;Provider sub-lattice&quot; style=&quot;rounded=1;whiteSpace=wrap;html=1;strokeColor=#0066CC;fontColor=#143642;fillColor=default;dashed=1;absoluteArcSize=1;strokeWidth=1;dropTarget=1;fontStyle=1;align=left;verticalAlign=top;fontSize=16;spacingLeft=4;labelBackgroundColor=none;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;10&quot; y=&quot;420&quot; width=&quot;850&quot; height=&quot;390&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;CSb4gJTQkcSrw3-_E3FB-10&quot; value=&quot;Common sub-lattice&quot; style=&quot;rounded=1;whiteSpace=wrap;html=1;strokeColor=#00CC00;fontColor=#143642;fillColor=default;dashed=1;absoluteArcSize=1;strokeWidth=1;dropTarget=1;labelPosition=center;verticalLabelPosition=middle;align=left;verticalAlign=top;spacingTop=0;spacingLeft=4;labelBackgroundColor=none;fontSize=16;fontStyle=1&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;10&quot; y=&quot;190&quot; width=&quot;850&quot; height=&quot;210&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;CSb4gJTQkcSrw3-_E3FB-1&quot; value=&quot;Client&amp;amp;nbsp;SDK&quot; style=&quot;swimlane;html=1;startSize=40;fontStyle=1;collapsible=0;horizontal=0;swimlaneLine=1;swimlaneFillColor=#ffffff;strokeWidth=2;whiteSpace=wrap;fillColor=#FAE5C7;strokeColor=#0F8B8D;fontSize=16;fontColor=#143642;labelBackgroundColor=none;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;20&quot; y=&quot;10&quot; width=&quot;830&quot; height=&quot;170&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;CSb4gJTQkcSrw3-_E3FB-2&quot; value=&quot;&amp;lt;span style=&amp;quot;font-size: 14px;&amp;quot;&amp;gt;&amp;lt;font style=&amp;quot;font-size: 14px;&amp;quot;&amp;gt;Request&amp;lt;br style=&amp;quot;font-size: 14px;&amp;quot;&amp;gt;product&amp;lt;/font&amp;gt;&amp;lt;/span&amp;gt;&quot; style=&quot;points=[[0.25,0,0],[0.5,0,0],[0.75,0,0],[1,0.25,0],[1,0.5,0],[1,0.75,0],[0.75,1,0],[0.5,1,0],[0.25,1,0],[0,0.75,0],[0,0.5,0],[0,0.25,0]];shape=mxgraph.bpmn.task;whiteSpace=wrap;rectStyle=rounded;size=10;html=1;container=1;expand=0;collapsible=0;taskMarker=user;strokeColor=#0F8B8D;fontColor=#143642;fillColor=#FAE5C7;align=right;verticalAlign=top;spacingTop=-2;spacing=2;spacingRight=2;fontSize=14;labelBackgroundColor=none;fontStyle=1&quot; parent=&quot;CSb4gJTQkcSrw3-_E3FB-1&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;170&quot; y=&quot;20&quot; width=&quot;150&quot; height=&quot;130&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;CSb4gJTQkcSrw3-_E3FB-3&quot; value=&quot;Request access to &amp;lt;br&amp;gt;product available in the customer inventory&quot; style=&quot;text;align=center;verticalAlign=middle;resizable=1;points=[];autosize=0;strokeColor=none;fillColor=none;fontColor=#143642;expand=0;resizeWidth=1;resizeHeight=1;labelPosition=center;verticalLabelPosition=middle;overflow=width;comic=0;html=1;whiteSpace=wrap;spacing=2;spacingLeft=0;perimeterSpacing=1;connectable=0;allowArrows=0;recursiveResize=0;fixedWidth=1;backgroundOutline=0;dropTarget=1;container=0;collapsible=0;enumerate=0;treeMoving=0;treeFolding=0;part=1;fixDash=0;portConstraintRotation=0;labelPadding=0;noLabel=0;shadow=0;spacingBottom=0;labelBackgroundColor=none;&quot; parent=&quot;CSb4gJTQkcSrw3-_E3FB-2&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry y=&quot;40&quot; width=&quot;150&quot; height=&quot;90&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;CSb4gJTQkcSrw3-_E3FB-4&quot; style=&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;entryPerimeter=0;strokeColor=#A8201A;fontColor=default;fillColor=#FAE5C7;exitX=1;exitY=0.5;exitDx=0;exitDy=0;exitPerimeter=0;labelBackgroundColor=none;&quot; parent=&quot;CSb4gJTQkcSrw3-_E3FB-1&quot; source=&quot;CSb4gJTQkcSrw3-_E3FB-5&quot; target=&quot;CSb4gJTQkcSrw3-_E3FB-2&quot; edge=&quot;1&quot;&gt;&#10;          &lt;mxGeometry relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&#10;            &lt;mxPoint x=&quot;110&quot; y=&quot;85&quot; as=&quot;sourcePoint&quot; /&gt;&#10;          &lt;/mxGeometry&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;CSb4gJTQkcSrw3-_E3FB-5&quot; value=&quot;&amp;lt;span style=&amp;quot;font-size: 14px; text-align: right;&amp;quot;&amp;gt;Use&amp;lt;br&amp;gt;Product&amp;lt;br&amp;gt;&amp;lt;/span&amp;gt;&quot; style=&quot;points=[[0.145,0.145,0],[0.5,0,0],[0.855,0.145,0],[1,0.5,0],[0.855,0.855,0],[0.5,1,0],[0.145,0.855,0],[0,0.5,0]];shape=mxgraph.bpmn.event;html=1;verticalLabelPosition=top;labelBackgroundColor=none;verticalAlign=bottom;align=center;perimeter=ellipsePerimeter;outlineConnect=0;aspect=fixed;outline=standard;symbol=general;strokeColor=#0F8B8D;spacingRight=2;spacingTop=-2;spacing=2;fontFamily=Helvetica;fontSize=14;fontColor=#143642;fillColor=#FAE5C7;fontStyle=1;labelPosition=center;&quot; parent=&quot;CSb4gJTQkcSrw3-_E3FB-1&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;70&quot; y=&quot;60&quot; width=&quot;50&quot; height=&quot;50&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;CSb4gJTQkcSrw3-_E3FB-6&quot; value=&quot;Grant&amp;lt;br&amp;gt;Request&quot; style=&quot;points=[[0.145,0.145,0],[0.5,0,0],[0.855,0.145,0],[1,0.5,0],[0.855,0.855,0],[0.5,1,0],[0.145,0.855,0],[0,0.5,0]];shape=mxgraph.bpmn.event;html=1;verticalLabelPosition=top;labelBackgroundColor=none;verticalAlign=bottom;align=center;perimeter=ellipsePerimeter;outlineConnect=0;aspect=fixed;outline=end;symbol=terminate;strokeColor=#0F8B8D;spacingRight=2;spacingTop=-2;spacing=2;fontFamily=Helvetica;fontSize=14;fontColor=#143642;fillColor=#FAE5C7;fontStyle=1;labelPosition=center;&quot; parent=&quot;CSb4gJTQkcSrw3-_E3FB-1&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;765&quot; y=&quot;60&quot; width=&quot;50&quot; height=&quot;50&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;CSb4gJTQkcSrw3-_E3FB-7&quot; value=&quot;Deny&amp;lt;br&amp;gt;Request&quot; style=&quot;points=[[0.145,0.145,0],[0.5,0,0],[0.855,0.145,0],[1,0.5,0],[0.855,0.855,0],[0.5,1,0],[0.145,0.855,0],[0,0.5,0]];shape=mxgraph.bpmn.event;html=1;verticalLabelPosition=top;labelBackgroundColor=none;verticalAlign=bottom;align=center;perimeter=ellipsePerimeter;outlineConnect=0;aspect=fixed;outline=throwing;symbol=terminate;strokeColor=#0F8B8D;spacingRight=2;spacingTop=-2;spacing=2;fontFamily=Helvetica;fontSize=14;fontColor=#143642;fillColor=#CC0000;fontStyle=1;labelPosition=center;&quot; parent=&quot;CSb4gJTQkcSrw3-_E3FB-1&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;510&quot; y=&quot;70&quot; width=&quot;50&quot; height=&quot;50&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;H9wIqJy1WsTbgoQq8iAG-20&quot; value=&quot;Rating Coordinator&quot; style=&quot;swimlane;html=1;startSize=40;fontStyle=1;collapsible=0;horizontal=0;swimlaneLine=1;swimlaneFillColor=#ffffff;strokeWidth=2;whiteSpace=wrap;fillColor=#FAE5C7;strokeColor=#0F8B8D;fontSize=16;fontColor=#143642;labelBackgroundColor=none;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;20&quot; y=&quot;220&quot; width=&quot;830&quot; height=&quot;170&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;H9wIqJy1WsTbgoQq8iAG-37&quot; value=&quot;Map&amp;lt;br&amp;gt;validation request&quot; style=&quot;points=[[0.25,0,0],[0.5,0,0],[0.75,0,0],[1,0.25,0],[1,0.5,0],[1,0.75,0],[0.75,1,0],[0.5,1,0],[0.25,1,0],[0,0.75,0],[0,0.5,0],[0,0.25,0]];shape=mxgraph.bpmn.task;whiteSpace=wrap;rectStyle=rounded;size=10;html=1;container=1;expand=0;collapsible=0;taskMarker=service;strokeColor=#0F8B8D;align=right;verticalAlign=top;spacingRight=2;spacingTop=-2;spacing=2;fontFamily=Helvetica;fontSize=14;fontColor=#143642;fillColor=#FAE5C7;fontStyle=1;labelBackgroundColor=none;isLoopStandard=1;&quot; parent=&quot;H9wIqJy1WsTbgoQq8iAG-20&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;330&quot; y=&quot;20&quot; width=&quot;150&quot; height=&quot;130&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;2V-k9b7Of0vOiElkNpLe-6&quot; value=&quot;Launch an actor to validate product access request from vendor specified by&amp;lt;b&amp;gt; agentId&amp;lt;/b&amp;gt;&quot; style=&quot;text;align=center;verticalAlign=middle;resizable=1;points=[];autosize=0;strokeColor=none;fillColor=none;fontColor=#143642;expand=0;resizeWidth=1;resizeHeight=1;labelPosition=center;verticalLabelPosition=middle;overflow=width;comic=0;html=1;whiteSpace=wrap;spacing=2;spacingLeft=0;perimeterSpacing=1;connectable=0;allowArrows=0;recursiveResize=0;fixedWidth=1;backgroundOutline=0;dropTarget=1;container=0;collapsible=0;enumerate=0;treeMoving=0;treeFolding=0;part=1;fixDash=0;portConstraintRotation=0;labelPadding=0;noLabel=0;shadow=0;spacingBottom=0;labelBackgroundColor=none;&quot; parent=&quot;H9wIqJy1WsTbgoQq8iAG-37&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry y=&quot;40&quot; width=&quot;150&quot; height=&quot;90&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;RC6_R4l4PvLP9drjIyFx-1&quot; value=&quot;&quot; style=&quot;points=[[0.25,0.25,0],[0.5,0,0],[0.75,0.25,0],[1,0.5,0],[0.75,0.75,0],[0.5,1,0],[0.25,0.75,0],[0,0.5,0]];shape=mxgraph.bpmn.gateway2;html=1;verticalLabelPosition=bottom;labelBackgroundColor=#ffffff;verticalAlign=top;align=center;perimeter=rhombusPerimeter;outlineConnect=0;outline=end;symbol=multiple;gwType=exclusive;strokeColor=#0F8B8D;fontColor=#143642;fillColor=#FAE5C7;&quot; parent=&quot;H9wIqJy1WsTbgoQq8iAG-20&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;510&quot; y=&quot;60&quot; width=&quot;50&quot; height=&quot;50&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;5D4KkuWofmy4c6DjsZ8o-1&quot; value=&quot;Map&amp;lt;br&amp;gt;rating request&quot; style=&quot;points=[[0.25,0,0],[0.5,0,0],[0.75,0,0],[1,0.25,0],[1,0.5,0],[1,0.75,0],[0.75,1,0],[0.5,1,0],[0.25,1,0],[0,0.75,0],[0,0.5,0],[0,0.25,0]];shape=mxgraph.bpmn.task;whiteSpace=wrap;rectStyle=rounded;size=10;html=1;container=1;expand=0;collapsible=0;taskMarker=service;strokeColor=#0F8B8D;align=right;verticalAlign=top;spacingRight=2;spacingTop=-2;spacing=2;fontFamily=Helvetica;fontSize=14;fontColor=#143642;fillColor=#FAE5C7;fontStyle=1;labelBackgroundColor=none;isLoopStandard=1;&quot; parent=&quot;H9wIqJy1WsTbgoQq8iAG-20&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;590&quot; y=&quot;20&quot; width=&quot;150&quot; height=&quot;130&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;2V-k9b7Of0vOiElkNpLe-8&quot; value=&quot;Launch an actor to rate product usage request&amp;lt;br&amp;gt;from vendor specified by&amp;lt;b&amp;gt; agentId&amp;lt;/b&amp;gt;&quot; style=&quot;text;align=center;verticalAlign=middle;resizable=1;points=[];autosize=0;strokeColor=none;fillColor=none;fontColor=#143642;expand=0;resizeWidth=1;resizeHeight=1;labelPosition=center;verticalLabelPosition=middle;overflow=width;comic=0;html=1;whiteSpace=wrap;spacing=2;spacingLeft=0;perimeterSpacing=1;connectable=0;allowArrows=0;recursiveResize=0;fixedWidth=1;backgroundOutline=0;dropTarget=1;container=0;collapsible=0;enumerate=0;treeMoving=0;treeFolding=0;part=1;fixDash=0;portConstraintRotation=0;labelPadding=0;noLabel=0;shadow=0;spacingBottom=0;labelBackgroundColor=none;&quot; parent=&quot;5D4KkuWofmy4c6DjsZ8o-1&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry y=&quot;40&quot; width=&quot;150&quot; height=&quot;90&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;XlSFW_zMMT_4rZLBOJMZ-24&quot; value=&quot;&quot; style=&quot;points=[[0.25,0.25,0],[0.5,0,0],[0.75,0.25,0],[1,0.5,0],[0.75,0.75,0],[0.5,1,0],[0.25,0.75,0],[0,0.5,0]];shape=mxgraph.bpmn.gateway2;html=1;verticalLabelPosition=top;labelBackgroundColor=none;verticalAlign=bottom;align=center;perimeter=rhombusPerimeter;outlineConnect=0;outline=end;symbol=multiple;strokeColor=#0F8B8D;fontColor=#143642;fillColor=#FAE5C7;gwType=exclusive;labelPosition=center;&quot; parent=&quot;H9wIqJy1WsTbgoQq8iAG-20&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;250&quot; y=&quot;60&quot; width=&quot;50&quot; height=&quot;50&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;XlSFW_zMMT_4rZLBOJMZ-26&quot; style=&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;entryPerimeter=0;strokeColor=#A8201A;fontColor=#143642;fillColor=#FAE5C7;exitX=1;exitY=0.5;exitDx=0;exitDy=0;exitPerimeter=0;&quot; parent=&quot;H9wIqJy1WsTbgoQq8iAG-20&quot; source=&quot;XlSFW_zMMT_4rZLBOJMZ-24&quot; target=&quot;H9wIqJy1WsTbgoQq8iAG-37&quot; edge=&quot;1&quot;&gt;&#10;          &lt;mxGeometry relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&#10;            &lt;Array as=&quot;points&quot;&gt;&#10;              &lt;mxPoint x=&quot;300&quot; y=&quot;85&quot; /&gt;&#10;              &lt;mxPoint x=&quot;300&quot; y=&quot;85&quot; /&gt;&#10;            &lt;/Array&gt;&#10;          &lt;/mxGeometry&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;Cu19zfJf6sVKhaqU7VQs-3&quot; value=&quot;yes&quot; style=&quot;edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontColor=#143642;labelBackgroundColor=none;&quot; parent=&quot;XlSFW_zMMT_4rZLBOJMZ-26&quot; vertex=&quot;1&quot; connectable=&quot;0&quot;&gt;&#10;          &lt;mxGeometry x=&quot;-0.7333&quot; relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&#10;            &lt;mxPoint x=&quot;4&quot; y=&quot;-11&quot; as=&quot;offset&quot; /&gt;&#10;          &lt;/mxGeometry&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;XlSFW_zMMT_4rZLBOJMZ-5&quot; value=&quot;Build provider&amp;lt;br&amp;gt;dependency graph&quot; style=&quot;points=[[0.25,0,0],[0.5,0,0],[0.75,0,0],[1,0.25,0],[1,0.5,0],[1,0.75,0],[0.75,1,0],[0.5,1,0],[0.25,1,0],[0,0.75,0],[0,0.5,0],[0,0.25,0]];shape=mxgraph.bpmn.task;whiteSpace=wrap;rectStyle=rounded;size=10;html=1;container=1;expand=0;collapsible=0;taskMarker=service;strokeColor=#0F8B8D;align=right;verticalAlign=top;spacingRight=2;spacingTop=-2;spacing=2;fontFamily=Helvetica;fontSize=14;fontColor=#143642;fillColor=#FAE5C7;fontStyle=1;labelBackgroundColor=none;isLoopStandard=1;&quot; parent=&quot;H9wIqJy1WsTbgoQq8iAG-20&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;70&quot; y=&quot;20&quot; width=&quot;150&quot; height=&quot;130&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;XlSFW_zMMT_4rZLBOJMZ-6&quot; value=&quot;Recursively call providers agents and build the dependency graph for validation and rating&amp;amp;nbsp;&quot; style=&quot;text;align=center;verticalAlign=middle;resizable=1;points=[];autosize=0;strokeColor=none;fillColor=none;fontColor=#143642;expand=0;resizeWidth=1;resizeHeight=1;labelPosition=center;verticalLabelPosition=middle;overflow=width;comic=0;html=1;whiteSpace=wrap;spacing=2;spacingLeft=0;perimeterSpacing=1;connectable=0;allowArrows=0;recursiveResize=0;fixedWidth=1;backgroundOutline=0;dropTarget=1;container=0;collapsible=0;enumerate=0;treeMoving=0;treeFolding=0;part=1;fixDash=0;portConstraintRotation=0;labelPadding=0;noLabel=0;shadow=0;spacingBottom=0;labelBackgroundColor=none;&quot; parent=&quot;XlSFW_zMMT_4rZLBOJMZ-5&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry y=&quot;40&quot; width=&quot;150&quot; height=&quot;90&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;XlSFW_zMMT_4rZLBOJMZ-30&quot; value=&quot;Recursive&quot; style=&quot;html=1;shape=mxgraph.flowchart.annotation_2;align=left;labelPosition=right;strokeColor=#0F8B8D;fontColor=#143642;fillColor=#FAE5C7;flipV=1;flipH=0;verticalLabelPosition=middle;verticalAlign=middle;&quot; parent=&quot;XlSFW_zMMT_4rZLBOJMZ-5&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;150&quot; y=&quot;5&quot; width=&quot;30&quot; height=&quot;17&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;Cu19zfJf6sVKhaqU7VQs-1&quot; style=&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;entryPerimeter=0;strokeColor=#A8201A;fontColor=#143642;fillColor=#FAE5C7;exitX=0;exitY=0.5;exitDx=0;exitDy=0;exitPerimeter=0;&quot; parent=&quot;H9wIqJy1WsTbgoQq8iAG-20&quot; source=&quot;XlSFW_zMMT_4rZLBOJMZ-24&quot; target=&quot;XlSFW_zMMT_4rZLBOJMZ-5&quot; edge=&quot;1&quot;&gt;&#10;          &lt;mxGeometry relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&#10;            &lt;Array as=&quot;points&quot;&gt;&#10;              &lt;mxPoint x=&quot;240&quot; y=&quot;85&quot; /&gt;&#10;            &lt;/Array&gt;&#10;          &lt;/mxGeometry&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;Cu19zfJf6sVKhaqU7VQs-2&quot; value=&quot;no&quot; style=&quot;edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontColor=#143642;labelBackgroundColor=none;&quot; parent=&quot;Cu19zfJf6sVKhaqU7VQs-1&quot; vertex=&quot;1&quot; connectable=&quot;0&quot;&gt;&#10;          &lt;mxGeometry x=&quot;0.3733&quot; y=&quot;-1&quot; relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&#10;            &lt;mxPoint x=&quot;12&quot; y=&quot;-10&quot; as=&quot;offset&quot; /&gt;&#10;          &lt;/mxGeometry&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;Cu19zfJf6sVKhaqU7VQs-18&quot; style=&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;entryPerimeter=0;strokeColor=#A8201A;fontColor=#143642;fillColor=#FAE5C7;&quot; parent=&quot;H9wIqJy1WsTbgoQq8iAG-20&quot; source=&quot;RC6_R4l4PvLP9drjIyFx-1&quot; target=&quot;5D4KkuWofmy4c6DjsZ8o-1&quot; edge=&quot;1&quot;&gt;&#10;          &lt;mxGeometry relative=&quot;1&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;Cu19zfJf6sVKhaqU7VQs-19&quot; value=&quot;yes&quot; style=&quot;edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontColor=#143642;&quot; parent=&quot;Cu19zfJf6sVKhaqU7VQs-18&quot; vertex=&quot;1&quot; connectable=&quot;0&quot;&gt;&#10;          &lt;mxGeometry x=&quot;-0.74&quot; relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&#10;            &lt;mxPoint x=&quot;1&quot; y=&quot;-11&quot; as=&quot;offset&quot; /&gt;&#10;          &lt;/mxGeometry&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;H9wIqJy1WsTbgoQq8iAG-21&quot; value=&quot;Rating Agent&quot; style=&quot;swimlane;html=1;startSize=40;fontStyle=1;collapsible=0;horizontal=0;swimlaneLine=1;swimlaneFillColor=#ffffff;strokeWidth=2;whiteSpace=wrap;fillColor=#FAE5C7;strokeColor=#0F8B8D;fontSize=16;fontColor=#143642;labelBackgroundColor=none;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;20&quot; y=&quot;450&quot; width=&quot;830&quot; height=&quot;170&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;-H_9ynkZV_lR2sOKHlfc-2&quot; value=&quot;Apply&amp;lt;br&amp;gt;validation rules&quot; style=&quot;points=[[0.25,0,0],[0.5,0,0],[0.75,0,0],[1,0.25,0],[1,0.5,0],[1,0.75,0],[0.75,1,0],[0.5,1,0],[0.25,1,0],[0,0.75,0],[0,0.5,0],[0,0.25,0]];shape=mxgraph.bpmn.task;whiteSpace=wrap;rectStyle=rounded;size=10;html=1;container=1;expand=0;collapsible=0;taskMarker=businessRule;strokeColor=#0F8B8D;align=right;verticalAlign=top;spacingRight=2;spacingTop=-2;spacing=2;fontFamily=Helvetica;fontSize=14;fontColor=#143642;fillColor=#FAE5C7;fontStyle=1;labelBackgroundColor=none;&quot; parent=&quot;H9wIqJy1WsTbgoQq8iAG-21&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;330&quot; y=&quot;20&quot; width=&quot;150&quot; height=&quot;130&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;2V-k9b7Of0vOiElkNpLe-7&quot; value=&quot;Check access request against vendor specific rules for a customer specified by &amp;lt;b&amp;gt;partyId&amp;lt;/b&amp;gt;&quot; style=&quot;text;align=center;verticalAlign=middle;resizable=1;points=[];autosize=0;strokeColor=none;fillColor=none;fontColor=#143642;expand=0;resizeWidth=1;resizeHeight=1;labelPosition=center;verticalLabelPosition=middle;overflow=width;comic=0;html=1;whiteSpace=wrap;spacing=2;spacingLeft=0;perimeterSpacing=1;connectable=0;allowArrows=0;recursiveResize=0;fixedWidth=1;backgroundOutline=0;dropTarget=1;container=0;collapsible=0;enumerate=0;treeMoving=0;treeFolding=0;part=1;fixDash=0;portConstraintRotation=0;labelPadding=0;noLabel=0;shadow=0;spacingBottom=0;labelBackgroundColor=none;&quot; parent=&quot;-H_9ynkZV_lR2sOKHlfc-2&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry y=&quot;40&quot; width=&quot;150&quot; height=&quot;90&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;RC6_R4l4PvLP9drjIyFx-6&quot; value=&quot;Apply&amp;lt;br&amp;gt;rating rules&quot; style=&quot;points=[[0.25,0,0],[0.5,0,0],[0.75,0,0],[1,0.25,0],[1,0.5,0],[1,0.75,0],[0.75,1,0],[0.5,1,0],[0.25,1,0],[0,0.75,0],[0,0.5,0],[0,0.25,0]];shape=mxgraph.bpmn.task;whiteSpace=wrap;rectStyle=rounded;size=10;html=1;container=1;expand=0;collapsible=0;taskMarker=businessRule;strokeColor=#0F8B8D;align=right;verticalAlign=top;spacingRight=2;spacingTop=-2;spacing=2;fontFamily=Helvetica;fontSize=14;fontColor=#143642;fillColor=#FAE5C7;fontStyle=1;labelBackgroundColor=none;isLoopSub=1;bpmnShapeType=subprocess;&quot; parent=&quot;H9wIqJy1WsTbgoQq8iAG-21&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;590&quot; y=&quot;20&quot; width=&quot;150&quot; height=&quot;130&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;SiRncDUYllJjYxtJi7_F-1&quot; value=&quot;Create usage proof based on the rating process of current product offer&quot; style=&quot;text;align=center;verticalAlign=middle;resizable=1;points=[];autosize=0;strokeColor=none;fillColor=none;fontColor=#143642;expand=0;resizeWidth=1;resizeHeight=1;labelPosition=center;verticalLabelPosition=middle;overflow=width;comic=0;html=1;whiteSpace=wrap;spacing=2;spacingLeft=0;perimeterSpacing=1;connectable=0;allowArrows=0;recursiveResize=0;fixedWidth=1;backgroundOutline=0;dropTarget=1;container=0;collapsible=0;enumerate=0;treeMoving=0;treeFolding=0;part=1;fixDash=0;portConstraintRotation=0;labelPadding=0;noLabel=0;shadow=0;spacingBottom=0;labelBackgroundColor=none;&quot; parent=&quot;RC6_R4l4PvLP9drjIyFx-6&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry y=&quot;40&quot; width=&quot;150&quot; height=&quot;90&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;XlSFW_zMMT_4rZLBOJMZ-13&quot; value=&quot;&amp;lt;div&amp;gt;Get&amp;lt;br&amp;gt;partner&amp;amp;nbsp;&amp;lt;span style=&amp;quot;background-color: initial;&amp;quot;&amp;gt;providers&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&quot; style=&quot;points=[[0.25,0,0],[0.5,0,0],[0.75,0,0],[1,0.25,0],[1,0.5,0],[1,0.75,0],[0.75,1,0],[0.5,1,0],[0.25,1,0],[0,0.75,0],[0,0.5,0],[0,0.25,0]];shape=mxgraph.bpmn.task;whiteSpace=wrap;rectStyle=rounded;size=10;html=1;container=1;expand=0;collapsible=0;taskMarker=businessRule;strokeColor=#0F8B8D;align=right;verticalAlign=top;spacingRight=2;spacingTop=-2;spacing=2;fontFamily=Helvetica;fontSize=14;fontColor=#143642;fillColor=#FAE5C7;fontStyle=1;labelBackgroundColor=none;isLoopStandard=0;&quot; parent=&quot;H9wIqJy1WsTbgoQq8iAG-21&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;70&quot; y=&quot;20&quot; width=&quot;150&quot; height=&quot;130&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;XlSFW_zMMT_4rZLBOJMZ-14&quot; value=&quot;Return &amp;lt;b&amp;gt;agentId&amp;lt;/b&amp;gt; list of intermediate product providers&quot; style=&quot;text;align=center;verticalAlign=middle;resizable=1;points=[];autosize=0;strokeColor=none;fillColor=none;fontColor=#143642;expand=0;resizeWidth=1;resizeHeight=1;labelPosition=center;verticalLabelPosition=middle;overflow=width;comic=0;html=1;whiteSpace=wrap;spacing=2;spacingLeft=0;perimeterSpacing=1;connectable=0;allowArrows=0;recursiveResize=0;fixedWidth=1;backgroundOutline=0;dropTarget=1;container=0;collapsible=0;enumerate=0;treeMoving=0;treeFolding=0;part=1;fixDash=0;portConstraintRotation=0;labelPadding=0;noLabel=0;shadow=0;spacingBottom=0;labelBackgroundColor=none;&quot; parent=&quot;XlSFW_zMMT_4rZLBOJMZ-13&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry y=&quot;40&quot; width=&quot;150&quot; height=&quot;90&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;MW7wNo_Qlk7bcEILyiEd-6&quot; value=&quot;&quot; style=&quot;points=[[0.25,0.25,0],[0.5,0,0],[0.75,0.25,0],[1,0.5,0],[0.75,0.75,0],[0.5,1,0],[0.25,0.75,0],[0,0.5,0]];shape=mxgraph.bpmn.gateway2;html=1;verticalLabelPosition=bottom;labelBackgroundColor=#ffffff;verticalAlign=top;align=center;perimeter=rhombusPerimeter;outlineConnect=0;outline=none;symbol=none;gwType=parallel;strokeColor=#0F8B8D;fontColor=#143642;fillColor=#FAE5C7;&quot; parent=&quot;H9wIqJy1WsTbgoQq8iAG-21&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;765&quot; y=&quot;60&quot; width=&quot;50&quot; height=&quot;50&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;MW7wNo_Qlk7bcEILyiEd-8&quot; value=&quot;&quot; style=&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#A8201A;fontColor=#143642;fillColor=#FAE5C7;dashed=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;exitPerimeter=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;entryPerimeter=0;&quot; parent=&quot;H9wIqJy1WsTbgoQq8iAG-21&quot; source=&quot;RC6_R4l4PvLP9drjIyFx-6&quot; target=&quot;MW7wNo_Qlk7bcEILyiEd-6&quot; edge=&quot;1&quot;&gt;&#10;          &lt;mxGeometry relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&#10;            &lt;mxPoint x=&quot;775&quot; y=&quot;-260&quot; as=&quot;targetPoint&quot; /&gt;&#10;            &lt;mxPoint x=&quot;740&quot; y=&quot;105&quot; as=&quot;sourcePoint&quot; /&gt;&#10;          &lt;/mxGeometry&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;RC6_R4l4PvLP9drjIyFx-5&quot; style=&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#A8201A;fontColor=#143642;fillColor=#FAE5C7;dashed=1;entryX=0.5;entryY=1;entryDx=0;entryDy=0;entryPerimeter=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;exitPerimeter=0;&quot; parent=&quot;1&quot; source=&quot;-H_9ynkZV_lR2sOKHlfc-2&quot; target=&quot;RC6_R4l4PvLP9drjIyFx-1&quot; edge=&quot;1&quot;&gt;&#10;          &lt;mxGeometry relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&#10;            &lt;mxPoint x=&quot;555&quot; y=&quot;330&quot; as=&quot;targetPoint&quot; /&gt;&#10;          &lt;/mxGeometry&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;Cu19zfJf6sVKhaqU7VQs-10&quot; value=&quot;is valid&quot; style=&quot;edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontColor=#143642;&quot; parent=&quot;RC6_R4l4PvLP9drjIyFx-5&quot; vertex=&quot;1&quot; connectable=&quot;0&quot;&gt;&#10;          &lt;mxGeometry x=&quot;0.8299&quot; y=&quot;-1&quot; relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&#10;            &lt;mxPoint x=&quot;-1&quot; as=&quot;offset&quot; /&gt;&#10;          &lt;/mxGeometry&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;RC6_R4l4PvLP9drjIyFx-8&quot; style=&quot;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.83;entryY=0.001;entryDx=0;entryDy=0;entryPerimeter=0;strokeColor=#A8201A;fontColor=#143642;fillColor=#FAE5C7;dashed=1;edgeStyle=orthogonalEdgeStyle;exitX=0.829;exitY=0.999;exitDx=0;exitDy=0;exitPerimeter=0;&quot; parent=&quot;1&quot; source=&quot;H9wIqJy1WsTbgoQq8iAG-37&quot; target=&quot;-H_9ynkZV_lR2sOKHlfc-2&quot; edge=&quot;1&quot;&gt;&#10;          &lt;mxGeometry relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&#10;            &lt;mxPoint x=&quot;475&quot; y=&quot;450&quot; as=&quot;sourcePoint&quot; /&gt;&#10;          &lt;/mxGeometry&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;RC6_R4l4PvLP9drjIyFx-9&quot; style=&quot;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.831;entryY=0.001;entryDx=0;entryDy=0;entryPerimeter=0;strokeColor=#A8201A;fontColor=#143642;fillColor=#FAE5C7;dashed=1;edgeStyle=orthogonalEdgeStyle;exitX=0.831;exitY=1;exitDx=0;exitDy=0;exitPerimeter=0;&quot; parent=&quot;1&quot; source=&quot;5D4KkuWofmy4c6DjsZ8o-1&quot; target=&quot;RC6_R4l4PvLP9drjIyFx-6&quot; edge=&quot;1&quot;&gt;&#10;          &lt;mxGeometry relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&#10;            &lt;mxPoint x=&quot;735&quot; y=&quot;450&quot; as=&quot;sourcePoint&quot; /&gt;&#10;          &lt;/mxGeometry&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;RC6_R4l4PvLP9drjIyFx-13&quot; style=&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#A8201A;fontColor=#143642;fillColor=#FAE5C7;dashed=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;exitPerimeter=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;entryPerimeter=0;&quot; parent=&quot;1&quot; source=&quot;MW7wNo_Qlk7bcEILyiEd-6&quot; target=&quot;CSb4gJTQkcSrw3-_E3FB-6&quot; edge=&quot;1&quot;&gt;&#10;          &lt;mxGeometry relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&#10;            &lt;mxPoint x=&quot;810&quot; y=&quot;200&quot; as=&quot;targetPoint&quot; /&gt;&#10;            &lt;mxPoint x=&quot;715&quot; y=&quot;480&quot; as=&quot;sourcePoint&quot; /&gt;&#10;          &lt;/mxGeometry&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;RC6_R4l4PvLP9drjIyFx-15&quot; style=&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#A8201A;fontColor=#143642;fillColor=#FAE5C7;dashed=1;entryX=0.5;entryY=1;entryDx=0;entryDy=0;entryPerimeter=0;exitX=0.5;exitY=0;exitDx=0;exitDy=0;exitPerimeter=0;&quot; parent=&quot;1&quot; source=&quot;RC6_R4l4PvLP9drjIyFx-1&quot; target=&quot;CSb4gJTQkcSrw3-_E3FB-7&quot; edge=&quot;1&quot;&gt;&#10;          &lt;mxGeometry relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&#10;            &lt;mxPoint x=&quot;535&quot; y=&quot;200&quot; as=&quot;targetPoint&quot; /&gt;&#10;            &lt;Array as=&quot;points&quot;&gt;&#10;              &lt;mxPoint x=&quot;555&quot; y=&quot;170&quot; /&gt;&#10;              &lt;mxPoint x=&quot;555&quot; y=&quot;170&quot; /&gt;&#10;            &lt;/Array&gt;&#10;          &lt;/mxGeometry&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;Cu19zfJf6sVKhaqU7VQs-17&quot; value=&quot;no&quot; style=&quot;edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontColor=#143642;&quot; parent=&quot;RC6_R4l4PvLP9drjIyFx-15&quot; vertex=&quot;1&quot; connectable=&quot;0&quot;&gt;&#10;          &lt;mxGeometry x=&quot;-0.8493&quot; y=&quot;-1&quot; relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&#10;            &lt;mxPoint x=&quot;-10&quot; y=&quot;3&quot; as=&quot;offset&quot; /&gt;&#10;          &lt;/mxGeometry&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;XlSFW_zMMT_4rZLBOJMZ-4&quot; style=&quot;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.834;entryY=0;entryDx=0;entryDy=0;entryPerimeter=0;strokeColor=#A8201A;fontColor=#143642;fillColor=#FAE5C7;dashed=1;exitX=0.166;exitY=0.999;exitDx=0;exitDy=0;exitPerimeter=0;edgeStyle=orthogonalEdgeStyle;&quot; parent=&quot;1&quot; source=&quot;CSb4gJTQkcSrw3-_E3FB-2&quot; target=&quot;XlSFW_zMMT_4rZLBOJMZ-5&quot; edge=&quot;1&quot;&gt;&#10;          &lt;mxGeometry relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&#10;            &lt;mxPoint x=&quot;215.39999999999998&quot; y=&quot;160.26&quot; as=&quot;sourcePoint&quot; /&gt;&#10;            &lt;mxPoint x=&quot;215.29999999999995&quot; y=&quot;240.13&quot; as=&quot;targetPoint&quot; /&gt;&#10;          &lt;/mxGeometry&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;XlSFW_zMMT_4rZLBOJMZ-15&quot; style=&quot;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#A8201A;fontColor=#143642;fillColor=#FAE5C7;dashed=1;exitX=0.832;exitY=1;exitDx=0;exitDy=0;exitPerimeter=0;entryX=0.832;entryY=-0.001;entryDx=0;entryDy=0;entryPerimeter=0;edgeStyle=orthogonalEdgeStyle;&quot; parent=&quot;1&quot; source=&quot;XlSFW_zMMT_4rZLBOJMZ-5&quot; target=&quot;XlSFW_zMMT_4rZLBOJMZ-13&quot; edge=&quot;1&quot;&gt;&#10;          &lt;mxGeometry relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&#10;            &lt;mxPoint x=&quot;215&quot; y=&quot;450&quot; as=&quot;sourcePoint&quot; /&gt;&#10;            &lt;mxPoint x=&quot;170&quot; y=&quot;520&quot; as=&quot;targetPoint&quot; /&gt;&#10;          &lt;/mxGeometry&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;XlSFW_zMMT_4rZLBOJMZ-25&quot; style=&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=1;entryDx=0;entryDy=0;entryPerimeter=0;strokeColor=#A8201A;fontColor=#143642;fillColor=#FAE5C7;dashed=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;exitPerimeter=0;&quot; parent=&quot;1&quot; source=&quot;XlSFW_zMMT_4rZLBOJMZ-13&quot; target=&quot;XlSFW_zMMT_4rZLBOJMZ-24&quot; edge=&quot;1&quot;&gt;&#10;          &lt;mxGeometry relative=&quot;1&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;Cu19zfJf6sVKhaqU7VQs-15&quot; value=&quot;is empty list&quot; style=&quot;edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontColor=#143642;&quot; parent=&quot;XlSFW_zMMT_4rZLBOJMZ-25&quot; vertex=&quot;1&quot; connectable=&quot;0&quot;&gt;&#10;          &lt;mxGeometry x=&quot;0.6596&quot; relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&#10;            &lt;mxPoint y=&quot;-22&quot; as=&quot;offset&quot; /&gt;&#10;          &lt;/mxGeometry&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;MW7wNo_Qlk7bcEILyiEd-1&quot; value=&quot;Usage Collector&quot; style=&quot;swimlane;html=1;startSize=40;fontStyle=1;collapsible=0;horizontal=0;swimlaneLine=1;swimlaneFillColor=#ffffff;strokeWidth=2;whiteSpace=wrap;fillColor=#FAE5C7;strokeColor=#0F8B8D;fontSize=16;fontColor=#143642;labelBackgroundColor=none;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;20&quot; y=&quot;630&quot; width=&quot;830&quot; height=&quot;170&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;MW7wNo_Qlk7bcEILyiEd-2&quot; value=&quot;Store&amp;lt;br&amp;gt;rated usage&quot; style=&quot;points=[[0.25,0,0],[0.5,0,0],[0.75,0,0],[1,0.25,0],[1,0.5,0],[1,0.75,0],[0.75,1,0],[0.5,1,0],[0.25,1,0],[0,0.75,0],[0,0.5,0],[0,0.25,0]];shape=mxgraph.bpmn.task;whiteSpace=wrap;rectStyle=rounded;size=10;html=1;container=1;expand=0;collapsible=0;taskMarker=service;strokeColor=#0F8B8D;align=right;verticalAlign=top;spacingRight=2;spacingTop=-2;spacing=2;fontFamily=Helvetica;fontSize=14;fontColor=#143642;fillColor=#FAE5C7;fontStyle=1;labelBackgroundColor=none;bpmnShapeType=transaction;&quot; parent=&quot;MW7wNo_Qlk7bcEILyiEd-1&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;590&quot; y=&quot;20&quot; width=&quot;150&quot; height=&quot;130&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;MW7wNo_Qlk7bcEILyiEd-3&quot; value=&quot;&amp;amp;nbsp;Store usage proof for a customer specified by &amp;lt;b&amp;gt;partyId&amp;lt;/b&amp;gt;&quot; style=&quot;text;align=center;verticalAlign=middle;resizable=1;points=[];autosize=0;strokeColor=none;fillColor=none;fontColor=#143642;expand=0;resizeWidth=1;resizeHeight=1;labelPosition=center;verticalLabelPosition=middle;overflow=width;comic=0;html=1;whiteSpace=wrap;spacing=2;spacingLeft=0;perimeterSpacing=1;connectable=0;allowArrows=0;recursiveResize=0;fixedWidth=1;backgroundOutline=0;dropTarget=1;container=0;collapsible=0;enumerate=0;treeMoving=0;treeFolding=0;part=1;fixDash=0;portConstraintRotation=0;labelPadding=0;noLabel=0;shadow=0;spacingBottom=0;labelBackgroundColor=none;&quot; parent=&quot;MW7wNo_Qlk7bcEILyiEd-2&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry y=&quot;40&quot; width=&quot;150&quot; height=&quot;90&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;MW7wNo_Qlk7bcEILyiEd-4&quot; value=&quot;&quot; style=&quot;points=[[0.145,0.145,0],[0.5,0,0],[0.855,0.145,0],[1,0.5,0],[0.855,0.855,0],[0.5,1,0],[0.145,0.855,0],[0,0.5,0]];shape=mxgraph.bpmn.event;html=1;verticalLabelPosition=bottom;labelBackgroundColor=#ffffff;verticalAlign=top;align=center;perimeter=ellipsePerimeter;outlineConnect=0;aspect=fixed;outline=end;symbol=general;strokeColor=#0F8B8D;fontColor=#143642;fillColor=#FAE5C7;&quot; parent=&quot;MW7wNo_Qlk7bcEILyiEd-1&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;490&quot; y=&quot;60&quot; width=&quot;50&quot; height=&quot;50&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;MW7wNo_Qlk7bcEILyiEd-5&quot; style=&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;entryPerimeter=0;strokeColor=#A8201A;fontColor=#143642;fillColor=#FAE5C7;exitX=0;exitY=0.5;exitDx=0;exitDy=0;exitPerimeter=0;&quot; parent=&quot;MW7wNo_Qlk7bcEILyiEd-1&quot; source=&quot;MW7wNo_Qlk7bcEILyiEd-2&quot; target=&quot;MW7wNo_Qlk7bcEILyiEd-4&quot; edge=&quot;1&quot;&gt;&#10;          &lt;mxGeometry relative=&quot;1&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;MW7wNo_Qlk7bcEILyiEd-9&quot; style=&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;entryPerimeter=0;strokeColor=#A8201A;fontColor=#143642;fillColor=#FAE5C7;exitX=0.5;exitY=1;exitDx=0;exitDy=0;exitPerimeter=0;dashed=1;&quot; parent=&quot;1&quot; source=&quot;MW7wNo_Qlk7bcEILyiEd-6&quot; target=&quot;MW7wNo_Qlk7bcEILyiEd-2&quot; edge=&quot;1&quot;&gt;&#10;          &lt;mxGeometry relative=&quot;1&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;      &lt;/root&gt;&#10;    &lt;/mxGraphModel&gt;&#10;  &lt;/diagram&gt;&#10;&lt;/mxfile&gt;&#10;"><defs/><g><rect x="10" y="401" width="850" height="390" rx="10" ry="10" fill="rgb(255, 255, 255)" stroke="#0066cc" stroke-dasharray="3 3" pointer-events="all"/><rect x="5" y="406" width="850" height="390" rx="10" ry="10" fill="rgb(255, 255, 255)" stroke="#0066cc" stroke-dasharray="3 3" pointer-events="all"/><rect x="0" y="411" width="850" height="390" rx="10" ry="10" fill="rgb(255, 255, 255)" stroke="#0066cc" stroke-dasharray="3 3" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 844px; height: 1px; padding-top: 418px; margin-left: 6px;"><div data-drawio-colors="color: #143642; " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 16px; font-family: Helvetica; color: rgb(20, 54, 66); line-height: 1.2; pointer-events: all; font-weight: bold; white-space: normal; overflow-wrap: normal;">Provider sub-lattice</div></div></div></foreignObject><text x="6" y="434" fill="#143642" font-family="Helvetica" font-size="16px" font-weight="bold">Provider sub-lattice</text></switch></g><rect x="0" y="181" width="850" height="210" rx="10" ry="10" fill="rgb(255, 255, 255)" stroke="#00cc00" stroke-dasharray="3 3" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 844px; height: 1px; padding-top: 188px; margin-left: 6px;"><div data-drawio-colors="color: #143642; " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 16px; font-family: Helvetica; color: rgb(20, 54, 66); line-height: 1.2; pointer-events: all; font-weight: bold; white-space: normal; overflow-wrap: normal;">Common sub-lattice</div></div></div></foreignObject><text x="6" y="204" fill="#143642" font-family="Helvetica" font-size="16px" font-weight="bold">Common sub-lattice</text></switch></g><path d="M 50 1 L 10 1 L 10 171 L 50 171" fill="#fae5c7" stroke="#0f8b8d" stroke-width="2" stroke-miterlimit="10" pointer-events="all"/><path d="M 50 1 L 840 1 L 840 171 L 50 171" fill="#ffffff" stroke="#0f8b8d" stroke-width="2" stroke-miterlimit="10" pointer-events="all"/><path d="M 50 1 L 50 171" fill="none" stroke="#0f8b8d" stroke-width="2" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)rotate(-90 30.000000000000114 86)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 168px; height: 1px; padding-top: 86px; margin-left: -54px;"><div data-drawio-colors="color: #143642; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 16px; font-family: Helvetica; color: rgb(20, 54, 66); line-height: 1.2; pointer-events: all; font-weight: bold; white-space: normal; overflow-wrap: normal;">Client SDK</div></div></div></foreignObject><text x="30" y="91" fill="#143642" font-family="Helvetica" font-size="16px" text-anchor="middle" font-weight="bold">Client SDK</text></switch></g><path d="M 180 31 C 180 25.48 184.48 21 190 21 L 320 21 C 325.52 21 330 25.48 330 31 L 330 141 C 330 146.52 325.52 151 320 151 L 190 151 C 184.48 151 180 146.52 180 141 L 180 31 Z" fill="#fae5c7" stroke="none" pointer-events="all"/><path d="M 182 32 L 182 140 C 182 144.97 186.03 149 191 149 L 319 149 C 323.97 149 328 144.97 328 140 L 328 32 C 328 27.03 323.97 23 319 23 L 191 23 C 186.03 23 182 27.03 182 32" fill="none" stroke="none" pointer-events="all"/><path d="M 180 31 C 180 25.48 184.48 21 190 21 L 320 21 C 325.52 21 330 25.48 330 31 L 330 141 C 330 146.52 325.52 151 320 151 L 190 151 C 184.48 151 180 146.52 180 141 L 180 31 Z" fill="none" stroke="#0f8b8d" stroke-miterlimit="10" pointer-events="all"/><path d="M 182 39 L 182 34.12 C 182.94 32.48 184.37 31.19 186.09 30.46 C 186.58 30.31 187.1 30.25 187.62 30.29 C 187.61 31.8 188.71 33.07 190.17 33.25 C 190.97 33.3 191.75 33.01 192.33 32.45 C 192.91 31.88 193.24 31.1 193.23 30.29 C 193.85 30.21 194.48 30.27 195.07 30.46 C 196.49 31.23 197.54 32.55 198 34.12 L 198 39 Z M 193.23 30.29 C 193.24 31.1 192.91 31.88 192.33 32.45 C 191.75 33.01 190.97 33.3 190.17 33.25 C 188.71 33.07 187.61 31.8 187.62 30.29 C 187.91 30.26 188.19 30.2 188.47 30.11 L 188.64 29.41 C 188.1 29.29 187.65 28.9 187.45 28.37 C 187.01 27.5 187.44 26.54 188.52 26 C 189.6 25.45 191.08 25.45 192.16 26 C 193.24 26.54 193.68 27.5 193.23 28.37 C 192.95 28.9 192.45 29.29 191.87 29.41 L 192.04 30.11 Z" fill="none" stroke="#0f8b8d" stroke-miterlimit="10" pointer-events="all"/><path d="M 184.72 36.21 L 184.72 38.83 M 194.77 36.21 L 194.77 38.83" fill="none" stroke="#0f8b8d" stroke-miterlimit="10" pointer-events="all"/><path d="M 187.45 28.37 C 186.68 27.59 186.48 26.41 186.94 25.41 C 187.51 24.09 188.76 23.21 190.17 23.14 C 191.76 23 193.27 23.91 193.91 25.41 C 194.33 26.44 194.06 27.63 193.23 28.37 C 193.28 27.82 193.17 27.27 192.89 26.8 C 192.18 26.34 191.28 26.28 190.51 26.63 C 189.69 26.21 188.72 26.28 187.96 26.8 C 187.63 27.25 187.45 27.8 187.45 28.37 Z" fill="#0f8b8d" stroke="#0f8b8d" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-end; width: 146px; height: 1px; padding-top: 26px; margin-left: 180px;"><div data-drawio-colors="color: #143642; " style="box-sizing: border-box; font-size: 0px; text-align: right;"><div style="display: inline-block; font-size: 14px; font-family: Helvetica; color: rgb(20, 54, 66); line-height: 1.2; pointer-events: all; font-weight: bold; white-space: normal; overflow-wrap: normal;"><span style="font-size: 14px;"><font style="font-size: 14px;">Request<br style="font-size: 14px;" />product</font></span></div></div></div></foreignObject><text x="326" y="40" fill="#143642" font-family="Helvetica" font-size="14px" text-anchor="end" font-weight="bold">Request...</text></switch></g><rect x="180" y="61" width="150" height="90" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 152px; height: 1px; padding-top: 106px; margin-left: 179px;"><div data-drawio-colors="color: #143642; " style="box-sizing: border-box; font-size: 0px; text-align: center; width: 150px; max-height: 90px; overflow: hidden;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(20, 54, 66); line-height: 1.2; pointer-events: all; width: 100%; white-space: normal; overflow-wrap: normal;">Request access to <br />product available in the customer inventory</div></div></div></foreignObject><text x="255" y="110" fill="#143642" font-family="Helvetica" font-size="12px" text-anchor="middle">Request access to...</text></switch></g><path d="M 130 86 L 173.63 86" fill="none" stroke="#a8201a" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 178.88 86 L 171.88 89.5 L 173.63 86 L 171.88 82.5 Z" fill="#a8201a" stroke="#a8201a" stroke-miterlimit="10" pointer-events="all"/><ellipse cx="105" cy="86" rx="25" ry="25" fill="#fae5c7" stroke="#0f8b8d" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-end; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 58px; margin-left: 104px;"><div data-drawio-colors="color: #143642; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 14px; font-family: Helvetica; color: rgb(20, 54, 66); line-height: 1.2; pointer-events: all; font-weight: bold; white-space: nowrap;"><span style="font-size: 14px; text-align: right;">Use<br />Product<br /></span></div></div></div></foreignObject><text x="104" y="58" fill="#143642" font-family="Helvetica" font-size="14px" text-anchor="middle" font-weight="bold">Use...</text></switch></g><ellipse cx="800" cy="86" rx="25" ry="25" fill="#fae5c7" stroke="#0f8b8d" stroke-width="3" pointer-events="all"/><ellipse cx="800" cy="86" rx="22.5" ry="22.5" fill="#0f8b8d" stroke="#fae5c7" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-end; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 58px; margin-left: 799px;"><div data-drawio-colors="color: #143642; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 14px; font-family: Helvetica; color: rgb(20, 54, 66); line-height: 1.2; pointer-events: all; font-weight: bold; white-space: nowrap;">Grant<br />Request</div></div></div></foreignObject><text x="799" y="58" fill="#143642" font-family="Helvetica" font-size="14px" text-anchor="middle" font-weight="bold">Grant...</text></switch></g><ellipse cx="545" cy="96" rx="25" ry="25" fill="#cc0000" stroke="#0f8b8d" pointer-events="all"/><ellipse cx="545" cy="96" rx="22" ry="22" fill="none" stroke="#0f8b8d" pointer-events="all"/><ellipse cx="545" cy="96" rx="22.5" ry="22.5" fill="#0f8b8d" stroke="#cc0000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-end; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 68px; margin-left: 544px;"><div data-drawio-colors="color: #143642; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 14px; font-family: Helvetica; color: rgb(20, 54, 66); line-height: 1.2; pointer-events: all; font-weight: bold; white-space: nowrap;">Deny<br />Request</div></div></div></foreignObject><text x="544" y="68" fill="#143642" font-family="Helvetica" font-size="14px" text-anchor="middle" font-weight="bold">Deny...</text></switch></g><path d="M 50 211 L 10 211 L 10 381 L 50 381" fill="#fae5c7" stroke="#0f8b8d" stroke-width="2" stroke-miterlimit="10" pointer-events="all"/><path d="M 50 211 L 840 211 L 840 381 L 50 381" fill="#ffffff" stroke="#0f8b8d" stroke-width="2" stroke-miterlimit="10" pointer-events="all"/><path d="M 50 211 L 50 381" fill="none" stroke="#0f8b8d" stroke-width="2" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)rotate(-90 30 296.0000000000001)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 168px; height: 1px; padding-top: 296px; margin-left: -54px;"><div data-drawio-colors="color: #143642; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 16px; font-family: Helvetica; color: rgb(20, 54, 66); line-height: 1.2; pointer-events: all; font-weight: bold; white-space: normal; overflow-wrap: normal;">Rating Coordinator</div></div></div></foreignObject><text x="30" y="301" fill="#143642" font-family="Helvetica" font-size="16px" text-anchor="middle" font-weight="bold">Rating Coordinator</text></switch></g><path d="M 340 241 C 340 235.48 344.48 231 350 231 L 480 231 C 485.52 231 490 235.48 490 241 L 490 351 C 490 356.52 485.52 361 480 361 L 350 361 C 344.48 361 340 356.52 340 351 L 340 241 Z" fill="#fae5c7" stroke="none" pointer-events="all"/><path d="M 342 242 L 342 350 C 342 354.97 346.03 359 351 359 L 479 359 C 483.97 359 488 354.97 488 350 L 488 242 C 488 237.03 483.97 233 479 233 L 351 233 C 346.03 233 342 237.03 342 242" fill="none" stroke="none" pointer-events="all"/><path d="M 340 241 C 340 235.48 344.48 231 350 231 L 480 231 C 485.52 231 490 235.48 490 241 L 490 351 C 490 356.52 485.52 361 480 361 L 350 361 C 344.48 361 340 356.52 340 351 L 340 241 Z" fill="none" stroke="#0f8b8d" stroke-miterlimit="10" pointer-events="all"/><path d="M 411.93 358.59 C 409.82 356.9 409.22 353.85 410.54 351.44 C 411.86 349.03 414.68 348 417.16 349.03 C 419.63 350.06 421 352.83 420.35 355.52 C 419.71 358.22 417.25 360 414.6 359.7 M 411.93 355.81 L 411.93 358.59 L 409 357.76" fill="none" stroke="#0f8b8d" stroke-miterlimit="10" pointer-events="all"/><path d="M 342.36 237.22 L 343.79 238.31 L 343.64 239.47 L 342 240.1 L 342.52 242.3 L 344.36 242.08 L 345.06 243.04 L 344.39 244.6 L 346.31 245.77 L 347.42 244.37 L 348.67 244.53 L 349.32 246.12 L 351.55 245.61 L 351.34 243.79 L 352.3 243.04 L 353.83 243.82 L 355.13 241.9 L 353.62 240.76 L 353.78 239.62 L 355.47 238.99 L 354.97 236.82 L 353.03 237.02 L 352.35 236.16 L 353.05 234.49 L 351.11 233.38 L 349.89 234.8 L 348.69 234.62 L 347.94 233 L 345.79 233.56 L 346 235.33 L 345.19 236.01 L 343.53 235.33 Z M 346.37 239.69 C 346.37 238.41 347.43 237.37 348.74 237.37 C 350.05 237.37 351.12 238.41 351.12 239.69 C 351.12 240.97 350.05 242 348.74 242 C 347.43 242 346.37 240.97 346.37 239.69 Z" fill="#fae5c7" stroke="#0f8b8d" stroke-miterlimit="10" pointer-events="all"/><path d="M 344.9 240.1 L 346.32 241.19 L 346.17 242.35 L 344.53 242.98 L 345.05 245.18 L 346.9 244.96 L 347.6 245.92 L 346.92 247.48 L 348.84 248.65 L 349.96 247.26 L 351.2 247.41 L 351.85 249 L 354.08 248.49 L 353.87 246.67 L 354.84 245.92 L 356.36 246.7 L 357.66 244.78 L 356.16 243.64 L 356.31 242.5 L 358 241.87 L 357.51 239.7 L 355.56 239.9 L 354.89 239.04 L 355.59 237.37 L 353.64 236.26 L 352.42 237.68 L 351.23 237.5 L 350.48 235.88 L 348.32 236.44 L 348.53 238.21 L 347.73 238.89 L 346.07 238.21 Z M 348.9 242.57 C 348.9 241.29 349.96 240.25 351.28 240.25 C 352.59 240.25 353.65 241.29 353.65 242.57 C 353.65 243.85 352.59 244.88 351.28 244.88 C 349.96 244.88 348.9 243.85 348.9 242.57 Z" fill="#fae5c7" stroke="#0f8b8d" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-end; width: 146px; height: 1px; padding-top: 236px; margin-left: 340px;"><div data-drawio-colors="color: #143642; " style="box-sizing: border-box; font-size: 0px; text-align: right;"><div style="display: inline-block; font-size: 14px; font-family: Helvetica; color: rgb(20, 54, 66); line-height: 1.2; pointer-events: all; font-weight: bold; white-space: normal; overflow-wrap: normal;">Map<br />validation request</div></div></div></foreignObject><text x="486" y="250" fill="#143642" font-family="Helvetica" font-size="14px" text-anchor="end" font-weight="bold">Map...</text></switch></g><rect x="340" y="271" width="150" height="90" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 152px; height: 1px; padding-top: 316px; margin-left: 339px;"><div data-drawio-colors="color: #143642; " style="box-sizing: border-box; font-size: 0px; text-align: center; width: 150px; max-height: 90px; overflow: hidden;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(20, 54, 66); line-height: 1.2; pointer-events: all; width: 100%; white-space: normal; overflow-wrap: normal;">Launch an actor to validate product access request from vendor specified by<b> agentId</b></div></div></div></foreignObject><text x="415" y="320" fill="#143642" font-family="Helvetica" font-size="12px" text-anchor="middle">Launch an actor to valida...</text></switch></g><path d="M 545 271 L 570 296 L 545 321 L 520 296 Z" fill="#fae5c7" stroke="#0f8b8d" stroke-miterlimit="10" pointer-events="all"/><path d="M 537.5 283.5 L 545 293 L 552.5 283.5 L 554.5 286.25 L 547.23 296 L 554.5 305.75 L 552.5 308.5 L 545 299 L 537.5 308.5 L 535.5 305.75 L 542.74 296 L 535.5 286.25 Z" fill="#0f8b8d" stroke="#0f8b8d" stroke-miterlimit="10" pointer-events="all"/><path d="M 600 241 C 600 235.48 604.48 231 610 231 L 740 231 C 745.52 231 750 235.48 750 241 L 750 351 C 750 356.52 745.52 361 740 361 L 610 361 C 604.48 361 600 356.52 600 351 L 600 241 Z" fill="#fae5c7" stroke="none" pointer-events="all"/><path d="M 602 242 L 602 350 C 602 354.97 606.03 359 611 359 L 739 359 C 743.97 359 748 354.97 748 350 L 748 242 C 748 237.03 743.97 233 739 233 L 611 233 C 606.03 233 602 237.03 602 242" fill="none" stroke="none" pointer-events="all"/><path d="M 600 241 C 600 235.48 604.48 231 610 231 L 740 231 C 745.52 231 750 235.48 750 241 L 750 351 C 750 356.52 745.52 361 740 361 L 610 361 C 604.48 361 600 356.52 600 351 L 600 241 Z" fill="none" stroke="#0f8b8d" stroke-miterlimit="10" pointer-events="all"/><path d="M 671.93 358.59 C 669.82 356.9 669.22 353.85 670.54 351.44 C 671.86 349.03 674.68 348 677.16 349.03 C 679.63 350.06 681 352.83 680.35 355.52 C 679.71 358.22 677.25 360 674.6 359.7 M 671.93 355.81 L 671.93 358.59 L 669 357.76" fill="none" stroke="#0f8b8d" stroke-miterlimit="10" pointer-events="all"/><path d="M 602.36 237.22 L 603.79 238.31 L 603.64 239.47 L 602 240.1 L 602.52 242.3 L 604.36 242.08 L 605.06 243.04 L 604.39 244.6 L 606.31 245.77 L 607.42 244.37 L 608.67 244.53 L 609.32 246.12 L 611.55 245.61 L 611.34 243.79 L 612.3 243.04 L 613.83 243.82 L 615.13 241.9 L 613.62 240.76 L 613.78 239.62 L 615.47 238.99 L 614.97 236.82 L 613.03 237.02 L 612.35 236.16 L 613.05 234.49 L 611.11 233.38 L 609.89 234.8 L 608.69 234.62 L 607.94 233 L 605.79 233.56 L 606 235.33 L 605.19 236.01 L 603.53 235.33 Z M 606.37 239.69 C 606.37 238.41 607.43 237.37 608.74 237.37 C 610.05 237.37 611.12 238.41 611.12 239.69 C 611.12 240.97 610.05 242 608.74 242 C 607.43 242 606.37 240.97 606.37 239.69 Z" fill="#fae5c7" stroke="#0f8b8d" stroke-miterlimit="10" pointer-events="all"/><path d="M 604.9 240.1 L 606.32 241.19 L 606.17 242.35 L 604.53 242.98 L 605.05 245.18 L 606.9 244.96 L 607.6 245.92 L 606.92 247.48 L 608.84 248.65 L 609.96 247.26 L 611.2 247.41 L 611.85 249 L 614.08 248.49 L 613.87 246.67 L 614.84 245.92 L 616.36 246.7 L 617.66 244.78 L 616.16 243.64 L 616.31 242.5 L 618 241.87 L 617.51 239.7 L 615.56 239.9 L 614.89 239.04 L 615.59 237.37 L 613.64 236.26 L 612.42 237.68 L 611.23 237.5 L 610.48 235.88 L 608.32 236.44 L 608.53 238.21 L 607.73 238.89 L 606.07 238.21 Z M 608.9 242.57 C 608.9 241.29 609.96 240.25 611.28 240.25 C 612.59 240.25 613.65 241.29 613.65 242.57 C 613.65 243.85 612.59 244.88 611.28 244.88 C 609.96 244.88 608.9 243.85 608.9 242.57 Z" fill="#fae5c7" stroke="#0f8b8d" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-end; width: 146px; height: 1px; padding-top: 236px; margin-left: 600px;"><div data-drawio-colors="color: #143642; " style="box-sizing: border-box; font-size: 0px; text-align: right;"><div style="display: inline-block; font-size: 14px; font-family: Helvetica; color: rgb(20, 54, 66); line-height: 1.2; pointer-events: all; font-weight: bold; white-space: normal; overflow-wrap: normal;">Map<br />rating request</div></div></div></foreignObject><text x="746" y="250" fill="#143642" font-family="Helvetica" font-size="14px" text-anchor="end" font-weight="bold">Map...</text></switch></g><rect x="600" y="271" width="150" height="90" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 152px; height: 1px; padding-top: 316px; margin-left: 599px;"><div data-drawio-colors="color: #143642; " style="box-sizing: border-box; font-size: 0px; text-align: center; width: 150px; max-height: 90px; overflow: hidden;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(20, 54, 66); line-height: 1.2; pointer-events: all; width: 100%; white-space: normal; overflow-wrap: normal;">Launch an actor to rate product usage request<br />from vendor specified by<b> agentId</b></div></div></div></foreignObject><text x="675" y="320" fill="#143642" font-family="Helvetica" font-size="12px" text-anchor="middle">Launch an actor to rate p...</text></switch></g><path d="M 285 271 L 310 296 L 285 321 L 260 296 Z" fill="#fae5c7" stroke="#0f8b8d" stroke-miterlimit="10" pointer-events="all"/><path d="M 277.5 283.5 L 285 293 L 292.51 283.5 L 294.5 286.25 L 287.23 296 L 294.5 305.75 L 292.51 308.5 L 285 299 L 277.5 308.5 L 275.5 305.75 L 282.74 296 L 275.5 286.25 Z" fill="#0f8b8d" stroke="#0f8b8d" stroke-miterlimit="10" pointer-events="all"/><path d="M 310 296 L 333.63 296" fill="none" stroke="#a8201a" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 338.88 296 L 331.88 299.5 L 333.63 296 L 331.88 292.5 Z" fill="#a8201a" stroke="#a8201a" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 285px; margin-left: 318px;"><div data-drawio-colors="color: #143642; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(20, 54, 66); line-height: 1.2; pointer-events: all; white-space: nowrap;">yes</div></div></div></foreignObject><text x="318" y="289" fill="#143642" font-family="Helvetica" font-size="11px" text-anchor="middle">yes</text></switch></g><path d="M 80 241 C 80 235.48 84.48 231 90 231 L 220 231 C 225.52 231 230 235.48 230 241 L 230 351 C 230 356.52 225.52 361 220 361 L 90 361 C 84.48 361 80 356.52 80 351 L 80 241 Z" fill="#fae5c7" stroke="none" pointer-events="all"/><path d="M 82 242 L 82 350 C 82 354.97 86.03 359 91 359 L 219 359 C 223.97 359 228 354.97 228 350 L 228 242 C 228 237.03 223.97 233 219 233 L 91 233 C 86.03 233 82 237.03 82 242" fill="none" stroke="none" pointer-events="all"/><path d="M 80 241 C 80 235.48 84.48 231 90 231 L 220 231 C 225.52 231 230 235.48 230 241 L 230 351 C 230 356.52 225.52 361 220 361 L 90 361 C 84.48 361 80 356.52 80 351 L 80 241 Z" fill="none" stroke="#0f8b8d" stroke-miterlimit="10" pointer-events="all"/><path d="M 151.93 358.59 C 149.82 356.9 149.22 353.85 150.54 351.44 C 151.86 349.03 154.68 348 157.16 349.03 C 159.63 350.06 161 352.83 160.35 355.52 C 159.71 358.22 157.25 360 154.6 359.7 M 151.93 355.81 L 151.93 358.59 L 149 357.76" fill="none" stroke="#0f8b8d" stroke-miterlimit="10" pointer-events="all"/><path d="M 82.36 237.22 L 83.79 238.31 L 83.64 239.47 L 82 240.1 L 82.52 242.3 L 84.36 242.08 L 85.06 243.04 L 84.39 244.6 L 86.31 245.77 L 87.42 244.37 L 88.67 244.53 L 89.32 246.12 L 91.55 245.61 L 91.34 243.79 L 92.3 243.04 L 93.83 243.82 L 95.13 241.9 L 93.62 240.76 L 93.78 239.62 L 95.47 238.99 L 94.97 236.82 L 93.03 237.02 L 92.35 236.16 L 93.05 234.49 L 91.11 233.38 L 89.89 234.8 L 88.69 234.62 L 87.94 233 L 85.79 233.56 L 86 235.33 L 85.19 236.01 L 83.53 235.33 Z M 86.37 239.69 C 86.37 238.41 87.43 237.37 88.74 237.37 C 90.05 237.37 91.12 238.41 91.12 239.69 C 91.12 240.97 90.05 242 88.74 242 C 87.43 242 86.37 240.97 86.37 239.69 Z" fill="#fae5c7" stroke="#0f8b8d" stroke-miterlimit="10" pointer-events="all"/><path d="M 84.9 240.1 L 86.32 241.19 L 86.17 242.35 L 84.53 242.98 L 85.05 245.18 L 86.9 244.96 L 87.6 245.92 L 86.92 247.48 L 88.84 248.65 L 89.96 247.26 L 91.2 247.41 L 91.85 249 L 94.08 248.49 L 93.87 246.67 L 94.84 245.92 L 96.36 246.7 L 97.66 244.78 L 96.16 243.64 L 96.31 242.5 L 98 241.87 L 97.51 239.7 L 95.56 239.9 L 94.89 239.04 L 95.59 237.37 L 93.64 236.26 L 92.42 237.68 L 91.23 237.5 L 90.48 235.88 L 88.32 236.44 L 88.53 238.21 L 87.73 238.89 L 86.07 238.21 Z M 88.9 242.57 C 88.9 241.29 89.96 240.25 91.28 240.25 C 92.59 240.25 93.65 241.29 93.65 242.57 C 93.65 243.85 92.59 244.88 91.28 244.88 C 89.96 244.88 88.9 243.85 88.9 242.57 Z" fill="#fae5c7" stroke="#0f8b8d" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-end; width: 146px; height: 1px; padding-top: 236px; margin-left: 80px;"><div data-drawio-colors="color: #143642; " style="box-sizing: border-box; font-size: 0px; text-align: right;"><div style="display: inline-block; font-size: 14px; font-family: Helvetica; color: rgb(20, 54, 66); line-height: 1.2; pointer-events: all; font-weight: bold; white-space: normal; overflow-wrap: normal;">Build provider<br />dependency graph</div></div></div></foreignObject><text x="226" y="250" fill="#143642" font-family="Helvetica" font-size="14px" text-anchor="end" font-weight="bold">Build provider...</text></switch></g><rect x="80" y="271" width="150" height="90" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 152px; height: 1px; padding-top: 316px; margin-left: 79px;"><div data-drawio-colors="color: #143642; " style="box-sizing: border-box; font-size: 0px; text-align: center; width: 150px; max-height: 90px; overflow: hidden;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(20, 54, 66); line-height: 1.2; pointer-events: all; width: 100%; white-space: normal; overflow-wrap: normal;">Recursively call providers agents and build the dependency graph for validation and rating </div></div></div></foreignObject><text x="155" y="320" fill="#143642" font-family="Helvetica" font-size="12px" text-anchor="middle">Recursively call provider...</text></switch></g><path d="M 260 236 L 245 236 L 245 253 L 260 253" fill="none" stroke="#0f8b8d" stroke-miterlimit="10" transform="translate(0,244.5)scale(1,-1)translate(0,-244.5)" pointer-events="all"/><path d="M 230 244.5 L 245 244.5" fill="none" stroke="#0f8b8d" stroke-miterlimit="10" transform="translate(0,244.5)scale(1,-1)translate(0,-244.5)" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 244px; margin-left: 262px;"><div data-drawio-colors="color: #143642; " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(20, 54, 66); line-height: 1.2; pointer-events: all; white-space: nowrap;">Recursive</div></div></div></foreignObject><text x="262" y="248" fill="#143642" font-family="Helvetica" font-size="12px">Recur...</text></switch></g><path d="M 260 296 L 250 296 L 236.37 296" fill="none" stroke="#a8201a" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 231.12 296 L 238.12 292.5 L 236.37 296 L 238.12 299.5 Z" fill="#a8201a" stroke="#a8201a" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 285px; margin-left: 252px;"><div data-drawio-colors="color: #143642; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(20, 54, 66); line-height: 1.2; pointer-events: all; white-space: nowrap;">no</div></div></div></foreignObject><text x="252" y="289" fill="#143642" font-family="Helvetica" font-size="11px" text-anchor="middle">no</text></switch></g><path d="M 570 296 L 590 296 L 580 296 L 593.63 296" fill="none" stroke="#a8201a" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 598.88 296 L 591.88 299.5 L 593.63 296 L 591.88 292.5 Z" fill="#a8201a" stroke="#a8201a" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 285px; margin-left: 578px;"><div data-drawio-colors="color: #143642; background-color: rgb(255, 255, 255); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(20, 54, 66); line-height: 1.2; pointer-events: all; background-color: rgb(255, 255, 255); white-space: nowrap;">yes</div></div></div></foreignObject><text x="578" y="289" fill="#143642" font-family="Helvetica" font-size="11px" text-anchor="middle">yes</text></switch></g><path d="M 50 441 L 10 441 L 10 611 L 50 611" fill="#fae5c7" stroke="#0f8b8d" stroke-width="2" stroke-miterlimit="10" pointer-events="all"/><path d="M 50 441 L 840 441 L 840 611 L 50 611" fill="#ffffff" stroke="#0f8b8d" stroke-width="2" stroke-miterlimit="10" pointer-events="all"/><path d="M 50 441 L 50 611" fill="none" stroke="#0f8b8d" stroke-width="2" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)rotate(-90 30.000000000000114 526.0000000000001)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 168px; height: 1px; padding-top: 526px; margin-left: -54px;"><div data-drawio-colors="color: #143642; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 16px; font-family: Helvetica; color: rgb(20, 54, 66); line-height: 1.2; pointer-events: all; font-weight: bold; white-space: normal; overflow-wrap: normal;">Rating Agent</div></div></div></foreignObject><text x="30" y="531" fill="#143642" font-family="Helvetica" font-size="16px" text-anchor="middle" font-weight="bold">Rating Agent</text></switch></g><path d="M 340 471 C 340 465.48 344.48 461 350 461 L 480 461 C 485.52 461 490 465.48 490 471 L 490 581 C 490 586.52 485.52 591 480 591 L 350 591 C 344.48 591 340 586.52 340 581 L 340 471 Z" fill="#fae5c7" stroke="none" pointer-events="all"/><path d="M 342 472 L 342 580 C 342 584.97 346.03 589 351 589 L 479 589 C 483.97 589 488 584.97 488 580 L 488 472 C 488 467.03 483.97 463 479 463 L 351 463 C 346.03 463 342 467.03 342 472" fill="none" stroke="none" pointer-events="all"/><path d="M 340 471 C 340 465.48 344.48 461 350 461 L 480 461 C 485.52 461 490 465.48 490 471 L 490 581 C 490 586.52 485.52 591 480 591 L 350 591 C 344.48 591 340 586.52 340 581 L 340 471 Z" fill="none" stroke="#0f8b8d" stroke-miterlimit="10" pointer-events="all"/><rect x="344" y="465" width="18" height="14" fill="none" stroke="#0f8b8d" pointer-events="all"/><path d="M 344 468.23 L 362 468.23 M 344.18 473.62 L 361.89 473.62 M 348.5 468.23 L 348.5 479" fill="none" stroke="#0f8b8d" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-end; width: 146px; height: 1px; padding-top: 466px; margin-left: 340px;"><div data-drawio-colors="color: #143642; " style="box-sizing: border-box; font-size: 0px; text-align: right;"><div style="display: inline-block; font-size: 14px; font-family: Helvetica; color: rgb(20, 54, 66); line-height: 1.2; pointer-events: all; font-weight: bold; white-space: normal; overflow-wrap: normal;">Apply<br />validation rules</div></div></div></foreignObject><text x="486" y="480" fill="#143642" font-family="Helvetica" font-size="14px" text-anchor="end" font-weight="bold">Apply...</text></switch></g><rect x="340" y="501" width="150" height="90" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 152px; height: 1px; padding-top: 546px; margin-left: 339px;"><div data-drawio-colors="color: #143642; " style="box-sizing: border-box; font-size: 0px; text-align: center; width: 150px; max-height: 90px; overflow: hidden;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(20, 54, 66); line-height: 1.2; pointer-events: all; width: 100%; white-space: normal; overflow-wrap: normal;">Check access request against vendor specific rules for a customer specified by <b>partyId</b></div></div></div></foreignObject><text x="415" y="550" fill="#143642" font-family="Helvetica" font-size="12px" text-anchor="middle">Check access request agai...</text></switch></g><path d="M 600 471 C 600 465.48 604.48 461 610 461 L 740 461 C 745.52 461 750 465.48 750 471 L 750 581 C 750 586.52 745.52 591 740 591 L 610 591 C 604.48 591 600 586.52 600 581 L 600 471 Z" fill="#fae5c7" stroke="none" pointer-events="all"/><path d="M 602 472 L 602 580 C 602 584.97 606.03 589 611 589 L 739 589 C 743.97 589 748 584.97 748 580 L 748 472 C 748 467.03 743.97 463 739 463 L 611 463 C 606.03 463 602 467.03 602 472" fill="none" stroke="none" pointer-events="all"/><path d="M 600 471 C 600 465.48 604.48 461 610 461 L 740 461 C 745.52 461 750 465.48 750 471 L 750 581 C 750 586.52 745.52 591 740 591 L 610 591 C 604.48 591 600 586.52 600 581 L 600 471 Z" fill="none" stroke="#0f8b8d" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="all"/><rect x="668" y="577" width="14" height="14" fill="none" stroke="#0f8b8d" pointer-events="all"/><path d="M 672 584 L 678 584 M 675 581 L 675 587" fill="none" stroke="#0f8b8d" stroke-miterlimit="10" pointer-events="all"/><rect x="604" y="465" width="18" height="14" fill="none" stroke="#0f8b8d" pointer-events="all"/><path d="M 604 468.23 L 622 468.23 M 604.18 473.62 L 621.89 473.62 M 608.5 468.23 L 608.5 479" fill="none" stroke="#0f8b8d" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-end; width: 146px; height: 1px; padding-top: 466px; margin-left: 600px;"><div data-drawio-colors="color: #143642; " style="box-sizing: border-box; font-size: 0px; text-align: right;"><div style="display: inline-block; font-size: 14px; font-family: Helvetica; color: rgb(20, 54, 66); line-height: 1.2; pointer-events: all; font-weight: bold; white-space: normal; overflow-wrap: normal;">Apply<br />rating rules</div></div></div></foreignObject><text x="746" y="480" fill="#143642" font-family="Helvetica" font-size="14px" text-anchor="end" font-weight="bold">Apply...</text></switch></g><rect x="600" y="501" width="150" height="90" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 152px; height: 1px; padding-top: 546px; margin-left: 599px;"><div data-drawio-colors="color: #143642; " style="box-sizing: border-box; font-size: 0px; text-align: center; width: 150px; max-height: 90px; overflow: hidden;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(20, 54, 66); line-height: 1.2; pointer-events: all; width: 100%; white-space: normal; overflow-wrap: normal;">Create usage proof based on the rating process of current product offer</div></div></div></foreignObject><text x="675" y="550" fill="#143642" font-family="Helvetica" font-size="12px" text-anchor="middle">Create usage proof based...</text></switch></g><path d="M 80 471 C 80 465.48 84.48 461 90 461 L 220 461 C 225.52 461 230 465.48 230 471 L 230 581 C 230 586.52 225.52 591 220 591 L 90 591 C 84.48 591 80 586.52 80 581 L 80 471 Z" fill="#fae5c7" stroke="none" pointer-events="all"/><path d="M 82 472 L 82 580 C 82 584.97 86.03 589 91 589 L 219 589 C 223.97 589 228 584.97 228 580 L 228 472 C 228 467.03 223.97 463 219 463 L 91 463 C 86.03 463 82 467.03 82 472" fill="none" stroke="none" pointer-events="all"/><path d="M 80 471 C 80 465.48 84.48 461 90 461 L 220 461 C 225.52 461 230 465.48 230 471 L 230 581 C 230 586.52 225.52 591 220 591 L 90 591 C 84.48 591 80 586.52 80 581 L 80 471 Z" fill="none" stroke="#0f8b8d" stroke-miterlimit="10" pointer-events="all"/><rect x="84" y="465" width="18" height="14" fill="none" stroke="#0f8b8d" pointer-events="all"/><path d="M 84 468.23 L 102 468.23 M 84.18 473.62 L 101.89 473.62 M 88.5 468.23 L 88.5 479" fill="none" stroke="#0f8b8d" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-end; width: 146px; height: 1px; padding-top: 466px; margin-left: 80px;"><div data-drawio-colors="color: #143642; " style="box-sizing: border-box; font-size: 0px; text-align: right;"><div style="display: inline-block; font-size: 14px; font-family: Helvetica; color: rgb(20, 54, 66); line-height: 1.2; pointer-events: all; font-weight: bold; white-space: normal; overflow-wrap: normal;"><div>Get<br />partner <span style="background-color: initial;">providers</span></div></div></div></div></foreignObject><text x="226" y="480" fill="#143642" font-family="Helvetica" font-size="14px" text-anchor="end" font-weight="bold">Get...</text></switch></g><rect x="80" y="501" width="150" height="90" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 152px; height: 1px; padding-top: 546px; margin-left: 79px;"><div data-drawio-colors="color: #143642; " style="box-sizing: border-box; font-size: 0px; text-align: center; width: 150px; max-height: 90px; overflow: hidden;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(20, 54, 66); line-height: 1.2; pointer-events: all; width: 100%; white-space: normal; overflow-wrap: normal;">Return <b>agentId</b> list of intermediate product providers</div></div></div></foreignObject><text x="155" y="550" fill="#143642" font-family="Helvetica" font-size="12px" text-anchor="middle">Return agentId list of in...</text></switch></g><path d="M 800 501 L 825 526 L 800 551 L 775 526 Z" fill="#fae5c7" stroke="#0f8b8d" stroke-miterlimit="10" pointer-events="all"/><path d="M 797 513.5 L 803 513.5 L 803 523 L 812.5 523 L 812.5 529 L 803 529 L 803 538.5 L 797 538.5 L 797 529 L 787.5 529 L 787.5 523 L 797 523 Z" fill="#0f8b8d" stroke="#0f8b8d" stroke-miterlimit="10" pointer-events="all"/><path d="M 750 526 L 768.63 526" fill="none" stroke="#a8201a" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="stroke"/><path d="M 773.88 526 L 766.88 529.5 L 768.63 526 L 766.88 522.5 Z" fill="#a8201a" stroke="#a8201a" stroke-miterlimit="10" pointer-events="all"/><path d="M 490 526 L 545 526 L 545 327.37" fill="none" stroke="#a8201a" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="stroke"/><path d="M 545 322.12 L 548.5 329.12 L 545 327.37 L 541.5 329.12 Z" fill="#a8201a" stroke="#a8201a" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 343px; margin-left: 545px;"><div data-drawio-colors="color: #143642; background-color: rgb(255, 255, 255); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(20, 54, 66); line-height: 1.2; pointer-events: all; background-color: rgb(255, 255, 255); white-space: nowrap;">is valid</div></div></div></foreignObject><text x="545" y="346" fill="#143642" font-family="Helvetica" font-size="11px" text-anchor="middle">is valid</text></switch></g><path d="M 464.35 360.87 L 464.38 411 L 464.48 454.76" fill="none" stroke="#a8201a" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="stroke"/><path d="M 464.5 460.01 L 460.98 453.02 L 464.48 454.76 L 467.98 453 Z" fill="#a8201a" stroke="#a8201a" stroke-miterlimit="10" pointer-events="all"/><path d="M 724.65 361 L 724.65 454.76" fill="none" stroke="#a8201a" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="stroke"/><path d="M 724.65 460.01 L 721.15 453.01 L 724.65 454.76 L 728.15 453.01 Z" fill="#a8201a" stroke="#a8201a" stroke-miterlimit="10" pointer-events="all"/><path d="M 800 501 L 800 117.37" fill="none" stroke="#a8201a" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="stroke"/><path d="M 800 112.12 L 803.5 119.12 L 800 117.37 L 796.5 119.12 Z" fill="#a8201a" stroke="#a8201a" stroke-miterlimit="10" pointer-events="all"/><path d="M 545 271 L 545 161 L 545 127.37" fill="none" stroke="#a8201a" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="stroke"/><path d="M 545 122.12 L 548.5 129.12 L 545 127.37 L 541.5 129.12 Z" fill="#a8201a" stroke="#a8201a" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 263px; margin-left: 536px;"><div data-drawio-colors="color: #143642; background-color: rgb(255, 255, 255); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(20, 54, 66); line-height: 1.2; pointer-events: all; background-color: rgb(255, 255, 255); white-space: nowrap;">no</div></div></div></foreignObject><text x="536" y="266" fill="#143642" font-family="Helvetica" font-size="11px" text-anchor="middle">no</text></switch></g><path d="M 204.9 150.87 L 204.87 191 L 205.06 224.63" fill="none" stroke="#a8201a" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="stroke"/><path d="M 205.09 229.88 L 201.55 222.9 L 205.06 224.63 L 208.55 222.86 Z" fill="#a8201a" stroke="#a8201a" stroke-miterlimit="10" pointer-events="all"/><path d="M 204.8 361 L 204.8 454.5" fill="none" stroke="#a8201a" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="stroke"/><path d="M 204.8 459.75 L 201.3 452.75 L 204.8 454.5 L 208.3 452.75 Z" fill="#a8201a" stroke="#a8201a" stroke-miterlimit="10" pointer-events="all"/><path d="M 230 526 L 285 526 L 285 327.37" fill="none" stroke="#a8201a" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="stroke"/><path d="M 285 322.12 L 288.5 329.12 L 285 327.37 L 281.5 329.12 Z" fill="#a8201a" stroke="#a8201a" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 344px; margin-left: 285px;"><div data-drawio-colors="color: #143642; background-color: rgb(255, 255, 255); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(20, 54, 66); line-height: 1.2; pointer-events: all; background-color: rgb(255, 255, 255); white-space: nowrap;">is empty list</div></div></div></foreignObject><text x="285" y="347" fill="#143642" font-family="Helvetica" font-size="11px" text-anchor="middle">is empty list</text></switch></g><path d="M 50 621 L 10 621 L 10 791 L 50 791" fill="#fae5c7" stroke="#0f8b8d" stroke-width="2" stroke-miterlimit="10" pointer-events="all"/><path d="M 50 621 L 840 621 L 840 791 L 50 791" fill="#ffffff" stroke="#0f8b8d" stroke-width="2" stroke-miterlimit="10" pointer-events="all"/><path d="M 50 621 L 50 791" fill="none" stroke="#0f8b8d" stroke-width="2" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)rotate(-90 30.000000000000114 706)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 168px; height: 1px; padding-top: 706px; margin-left: -54px;"><div data-drawio-colors="color: #143642; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 16px; font-family: Helvetica; color: rgb(20, 54, 66); line-height: 1.2; pointer-events: all; font-weight: bold; white-space: normal; overflow-wrap: normal;">Usage Collector</div></div></div></foreignObject><text x="30" y="711" fill="#143642" font-family="Helvetica" font-size="16px" text-anchor="middle" font-weight="bold">Usage Collector</text></switch></g><path d="M 600 651 C 600 645.48 604.48 641 610 641 L 740 641 C 745.52 641 750 645.48 750 651 L 750 761 C 750 766.52 745.52 771 740 771 L 610 771 C 604.48 771 600 766.52 600 761 L 600 651 Z" fill="#fae5c7" stroke="none" pointer-events="all"/><path d="M 603 652.5 L 603 759.5 C 603 764.19 606.81 768 611.5 768 L 738.5 768 C 743.19 768 747 764.19 747 759.5 L 747 652.5 C 747 647.81 743.19 644 738.5 644 L 611.5 644 C 606.81 644 603 647.81 603 652.5" fill="none" stroke="none" pointer-events="all"/><path d="M 600 651 C 600 645.48 604.48 641 610 641 L 740 641 C 745.52 641 750 645.48 750 651 L 750 761 C 750 766.52 745.52 771 740 771 L 610 771 C 604.48 771 600 766.52 600 761 L 600 651 Z M 603 759.5 C 603 764.19 606.81 768 611.5 768 L 738.5 768 C 743.19 768 747 764.19 747 759.5 L 747 652.5 C 747 647.81 743.19 644 738.5 644 L 611.5 644 C 606.81 644 603 647.81 603 652.5 L 603 759.5 Z" fill="none" stroke="#0f8b8d" stroke-miterlimit="10" pointer-events="all"/><path d="M 602.36 647.22 L 603.79 648.31 L 603.64 649.47 L 602 650.1 L 602.52 652.3 L 604.36 652.08 L 605.06 653.04 L 604.39 654.6 L 606.31 655.77 L 607.42 654.37 L 608.67 654.53 L 609.32 656.12 L 611.55 655.61 L 611.34 653.79 L 612.3 653.04 L 613.83 653.82 L 615.13 651.9 L 613.62 650.76 L 613.78 649.62 L 615.47 648.99 L 614.97 646.82 L 613.03 647.02 L 612.35 646.16 L 613.05 644.49 L 611.11 643.38 L 609.89 644.8 L 608.69 644.62 L 607.94 643 L 605.79 643.56 L 606 645.33 L 605.19 646.01 L 603.53 645.33 Z M 606.37 649.69 C 606.37 648.41 607.43 647.37 608.74 647.37 C 610.05 647.37 611.12 648.41 611.12 649.69 C 611.12 650.97 610.05 652 608.74 652 C 607.43 652 606.37 650.97 606.37 649.69 Z" fill="#fae5c7" stroke="#0f8b8d" stroke-miterlimit="10" pointer-events="all"/><path d="M 604.9 650.1 L 606.32 651.19 L 606.17 652.35 L 604.53 652.98 L 605.05 655.18 L 606.9 654.96 L 607.6 655.92 L 606.92 657.48 L 608.84 658.65 L 609.96 657.26 L 611.2 657.41 L 611.85 659 L 614.08 658.49 L 613.87 656.67 L 614.84 655.92 L 616.36 656.7 L 617.66 654.78 L 616.16 653.64 L 616.31 652.5 L 618 651.87 L 617.51 649.7 L 615.56 649.9 L 614.89 649.04 L 615.59 647.37 L 613.64 646.26 L 612.42 647.68 L 611.23 647.5 L 610.48 645.88 L 608.32 646.44 L 608.53 648.21 L 607.73 648.89 L 606.07 648.21 Z M 608.9 652.57 C 608.9 651.29 609.96 650.25 611.28 650.25 C 612.59 650.25 613.65 651.29 613.65 652.57 C 613.65 653.85 612.59 654.88 611.28 654.88 C 609.96 654.88 608.9 653.85 608.9 652.57 Z" fill="#fae5c7" stroke="#0f8b8d" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-end; width: 146px; height: 1px; padding-top: 646px; margin-left: 600px;"><div data-drawio-colors="color: #143642; " style="box-sizing: border-box; font-size: 0px; text-align: right;"><div style="display: inline-block; font-size: 14px; font-family: Helvetica; color: rgb(20, 54, 66); line-height: 1.2; pointer-events: all; font-weight: bold; white-space: normal; overflow-wrap: normal;">Store<br />rated usage</div></div></div></foreignObject><text x="746" y="660" fill="#143642" font-family="Helvetica" font-size="14px" text-anchor="end" font-weight="bold">Store...</text></switch></g><rect x="600" y="681" width="150" height="90" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 152px; height: 1px; padding-top: 726px; margin-left: 599px;"><div data-drawio-colors="color: #143642; " style="box-sizing: border-box; font-size: 0px; text-align: center; width: 150px; max-height: 90px; overflow: hidden;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(20, 54, 66); line-height: 1.2; pointer-events: all; width: 100%; white-space: normal; overflow-wrap: normal;"> Store usage proof for a customer specified by <b>partyId</b></div></div></div></foreignObject><text x="675" y="730" fill="#143642" font-family="Helvetica" font-size="12px" text-anchor="middle">Store usage proof for a...</text></switch></g><ellipse cx="525" cy="706" rx="25" ry="25" fill="#fae5c7" stroke="#0f8b8d" stroke-width="3" pointer-events="all"/><path d="M 600 706 L 556.37 706" fill="none" stroke="#a8201a" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 551.12 706 L 558.12 702.5 L 556.37 706 L 558.12 709.5 Z" fill="#a8201a" stroke="#a8201a" stroke-miterlimit="10" pointer-events="all"/><path d="M 800 551 L 800 706 L 756.37 706" fill="none" stroke="#a8201a" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="stroke"/><path d="M 751.12 706 L 758.12 702.5 L 756.37 706 L 758.12 709.5 Z" fill="#a8201a" stroke="#a8201a" stroke-miterlimit="10" pointer-events="all"/></g><switch><g requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"/><a transform="translate(0,-5)" xlink:href="https://www.drawio.com/doc/faq/svg-export-text-problems" target="_blank"><text text-anchor="middle" font-size="10px" x="50%" y="100%">Text is not SVG - cannot display</text></a></switch></svg></p>
<h3 id="legend-6"><a class="header" href="#legend-6">Legend</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Term</th><th>description</th></tr></thead><tbody>
<tr><td><em>Party</em></td><td>A customer that has subscribed to a product</td></tr>
<tr><td><em>Vendor/Partner</em></td><td>An entity that sells products provided by another entity through a partnership agreement</td></tr>
<tr><td><em>Client SDK</em></td><td>The application from which the product are used</td></tr>
<tr><td><em>Product Offer</em></td><td>A product offering represents entities that are orderable from the provider of the catalog</td></tr>
<tr><td><em>Product</em></td><td>An instantiated offer for a specific party</td></tr>
<tr><td><em>Rating agent</em></td><td>The contract for the rating</td></tr>
<tr><td><em>Actor</em></td><td>An instantiated <em>Rating Agent</em></td></tr>
<tr><td><em>Rating coordinator</em></td><td>A component responsible for orchestrating the rating requests to different <em>Rating Agents</em></td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="monorepo-code-organization"><a class="header" href="#monorepo-code-organization">Monorepo code organization</a></h1>
<ul>
<li>Status: proposed</li>
<li>Deciders:</li>
<li>Date: YYYY.MM.DD</li>
</ul>
<p>Technical Story: N/A</p>
<h2 id="context-and-problem-statement"><a class="header" href="#context-and-problem-statement">Context and Problem Statement</a></h2>
<p>Code organization in the distributed-agent prototype</p>
<h2 id="decision-drivers"><a class="header" href="#decision-drivers">Decision Drivers</a></h2>
<p>Simplicity, agility</p>
<h2 id="considered-options"><a class="header" href="#considered-options">Considered Options</a></h2>
<ol>
<li>
<p>one unique repo for interfaces, agents and other artifacts</p>
</li>
<li>
<p>one repo for each artifact</p>
</li>
</ol>
<h2 id="decision-outcome"><a class="header" href="#decision-outcome">Decision Outcome</a></h2>
<ol>
<li>one unique repo for interfaces and agents</li>
</ol>
<h3 id="positive-consequences"><a class="header" href="#positive-consequences">Positive Consequences</a></h3>
<ul>
<li>simple and agile, suited for a prototype</li>
</ul>
<h3 id="negative-consequences"><a class="header" href="#negative-consequences">Negative Consequences</a></h3>
<ul>
<li>only one lifecycle (~release) for all artifacts</li>
</ul>
<p>We will want to reassess this decision in the target implementation</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="kickstart"><a class="header" href="#kickstart">Kickstart</a></h1>
<p>This document to give you kick to start your journey in Wasmcloud world.</p>
<h1 id="table-of-contents"><a class="header" href="#table-of-contents">Table of contents</a></h1>
<ol>
<li><a href="HOW-TO/kickstart.html#introduction">Introduction</a></li>
<li><a href="HOW-TO/kickstart.html#links">Important links</a></li>
<li><a href="HOW-TO/kickstart.html#install">Installation</a>
<ol>
<li><a href="HOW-TO/kickstart.html#cosmonic">Cosmonic</a></li>
<li><a href="HOW-TO/kickstart.html#wash">Wash cli</a></li>
</ol>
</li>
<li><a href="HOW-TO/kickstart.html#constellations">Use Cosmonic constellations</a></li>
</ol>
<br/>
<br/>
<h2 id="introduction-1"><a class="header" href="#introduction-1">Introduction <a name="introduction"></a></a></h2>
<p>This document will take you step by step in your journey in Wasmcloud technology , starting from important links you must check passing by installation &amp; running until testing your 1st actor :tada:</p>
<h2 id="important-links"><a class="header" href="#important-links">Important links <a name="links"></a></a></h2>
<h2 id="installation"><a class="header" href="#installation">Installation <a name="install"></a></a></h2>
<h3 id="cosmonic"><a class="header" href="#cosmonic">Cosmonic <a name="cosmonic"></a></a></h3>
<h3 id="wash"><a class="header" href="#wash">Wash <a name="wash"></a></a></h3>
<h2 id="use-cosmonic-constellations"><a class="header" href="#use-cosmonic-constellations">Use cosmonic constellations <a name="constellations"></a></a></h2>
<div style="break-before: page; page-break-before: always;"></div><h1 id="smithy-notes"><a class="header" href="#smithy-notes">Smithy Notes</a></h1>
<p>This document to give you some notes about smithy with wasmcloud and Rust.</p>
<h1 id="table-of-contents-1"><a class="header" href="#table-of-contents-1">Table of contents</a></h1>
<ol>
<li><a href="HOW-TO/smithy-notes.html#introduction">Introduction</a></li>
<li><a href="HOW-TO/smithy-notes.html#links">Important links</a></li>
<li><a href="HOW-TO/smithy-notes.html#annotation">Annotation traits</a>
<ol>
<li><a href="HOW-TO/smithy-notes.html#codegen">codegen</a></li>
</ol>
</li>
</ol>
<h2 id="introduction-2"><a class="header" href="#introduction-2">Introduction <a name="introduction"></a></a></h2>
<p>Every capability provider has a capability contract - an interface definition - that defines a service and a set of operations it supports. Even actor-to-actor messages, which don't use capability contracts, benefit by well-defined API contracts. In wasmCloud, we define these API contracts in Smithy files.</p>
<h2 id="important-links-1"><a class="header" href="#important-links-1">Important links <a name="links"></a></a></h2>
<p><a href="HOW-TO/smithy-notes.html#https://wasmcloud.com/docs/hosts/abis/wasmbus/interfaces/">Interfaces</a></p>
<h2 id="annotation-traits"><a class="header" href="#annotation-traits">Annotation traits <a name="annotation"></a></a></h2>
<h3 id="codegen"><a class="header" href="#codegen">codegen <a name="codegen"></a></a></h3>
<p>when can we use this traits will be mentioned in this <a href="HOW-TO/smithy-notes.html#https://wasmcloud.com/docs/hosts/abis/wasmbus/interfaces/traits#codegenrust">link</a>
but the only note you need to know is :</p>
<ul>
<li>you should add the import for codegenrust in your smithy file to see the effect of using this trait</li>
</ul>
<blockquote>
<p>use org.wasmcloud.model#codegenRust</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="runbook--manage-ks-store"><a class="header" href="#runbook--manage-ks-store">Runbook : Manage ks store</a></h1>
<h3 id="product-name-"><a class="header" href="#product-name-">Product name :</a></h3>
<ul>
<li>distributed-rating</li>
</ul>
<h3 id="product-version-"><a class="header" href="#product-version-">Product version :</a></h3>
<ul>
<li>All</li>
</ul>
<h3 id="runbook-goals-"><a class="header" href="#runbook-goals-">Runbook Goals :</a></h3>
<ul>
<li>How to manage kv store using cli</li>
</ul>
<h3 id="preconditions"><a class="header" href="#preconditions">Preconditions</a></h3>
<ul>
<li><a href="https://cosmonic.com/docs/user_guide/cosmo_cli">Cosmonic cli</a> installed</li>
<li><a href="https://wasmcloud.com/docs/installation?os=mac">wash</a> installed</li>
<li><a href="https://docs.nats.io/using-nats/nats-tools/nats_cli">NATS cli</a> installed</li>
</ul>
<h3 id="stages-"><a class="header" href="#stages-">Stages :</a></h3>
<ol>
<li><a href="HANDBOOK/kv-store-management.html#stage1">Stage 1</a> : List kv buckets</li>
<li><a href="HANDBOOK/kv-store-management.html#stage2">Stage 2</a> : List all keys in a bucket</li>
<li><a href="HANDBOOK/kv-store-management.html#stage3">Stage 3</a> : Put key and value</li>
<li><a href="HANDBOOK/kv-store-management.html#stage4">Stage 4</a> : Get value using key</li>
</ol>
<hr />
<h2 id="stage-1--list-kv-buckets"><a class="header" href="#stage-1--list-kv-buckets">Stage 1 : List kv buckets <a name="stage1"></a></a></h2>
<p>open your terminal and execute the below command</p>
<blockquote>
<p>nats kv -s connect.cosmonic.sh --creds ~/.cosmo/user.creds ls</p>
</blockquote>
<p>This command will retun the buckets in kv store</p>
<h2 id="stage-2--list-all-keys-in-a-bucket"><a class="header" href="#stage-2--list-all-keys-in-a-bucket">Stage 2 : List all keys in a bucket <a name="stage2"></a></a></h2>
<p>open your terminal and execute the below command</p>
<blockquote>
<p>nats kv -s connect.cosmonic.sh --creds ~/.cosmo/user.creds ls <em><strong>bucket-id</strong></em></p>
</blockquote>
<p><em><strong>bucket-id</strong></em> : is the id of bucket returned from Stage 1</p>
<h2 id="stage-3--put-key-and-value"><a class="header" href="#stage-3--put-key-and-value">Stage 3 : put key and value <a name="stage3"></a></a></h2>
<p>open your terminal and execute the below command</p>
<blockquote>
<p>nats kv -s connect.cosmonic.sh --creds ~/.cosmo/user.creds put 125b2a01-09a1-4d64-8bfc-5aa222e9c560 <em><strong>key</strong></em> <em><strong>value</strong></em></p>
</blockquote>
<blockquote>
<p>ex nats kv -s connect.cosmonic.sh --creds ~/.cosmo/user.creds put 125b2a01-09a1-4d64-8bfc-5aa222e9c560 customer1 '{\n        "product": {\n           "id":1234,\n           "offerId":534,\n           "description":"”Video on Demand”",\n           "productPrice": {\n              "description":"”Cost per movie”",\n              "validTill":"1/March/2024",\n              "priceType":"non-recurring",\n              "unitOfMeasure": {\n                 "amount":"1",\n                 "units":"”movie”"\n              },\n              "price": {\n                 "unit":"eur",\n                 "value":"1"\n              },\n              "ratingAgent": {}\n           }\n        }\n    }'</p>
</blockquote>
<h2 id="stage-4--get-value-using-key"><a class="header" href="#stage-4--get-value-using-key">Stage 4 : Get value using key <a name="stage4"></a></a></h2>
<p>open your terminal and execute the below command</p>
<blockquote>
<p>nats kv -s connect.cosmonic.sh --creds ~/.cosmo/user.creds get <em><strong>bucket-id</strong></em>  <em><strong>key</strong></em> --raw</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="runbook--link-management"><a class="header" href="#runbook--link-management">Runbook : Link management</a></h1>
<h3 id="product-name--1"><a class="header" href="#product-name--1">Product name :</a></h3>
<ul>
<li>distributed-rating</li>
</ul>
<h3 id="product-version--1"><a class="header" href="#product-version--1">Product version :</a></h3>
<ul>
<li>All</li>
</ul>
<h3 id="runbook-goals--1"><a class="header" href="#runbook-goals--1">Runbook Goals :</a></h3>
<ul>
<li>How to manage links throw wash cli</li>
</ul>
<h3 id="preconditions-1"><a class="header" href="#preconditions-1">Preconditions</a></h3>
<ul>
<li><a href="https://cosmonic.com/docs/user_guide/cosmo_cli">Cosmonic cli</a> installed</li>
<li><a href="https://wasmcloud.com/docs/installation?os=mac">wash</a> installed</li>
</ul>
<h3 id="stages--1"><a class="header" href="#stages--1">Stages :</a></h3>
<ol>
<li><a href="HANDBOOK/link-management.html#stage1">Stage 1</a> : Query Links</li>
<li><a href="HANDBOOK/link-management.html#stage2">Stage 2</a> : Delete Link</li>
<li><a href="HANDBOOK/link-management.html#stage3">Stage 3</a> : Create Link</li>
</ol>
<hr />
<h2 id="stage-1--query-links"><a class="header" href="#stage-1--query-links">Stage 1 : Query Links <a name="stage1"></a></a></h2>
<p>open your terminal and execute the below command</p>
<blockquote>
<p>wash ctl link query -x 125b2a01-09a1-4d64-8bfc-5aa222e9c560 --ctl-port 4222 --ctl-host connect.cosmonic.sh --ctl-credsfile ~/.cosmo/user.creds</p>
</blockquote>
<p>This command will retun the id of the Links</p>
<h2 id="stage-2--delete-link"><a class="header" href="#stage-2--delete-link">Stage 2 : Delete Link <a name="stage2"></a></a></h2>
<p>open your terminal and execute the below command</p>
<blockquote>
<p>wash ctl link del <em><strong>&lt;link_id&gt;</strong></em> wasmcloud:keyvalue -x 125b2a01-09a1-4d64-8bfc-5aa222e9c560 --ctl-port 4222 --ctl-host connect.cosmonic.sh --ctl-credsfile ~/.cosmo/user.creds</p>
</blockquote>
<p><em><strong>link_id</strong></em> : is the id returned from Stage 1</p>
<h2 id="stage-3--create-link"><a class="header" href="#stage-3--create-link">Stage 3 : Create Link <a name="stage3"></a></a></h2>
<p>open your terminal and execute the below command</p>
<blockquote>
<p>wash ctl link put --link-name <em><strong>&lt;LINK_NAME&gt;</strong></em> [OPTIONS] <em><strong><actor-id></strong></em> <em><strong><provider-id></strong></em> <em><strong><contract-id></strong></em></p>
</blockquote>
<p><em><strong>LINK_NAME</strong></em> : the name of the link you need to create
<em><strong>actor-id</strong></em> : the id of the actor which will use this link
<em><strong>provider-id</strong></em> : the id of the provider which the actor will link to
<em><strong>contract-id</strong></em> : the contract id of this provider</p>
<blockquote>
<p>ex :  wash ctl link put -x 125b2a01-09a1-4d64-8bfc-5aa222e9c560 --ctl-port 4222 --ctl-host connect.cosmonic.sh --ctl-credsfile ~/.cosmo/user.creds --link-name local-redis-to-vod-bucket MCS4KQH3XXYN2CA7TIY4OAWE4Q3J6AZSPWX6BK5EOF7MH2FE76NSGYIF VAKKKUUZH6FWYPS3T6WVAESSPVQMQYJ2IRCXGSHYCOISSIUGCXVJYC6M linkwasmcloud:keyvalue</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="runbook--shutdown-a-host"><a class="header" href="#runbook--shutdown-a-host">Runbook : Shutdown a host</a></h1>
<h3 id="product-name--2"><a class="header" href="#product-name--2">Product name :</a></h3>
<ul>
<li>distributed-rating</li>
</ul>
<h3 id="product-version--2"><a class="header" href="#product-version--2">Product version :</a></h3>
<ul>
<li>All</li>
</ul>
<h3 id="runbook-goals--2"><a class="header" href="#runbook-goals--2">Runbook Goals :</a></h3>
<ul>
<li>Shudown a host in a local machine</li>
</ul>
<h3 id="preconditions-2"><a class="header" href="#preconditions-2">Preconditions</a></h3>
<ul>
<li><a href="https://cosmonic.com/docs/user_guide/cosmo_cli">Cosmonic cli</a> installed</li>
<li><a href="https://wasmcloud.com/docs/installation?os=mac">wash</a> installed</li>
</ul>
<h3 id="stages--2"><a class="header" href="#stages--2">Stages :</a></h3>
<ol>
<li><strong>Stage 1</strong> : Get yout local host id</li>
<li><strong>Stage 2</strong> : Stop the host</li>
</ol>
<hr />
<h2 id="stage-1--get-your-local-host-id"><a class="header" href="#stage-1--get-your-local-host-id">Stage 1 : Get your local host id</a></h2>
<p>open your terminal and execute the below command</p>
<blockquote>
<p>wash ctl get hosts -x 125b2a01-09a1-4d64-8bfc-5aa222e9c560 --ctl-port 4222 --ctl-host connect.cosmonic.sh --ctl-credsfile ~/.cosmo/user.creds</p>
</blockquote>
<p>This command will retun the id of the running hosts</p>
<p><img src="HANDBOOK/img/06_10_00.jpg" alt="example!" /></p>
<h2 id="stage-2--stop-the-host"><a class="header" href="#stage-2--stop-the-host">Stage 2 : Stop the host</a></h2>
<p>open your terminal and execute the below command</p>
<blockquote>
<p>wash ctl stop host <em><strong>&lt;host_id&gt;</strong></em> -x 125b2a01-09a1-4d64-8bfc-5aa222e9c560 --ctl-port 4222 --ctl-host connect.cosmonic.sh --ctl-credsfile ~/.cosmo/user.creds</p>
</blockquote>
<p><em><strong>host_id</strong></em> : is the id returned from Stage 1</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="rationale"><a class="header" href="#rationale">Rationale</a></h1>
<h2 id="context-1"><a class="header" href="#context-1">Context</a></h2>
<p>IPCEI CIS WP2</p>
<ul>
<li>Cloud Infrastructure and Services</li>
<li>Work Package #2</li>
<li>Orange submission: open-source and distributed Core Commerce for IT</li>
</ul>
<h2 id="value-proposition"><a class="header" href="#value-proposition">Value proposition</a></h2>
<ul>
<li>
<p>In a complex service ecosystem and/or 5G context, the rating of service usage is highly complex:</p>
<ul>
<li>service providers are no longer those who are in direct contact with the customer or those who invoice the customer, there are aggregators, marketplaces...</li>
<li>the pricing rules for the usage of technical services may be different depending on the reseller (composite services, service bundles, discounts on purchase, on usage)</li>
<li>even more: "à la carte" pricing for each customer</li>
</ul>
</li>
<li>
<p>Rather than uploading raw usage data (~CDR), rated in a centralized rating engine system (or semi-distributed between the various partners who contribute to the final service provided to the customer), we propose to ditribute the rating process to the customer device and upload to the service vendor of usage tickets already valued</p>
<ul>
<li>each of the partners contributes to the specific pricing of the customer, the pricing is made directly at the same time as the consumption of the service</li>
<li>to do a parallel with rights management: it is easier to have components that each carry their authorization model rather than applying the model externally to the entire system</li>
<li>each partner brings (in the form of an agent) the valuation engine of his service, possibly configured / overloaded by a partner reusing this service</li>
<li>"as code" rating engine approach rather than a fixed and parameterized system</li>
</ul>
</li>
<li>
<p>Prerequisites for this scenario are: "reasonably secure" device environment, possibility of deploying code on this environment, ability to detect fraud</p>
</li>
<li>
<p>Orange offers an SDK to its partners allowing them to simply integrate the enhancement of the service into the application used to consume the service</p>
<ul>
<li>the SDK is a wasmcloud-js runtime that can run code (1 or wasmcloud agents) in charge of recovery</li>
<li>the service consumer application feeds the SDK with usage data</li>
</ul>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="requirements"><a class="header" href="#requirements">Requirements</a></h1>
<h2 id="main-problematics"><a class="header" href="#main-problematics">Main problematics</a></h2>
<ul>
<li>
<p>build a model that can support all scenarios of an open service ecosystem (B2B2X)</p>
<ul>
<li>vendors, aggregators, marketplaces, dynamic, as-a-service, recharging...</li>
</ul>
</li>
<li>
<p>establish a shared trust between the 3 main actors (Service Provider, Vendor and Consumer)</p>
<ul>
<li>being able to distribute (crypto) proofs <em>of usage, of subscription...</em></li>
<li>"good enought" security model, especially on the users devices</li>
</ul>
</li>
<li>
<p>fraud detection mecanism</p>
</li>
</ul>
<h2 id="requirements-1"><a class="header" href="#requirements-1">Requirements</a></h2>
<ul>
<li>
<p>the solution</p>
<ul>
<li>cannot rely on DPI to identify trafic usage (cf. HTTP2/3/QUIC)</li>
<li>is over-IP</li>
<li>implement (or is frendly to) fraud detection mecanisms and is auditable</li>
<li>does not require prior human agreement between the service vendor and the service provider (self-service)</li>
</ul>
</li>
<li>
<p>optionnally, the solution should</p>
<ul>
<li>be compatible with a non reliable network (intermitent conncectivity, off-line mode)</li>
</ul>
</li>
</ul>
<h2 id="use-cases"><a class="header" href="#use-cases">Use cases</a></h2>
<p>Some base examples, they could be combined</p>
<ul>
<li>customers sharing the same bucket for a given service (eg. Friends and Family offers)</li>
<li>vendors reselling bundles of services with a different tarification (eg. 30% on Netflix + OCS bundle)</li>
<li>composite offer (eg. free dataplan for watching VOD service)</li>
<li>context dependant offers (eg. free videoconference while being at a special event)</li>
<li>sponsored services (eg. third party offering 20% coupons on VOD for two months)</li>
<li>each customer gets its personalized offer</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="model"><a class="header" href="#model">Model</a></h1>
<h2 id="domain-exploration"><a class="header" href="#domain-exploration">Domain exploration</a></h2>
<ul>
<li>3 main actors
<ul>
<li>Service Consumer</li>
<li>Service Vendor</li>
<li>Service Provider</li>
</ul>
</li>
</ul>
<p><img src="ARCHIVE/./model-overview.drawio.svg" alt="" /></p>
<ul>
<li>
<p>concepts</p>
<ul>
<li>rating engine</li>
<li>proofs
<ul>
<li>subscription</li>
<li>usage</li>
<li>identity</li>
</ul>
</li>
</ul>
</li>
<li>
<p>offers</p>
<ul>
<li>on usage</li>
<li>pre-paid
<ul>
<li>can an monthly subscription be seen as pre-paid?</li>
</ul>
</li>
</ul>
</li>
<li>
<p>payments</p>
<ul>
<li>3 types
<ul>
<li>µ-transaction: no billing, 1 usage = 1 <strong>immediate</strong> payment</li>
<li>post-paid: 1 usage = 1 <strong>future</strong> payment on a bill</li>
<li>pre-paid: w/ bucket, 1 usage = 1 bucket update</li>
</ul>
</li>
<li>in a 3-party interaction (user, vendor, provider)
<ul>
<li>either the provider has to trust the vendor to "recover user's paiments"
<ul>
<li>needs pre-agreement or a base of trusted vendors) <strong>DONT: incompatible w/ requirements</strong></li>
</ul>
</li>
<li>either the vendor is paying the provider immediatly for the user's usage</li>
<li>either the vendor has already bought a "pre-paid bucket" to the provider</li>
</ul>
</li>
</ul>
</li>
<li>
<p>B2B2C scenarios, bucket delegation</p>
<ul>
<li>the vendor buys pre-paid bucket to the provider
<ul>
<li>it can split it among it's users
<ul>
<li>user is paying the usage directly to the provider</li>
</ul>
</li>
<li>or decide to have an other payment type (µ-payment, billing)
<ul>
<li>vendor is paying the usage to the provider</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="findings"><a class="header" href="#findings">findings</a></h3>
<ul>
<li>billing is a vendors responsibility, not a provider one</li>
<li>it might be simplier (ie. support more scenarios) to always have a user&gt;vendor&gt;provider chain instead of a direct user&gt;provider relation</li>
</ul>
<h3 id="to-be-discussed"><a class="header" href="#to-be-discussed">to be discussed</a></h3>
<ul>
<li>
<p>entities modeling</p>
<ul>
<li>are Service Vendors also service providers?</li>
<li>are service Vendors also service consumers?</li>
<li>implementation note: instead of inheritance we can use traits</li>
</ul>
</li>
<li>
<p>where shoud the usage proof go ?</p>
<ul>
<li>service vendor / provider / both</li>
<li>avoid proxies</li>
</ul>
</li>
<li>
<p>similar / alternative approaches</p>
<ul>
<li><a href="https://www.mavoco.com/cmp-connenctivity-management-platform/connectivity-online-usage-controller/">Distributed IoT Online Rating – The Global Rating Grid @mavoco.com</a></li>
<li>are there research papers on the subject?</li>
<li>Shine (Orange internal project) third party use-cases</li>
</ul>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="solution-1"><a class="header" href="#solution-1">Solution 1</a></h1>
<p>proposed solution (WIP)</p>
<h2 id="third-party-management-1"><a class="header" href="#third-party-management-1">third party management</a></h2>
<ul>
<li>definitions
<ul>
<li>service vendor: customer-facing tier, manages the customer subscription, billing and payments</li>
<li>service provider: provides a technical service, also acts as a service vendor in B2B2X scenarios</li>
</ul>
</li>
</ul>
<h3 id="basic-case-the-service-vendor-is-the-service-provider-1"><a class="header" href="#basic-case-the-service-vendor-is-the-service-provider-1">basic case: the service vendor is the service provider</a></h3>
<ul>
<li>
<p>key ideas</p>
<ul>
<li>usage rating is done client-side via a <strong>rating agent</strong> deployed inside the service client app</li>
<li>a rating agent also acts as an authorization for consuming the service</li>
<li>a rating agents is the implementation of a commercial offer subscibed by the customer, it is managed like a contract</li>
</ul>
</li>
<li>
<p>communication diagram</p>
<p><img src="ARCHIVE/./sequence-3rdparty-basic.drawio.svg" alt="" /></p>
</li>
</ul>
<h3 id="complex-case-service-vendor-and-service-provider-1"><a class="header" href="#complex-case-service-vendor-and-service-provider-1">complex case: service vendor and service provider</a></h3>
<ul>
<li>
<p>key ideas</p>
<ul>
<li>the service vendor subscribes to a service provider (exactly like an end-user customer)</li>
<li>the users rating agent is a composite of service vendor and service provider rating agents</li>
<li>the service provider's rating agent is used as the authorization for consuming the service</li>
<li>end-user usage is uploaded to both service vendor and service provider</li>
</ul>
</li>
<li>
<p>communication diagram: service subscription</p>
<p><img src="ARCHIVE/./sequence-3rdparty-complex-subscription.drawio.svg" alt="" /></p>
</li>
<li>
<p>communication diagram: service usage</p>
<p><img src="ARCHIVE/./sequence-3rdparty-complex-usage.drawio.svg" alt="" /></p>
</li>
</ul>
<blockquote>
<p>and what about provisionning?</p>
</blockquote>
<h2 id="counting-and-rating-1"><a class="header" href="#counting-and-rating-1">counting and rating</a></h2>
<ul>
<li>
<p>a rating agent is a program specific a service / a commercial offer / a payment mode</p>
</li>
<li>
<p>its implementation will depend on the use cases</p>
<p><img src="ARCHIVE/./contract-agent.drawio.svg" alt="" /></p>
</li>
</ul>
<h3 id="post-paid-1"><a class="header" href="#post-paid-1">post-paid</a></h3>
<p>rating agent will</p>
<ul>
<li>authorize the customer to consume the service</li>
<li>generate <strong>rated proofs of service usage</strong> that will be aggregated on the customer bill (maintained by the service vendor)</li>
</ul>
<h3 id="prepaid--bucket-management-1"><a class="header" href="#prepaid--bucket-management-1">prepaid / bucket management</a></h3>
<p>rating agent will</p>
<ul>
<li>manage a <strong>stateful service bucket</strong> and consume it according to customer usage</li>
<li>report on the consuption of the service bucket</li>
<li>authorize the customer to consume the service</li>
<li>generates rated proofs of service usage, used for auditing / fraud detection</li>
</ul>
<h3 id="µ-payments-1"><a class="header" href="#µ-payments-1">µ-payments</a></h3>
<p>rating agent will</p>
<ul>
<li>trigger payment request and expect payment proof before allowing the usage of the service</li>
<li>authorize the customer to consume the service</li>
<li>generates rated proofs of service usage, used for auditing / fraud detection</li>
</ul>
<h2 id="agent-mandatory-traits-1"><a class="header" href="#agent-mandatory-traits-1">agent mandatory traits</a></h2>
<ul>
<li>authorizer trait: <code>authorize(identity) -&gt; key</code></li>
<li>rater trait: <code>rate(usage) -&gt; void</code></li>
</ul>
<h3 id="basic-case-1"><a class="header" href="#basic-case-1">basic case</a></h3>
<p><img src="ARCHIVE/./contract-agent-detailed.drawio.svg" alt="" /></p>
<h3 id="composite-case-1"><a class="header" href="#composite-case-1">composite case</a></h3>
<p><img src="ARCHIVE/./contract-agent-detailed-composite.drawio.svg" alt="" /></p>
<ul>
<li>note that there is "shortcut" in <code>3. get vendor identity</code>. It does not really return an identity but a "vendor service subscription" authorization token. Check next paragraph</li>
</ul>
<h2 id="identity-management-1"><a class="header" href="#identity-management-1">identity management</a></h2>
<p>The IAM have been simplified in the previous diagrams.</p>
<p>We distinguish</p>
<ul>
<li>Client identity (OIDC profile, OAuth token)</li>
<li>Client service subscription authorization token (OAuth token): traded from the client identity, represents the fact that the client has subscribed to the service, regardless its right to access the service (for instance with an empty bucket on a prepaid service)</li>
</ul>
<p>And the same for Service Vendors (which are Clients of Service Providers)</p>
<p>The authorizer trait signature is <code>authorize(service subscription authorization token) -&gt; key</code></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="about-wasmcloud"><a class="header" href="#about-wasmcloud">About wasmCloud</a></h1>
<p><img src="https://cosmonic.com/images/blogs/2022/wasmcloud-from-edge-to-cloud.png" alt="" /></p>
<h2 id="pros--cons"><a class="header" href="#pros--cons">Pros &amp; Cons</a></h2>
<p>wasmCloud pro &amp; cons of in the context of this prototype</p>
<ul>
<li>
<p><strong>pros</strong></p>
<ul>
<li>robust and ubiquous connectivity, network mesh over IP (inherited from NATS)</li>
<li>zero-trust by design (as long as the runtime is secure): signed nodes, payloads &amp; communications</li>
<li>efficient</li>
<li>event driven model, scalable, multi-region friendly</li>
<li>clean split between pure functions (ie. wasmCloud Actors) and internal states / outside world (ie. wasmCloud CapabilityProviders)</li>
<li>node runtime support many different hosts (vm, docker, k8s, browsers...)</li>
<li>polyglot platform (mostly Rust for now)</li>
</ul>
</li>
<li>
<p><strong>cons</strong></p>
<ul>
<li>young technology (in the CNCF sandbox, but quite active)</li>
<li>opinionated PaaS approach
<ul>
<li>no oob support from hyperscalers</li>
</ul>
</li>
<li>wip on orchestration / observability</li>
<li>important learning curve on development stack
<ul>
<li>rust as main programming language</li>
<li>cannot (or difficult to) leverage on existing rust framework</li>
<li>sometimes cryptic error messages</li>
<li>lack of extensive documentation</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>recommandations for this prototype</strong></p>
<ul>
<li>use wasmCloud "at the egde", do not try to implement the whole solution with wasmCloud</li>
</ul>
</li>
</ul>
<h2 id="main-concepts"><a class="header" href="#main-concepts">Main concepts</a></h2>
<div class="table-wrapper"><table><thead><tr><th>concept</th><th>caracteristics</th></tr></thead><tbody>
<tr><td>host</td><td>or node, runtime on a host, erlang VM</td></tr>
<tr><td>lattice</td><td>meshed netork, NATS</td></tr>
<tr><td>actors</td><td>wasm payloads, stateless functions, implementing an interface</td></tr>
<tr><td>capability providers</td><td>wasm payloads, stateful and attached to a node, offering services</td></tr>
<tr><td>links</td><td>declarative links between actors and capability providers</td></tr>
<tr><td>interface</td><td>functionnal interface of an actor / capability</td></tr>
</tbody></table>
</div>
<p>the wasmCloud dashboard
<img src="https://wasmcloud.com/images/blogs/ngs-global/dashboard.png" alt="dashboard" /></p>
<h2 id="resources"><a class="header" href="#resources">Resources</a></h2>
<h3 id="main-sites"><a class="header" href="#main-sites">main sites</a></h3>
<ul>
<li><a href="https://wasmcloud.com/">wasmcloud.com</a> - links, articles</li>
<li><a href="https://wasmcloud.dev/">wasmcloud.dev</a> - product documentation</li>
<li><a href="https://cosmonic.com/">cosmonic.com</a> - the company that supports the opensource</li>
<li><a href="https://nats.io">nats.io</a></li>
</ul>
<h3 id="documentation-and-trainings"><a class="header" href="#documentation-and-trainings">documentation and trainings</a></h3>
<ul>
<li><a href="https://wasmcloud.dev/overview/">wasmCloud doc</a></li>
<li><a href="https://docs.nats.io/">NATS doc</a></li>
<li><a href="https://labs.cosmonic.com/">Cosmonic: Introduction to wasmCloud &amp; WebAssembly basics</a></li>
<li><a href="https://training.linuxfoundation.org/training/webassembly-actors-from-cloud-to-edge-lfd134x/">Linux Foundation: WebAssembly Actors: From Cloud to Edge</a></li>
</ul>
<h3 id="articles"><a class="header" href="#articles">articles</a></h3>
<ul>
<li><a href="https://wasmcloud.com/blog/wasmcloud_third_anniversary/">Reflections on Three Years of wasmCloud, Kevin Hoffman</a></li>
<li><a href="https://wasmcloud.com/blog/webassembly_components_and_wasmcloud_actors_a_glimpse_of_the_future/">WebAssembly Components and wasmCloud Actors: A Glimpse of the Future, Taylor Thomas</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="architecture"><a class="header" href="#architecture">Architecture</a></h1>
<h2 id="components"><a class="header" href="#components">components</a></h2>
<ul>
<li>
<p>browser runtime</p>
<ul>
<li>javascript wasmCloud runtime deployed as javascript SDK</li>
</ul>
</li>
<li>
<p>user ident/authent</p>
<ul>
<li>OIDC / OAuth</li>
<li>expose service to recover browser runtime host-keys</li>
</ul>
</li>
<li>
<p>ngs</p>
<ul>
<li>NATS network</li>
</ul>
</li>
</ul>
<p><img src="ARCHIVE/./architecture.drawio.svg" alt="architecture" /></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="prototype-architecture"><a class="header" href="#prototype-architecture">Prototype Architecture</a></h1>
<h2 id="actor-model"><a class="header" href="#actor-model">actor model</a></h2>
<p><img src="ARCHIVE/prototype-architecture.drawio.svg" alt="" /></p>
<h2 id="git-repos"><a class="header" href="#git-repos">git repos</a></h2>
<pre><code>├── generic
│   ├── agent-api-provider
│   ├── agent-storage-provider
│   └── collector-provider
├── interface
│   ├── agent-storage-interface
│   ├── authorizer-interface
│   ├── collector-interface
│   └── rater-interface
├── specific-orange
│   ├── orange-offer1-agent
│   └── orange-offer1-authorization-provider
└── specific-vendor1
    ├── vendor1-offer1-agent
    └── vendor1-offer1-authorization-provider
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="technical-requirements-and-questions-wip"><a class="header" href="#technical-requirements-and-questions-wip">Technical requirements and questions (WIP)</a></h1>
<h2 id="project-specific"><a class="header" href="#project-specific">project specific</a></h2>
<h3 id="fraud--risk-analysis"><a class="header" href="#fraud--risk-analysis">fraud / risk analysis</a></h3>
<ul>
<li>
<p>is there a risk of a rating-agent doing non-legitimate modifications of its associated bucket / an other bucket?</p>
</li>
<li>
<p>if those risks are too high, can we have "server-side" rating agent proxy to mitigate them?</p>
</li>
</ul>
<h3 id="stateless-agents"><a class="header" href="#stateless-agents">stateless agents</a></h3>
<ul>
<li>how to manage efficiently agents configuration in a stateless word? (caching mechanisms / via dedicated local capability providers?)</li>
</ul>
<h3 id="interagent-communication"><a class="header" href="#interagent-communication">interagent communication</a></h3>
<ul>
<li>how to ensure an actor (rating agent for instance) only speak to its conterpart (collector agent for instance)</li>
</ul>
<h2 id="wasmcloud-generic"><a class="header" href="#wasmcloud-generic">wasmCloud generic</a></h2>
<h3 id="keep-the-rating-agent-code-public-"><a class="header" href="#keep-the-rating-agent-code-public-">keep the rating agent code public ?</a></h3>
<ul>
<li>link between the source code and the wasmCloud actor on OCI regristry ?</li>
</ul>
<h3 id="message-delivery-guarantee"><a class="header" href="#message-delivery-guarantee">message delivery guarantee</a></h3>
<ul>
<li>by design "naked NATS" does <a href="https://docs.nats.io/nats-concepts/overview/compare-nats">not guarantee message delivery</a>, does wasmCloud implement it?</li>
</ul>
<h3 id="do-interfaces-support-inheritance-"><a class="header" href="#do-interfaces-support-inheritance-">do interfaces support inheritance ?</a></h3>
<h3 id="how-to-use-links"><a class="header" href="#how-to-use-links">how to use links</a></h3>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->
        <script src="mermaid.min.js"></script>
        <script src="mermaid-init.js"></script>

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </div>
    </body>
</html>
