<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>IPCEI CIS / WP02 / Distributed Rating Engine</title>
                <meta name="robots" content="noindex" />
                

        <!-- Custom HTML head -->
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

                <link rel="icon" href="favicon.svg">
                        <link rel="shortcut icon" href="favicon.png">
                <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
                <link rel="stylesheet" href="css/print.css" media="print">
        
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
                <link rel="stylesheet" href="fonts/fonts.css">
        
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        
            </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="rationale.html">Rationale</a></li><li class="chapter-item expanded affix "><li class="part-title">Functional</li><li class="chapter-item expanded "><a href="requirements.html"><strong aria-hidden="true">1.</strong> Requirements</a></li><li class="chapter-item expanded "><a href="model.html"><strong aria-hidden="true">2.</strong> Model</a></li><li class="chapter-item expanded "><a href="model-solution1.html"><strong aria-hidden="true">3.</strong> Solution 1</a></li><li class="chapter-item expanded affix "><li class="part-title">Technical</li><li class="chapter-item expanded "><a href="about-wasmcloud.html"><strong aria-hidden="true">4.</strong> About wasmCloud</a></li><li class="chapter-item expanded "><a href="architecture.html"><strong aria-hidden="true">5.</strong> Architecture</a></li></ol>            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                                                <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                                            </div>

                    <h1 class="menu-title">IPCEI CIS / WP02 / Distributed Rating Engine</h1>

                    <div class="right-buttons">
                                                <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                                                                        <a href="https://github.com/distributed-it-for-telco" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                                                
                    </div>
                </div>

                                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="rationale"><a class="header" href="#rationale">Rationale</a></h1>
<h2 id="context"><a class="header" href="#context">Context</a></h2>
<p>IPCEI CIS WP2</p>
<ul>
<li><a href="https://competition-policy.ec.europa.eu/state-aid/legislation/modernisation/ipcei_en">Important Projects of Common European Interest</a></li>
<li>Cloud Infrastructure and Services</li>
<li>Work Package #2</li>
<li>Orange submission: open-source and distributed Core Commerce for IT</li>
</ul>
<h2 id="value-proposition"><a class="header" href="#value-proposition">Value proposition</a></h2>
<ul>
<li>
<p>In a complex service ecosystem and/or 5G context, the rating of service usage is highly complex:</p>
<ul>
<li>service providers are no longer those who are in direct contact with the customer or those who invoice the customer, there are aggregators, marketplaces...</li>
<li>the pricing rules for the usage of technical services may be different depending on the reseller (composite services, service bundles, discounts on purchase, on usage)</li>
<li>even more: &quot;à la carte&quot; pricing for each customer</li>
</ul>
</li>
<li>
<p>Rather than uploading raw usage data (~CDR), rated in a centralized rating engine system (or semi-distributed between the various partners who contribute to the final service provided to the customer), we propose to ditribute the rating process to the customer device and upload to the service vendor of usage tickets already valued</p>
<ul>
<li>each of the partners contributes to the specific pricing of the customer, the pricing is made directly at the same time as the consumption of the service</li>
<li>to do a parallel with rights management: it is easier to have components that each carry their authorization model rather than applying the model externally to the entire system</li>
<li>each partner brings (in the form of an agent) the valuation engine of his service, possibly configured / overloaded by a partner reusing this service</li>
<li>&quot;as code&quot; rating engine approach rather than a fixed and parameterized system</li>
</ul>
</li>
<li>
<p>Prerequisites for this scenario are: &quot;reasonably secure&quot; device environment, possibility of deploying code on this environment, ability to detect fraud</p>
</li>
<li>
<p>Orange offers an SDK to its partners allowing them to simply integrate the enhancement of the service into the application used to consume the service</p>
<ul>
<li>the SDK is a wasmcloud-js runtime that can run code (1 or wasmcloud agents) in charge of recovery</li>
<li>the service consumer application feeds the SDK with usage data</li>
</ul>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="requirements"><a class="header" href="#requirements">Requirements</a></h1>
<h2 id="main-problematics"><a class="header" href="#main-problematics">Main problematics</a></h2>
<ul>
<li>
<p>build a model that can support all scenarios of an open service ecosystem (B2B2X)</p>
<ul>
<li>vendors, aggregators, marketplaces, dynamic, as-a-service, recharging...</li>
</ul>
</li>
<li>
<p>establish a shared trust between the 3 main actors (Service Provider, Vendor and Consumer)</p>
<ul>
<li>being able to distribute (crypto) proofs <em>of usage, of subscription...</em></li>
<li>&quot;good enought&quot; security model, especially on the users devices</li>
</ul>
</li>
<li>
<p>fraud detection mecanism</p>
</li>
</ul>
<h2 id="requirements-1"><a class="header" href="#requirements-1">Requirements</a></h2>
<ul>
<li>
<p>the solution </p>
<ul>
<li>cannot rely on DPI to identify trafic usage (cf. HTTP2/3/QUIC)</li>
<li>is over-IP</li>
<li>implement (or is frendly to) fraud detection mecanisms and is auditable</li>
<li>does not require prior human agreement between the service vendor and the service provider (self-service)</li>
</ul>
</li>
<li>
<p>optionnally, the solution should</p>
<ul>
<li>be compatible with a non reliable network (intermitent conncectivity, off-line mode)</li>
</ul>
</li>
</ul>
<h2 id="use-cases"><a class="header" href="#use-cases">Use cases</a></h2>
<p>Some base examples, they could be combined</p>
<ul>
<li>clients sharing the same bucket for a given service (eg. Friends and Family offers)</li>
<li>vendors reselling bundles of services with a different tarification (eg. 30% on Netflix + OCS bundle)</li>
<li>composite offer (eg. free dataplan for watching VOD service)</li>
<li>context dependant offers (eg. free videoconference while being at a special event)</li>
<li>sponsored services (eg. third party offering 20% coupons on VOD for two months)</li>
<li>each client gets its personalized offer</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="model"><a class="header" href="#model">Model</a></h1>
<h2 id="domain-exploration"><a class="header" href="#domain-exploration">Domain exploration</a></h2>
<ul>
<li>3 main actors
<ul>
<li>Service Consumer</li>
<li>Service Vendor</li>
<li>Service Provider</li>
</ul>
</li>
</ul>
<p><img src="./model-overview.drawio.svg" alt="" /></p>
<ul>
<li>
<p>concepts</p>
<ul>
<li>rating engine</li>
<li>proofs
<ul>
<li>subscription</li>
<li>usage</li>
<li>identity</li>
</ul>
</li>
</ul>
</li>
<li>
<p>offers</p>
<ul>
<li>on usage</li>
<li>pre-paid
<ul>
<li>can an monthly subscription be seen as pre-paid?</li>
</ul>
</li>
</ul>
</li>
<li>
<p>payments</p>
<ul>
<li>3 types
<ul>
<li>µ-transaction: no billing, 1 usage = 1 <strong>immediate</strong> payment</li>
<li>post-paid: 1 usage = 1 <strong>future</strong> payment on a bill</li>
<li>pre-paid: w/ bucket, 1 usage = 1 bucket update</li>
</ul>
</li>
<li>in a 3-party interaction (user, vendor, provider)
<ul>
<li>either the provider has to trust the vendor to &quot;recover user's paiments&quot; 
<ul>
<li>needs pre-agreement or a base of trusted vendors) <strong>DONT: incompatible w/ requirements</strong></li>
</ul>
</li>
<li>either the vendor is paying the provider immediatly for the user's usage</li>
<li>either the vendor has already bought a &quot;pre-paid bucket&quot; to the provider</li>
</ul>
</li>
</ul>
</li>
<li>
<p>B2B2C scenarios, bucket delegation</p>
<ul>
<li>the vendor buys pre-paid bucket to the provider
<ul>
<li>it can split it among it's users
<ul>
<li>user is paying the usage directly to the provider</li>
</ul>
</li>
<li>or decide to have an other payment type (µ-payment, billing)
<ul>
<li>vendor is paying the usage to the provider</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="findings"><a class="header" href="#findings">findings</a></h3>
<ul>
<li>billing is a vendors responsibility, not a provider one</li>
<li>it might be simplier (ie. support more scenarios) to always have a user&gt;vendor&gt;provider chain instead of a direct user&gt;provider relation</li>
</ul>
<h3 id="to-be-discussed"><a class="header" href="#to-be-discussed">to be discussed</a></h3>
<ul>
<li>
<p>entities modeling</p>
<ul>
<li>are Service Vendors also service providers?</li>
<li>are service Vendors also service consumers?</li>
<li>implementation note: instead of inheritance we can use traits</li>
</ul>
</li>
<li>
<p>where shoud the usage proof go ?</p>
<ul>
<li>service vendor / provider / both</li>
<li>avoid proxies</li>
</ul>
</li>
<li>
<p>similar / alternative approaches</p>
<ul>
<li><a href="https://www.mavoco.com/cmp-connenctivity-management-platform/connectivity-online-usage-controller/">Distributed IoT Online Rating – The Global Rating Grid @mavoco.com</a></li>
<li>are there research papers on the subject?</li>
<li>Shine (Orange internal project) third party use-cases</li>
</ul>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="solution-1"><a class="header" href="#solution-1">Solution 1</a></h1>
<p>proposed solution (WIP)</p>
<h2 id="third-party-management"><a class="header" href="#third-party-management">third party management</a></h2>
<h3 id="basic-case-the-service-vendor-is-the-service-provider"><a class="header" href="#basic-case-the-service-vendor-is-the-service-provider">basic case: the service vendor is the service provider</a></h3>
<ul>
<li>
<p>key ideas</p>
<ul>
<li>usage rating is done client-side via a <strong>rating agent</strong> deployed inside the service client app</li>
<li>a rating agent also acts as an authorization for consuming the service</li>
<li>a rating agents is the implementation of a commercial offer subscibed by the client, it is managed like a contract</li>
</ul>
</li>
<li>
<p>communication diagram</p>
</li>
</ul>
<p><img src="./sequence-3rdparty-basic.drawio.svg" alt="" /></p>
<h3 id="complex-case-service-vendor-and-service-provider"><a class="header" href="#complex-case-service-vendor-and-service-provider">complex case: service vendor and service provider</a></h3>
<ul>
<li>key ideas
<ul>
<li>the service vendor subscribes to a service provider (exactly like an end-user customer)</li>
<li>the users rating agent is a composite of service vendor and service provider rating agents</li>
<li>the service provider's rating agent is used as the authorization for consuming the service</li>
<li>end-user usage is uploaded to both service vendor and service provider</li>
</ul>
</li>
</ul>
<h4 id="service-subscription"><a class="header" href="#service-subscription">service subscription</a></h4>
<p><img src="./sequence-3rdparty-complex-subscription.drawio.svg" alt="" /></p>
<h4 id="service-usage"><a class="header" href="#service-usage">service usage</a></h4>
<p><img src="./sequence-3rdparty-complex-usage.drawio.svg" alt="" /></p>
<blockquote>
<p>and what about provisionning?</p>
</blockquote>
<h2 id="counting-and-rating"><a class="header" href="#counting-and-rating">counting and rating</a></h2>
<h3 id="prepaid--bucket-management"><a class="header" href="#prepaid--bucket-management">prepaid / bucket management</a></h3>
<h3 id="post-paid"><a class="header" href="#post-paid">post-paid</a></h3>
<h3 id="µ-payments"><a class="header" href="#µ-payments">µ-payments</a></h3>
<div style="break-before: page; page-break-before: always;"></div><h1 id="about-wasmcloud"><a class="header" href="#about-wasmcloud">About wasmCloud</a></h1>
<p><img src="https://cosmonic.com/images/blogs/2022/wasmcloud-from-edge-to-cloud.png" alt="" /></p>
<h2 id="pros--cons"><a class="header" href="#pros--cons">Pros &amp; Cons</a></h2>
<p>wasmCloud pro &amp; cons of in the context of this prototype</p>
<ul>
<li>
<p><strong>pros</strong></p>
<ul>
<li>robust and ubiquous connectivity, network mesh over IP (inherited from NATS)</li>
<li>zero-trust by design (as long as the runtime is secure): signed nodes, payloads &amp; communications</li>
<li>efficient</li>
<li>event driven model, scalable, multi-region friendly</li>
<li>clean split between pure functions (ie. wasmCloud Actors) and internal states / outside world (ie. wasmCloud CapabilityProviders)</li>
<li>node runtime support many different hosts (vm, docker, k8s, browsers...)</li>
<li>polyglot platform (mostly Rust for now)</li>
</ul>
</li>
<li>
<p><strong>cons</strong></p>
<ul>
<li>young technology (in the CNCF sandbox, but quite active)</li>
<li>opinionated PaaS approach
<ul>
<li>no oob support from hyperscalers</li>
</ul>
</li>
<li>wip on orchestration / observability</li>
<li>important learning curve on development stack
<ul>
<li>rust as main programming language</li>
<li>cannot (or difficult to) leverage on existing rust framework</li>
<li>sometimes cryptic error messages</li>
<li>lack of extensive documentation</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>recommandations for this prototype</strong></p>
<ul>
<li>use wasmCloud &quot;at the egde&quot;, do not try to implement the whole solution with wasmCloud</li>
</ul>
</li>
</ul>
<h2 id="main-concepts"><a class="header" href="#main-concepts">Main concepts</a></h2>
<table><thead><tr><th>concept</th><th>caracteristics</th></tr></thead><tbody>
<tr><td>host</td><td>or node, runtime on a host, erlang VM</td></tr>
<tr><td>lattice</td><td>meshed netork, NATS</td></tr>
<tr><td>actors</td><td>wasm payloads, stateless functions, implementing an interface</td></tr>
<tr><td>capability providers</td><td>wasm payloads, stateful and attached to a node, offering services</td></tr>
<tr><td>links</td><td>declarative links between actors and capability providers</td></tr>
<tr><td>interface</td><td>functionnal interface of an actor / capability</td></tr>
</tbody></table>
<p>the wasmCloud dashboard
<img src="https://wasmcloud.com/images/blogs/ngs-global/dashboard.png" alt="dashboard" /></p>
<h2 id="resources"><a class="header" href="#resources">Resources</a></h2>
<h3 id="main-sites"><a class="header" href="#main-sites">main sites</a></h3>
<ul>
<li><a href="https://wasmcloud.com/">wasmcloud.com</a> - links, articles</li>
<li><a href="https://wasmcloud.dev/">wasmcloud.dev</a> - product documentation</li>
<li><a href="https://cosmonic.com/">cosmonic.com</a> - the company that supports the opensource</li>
<li><a href="https://nats.io">nats.io</a></li>
</ul>
<h3 id="documentation-and-trainings"><a class="header" href="#documentation-and-trainings">documentation and trainings</a></h3>
<ul>
<li><a href="https://wasmcloud.dev/overview/">wasmCloud doc</a></li>
<li><a href="https://docs.nats.io/">NATS doc</a></li>
<li><a href="https://labs.cosmonic.com/">Cosmonic: Introduction to wasmCloud &amp; WebAssembly basics</a></li>
<li><a href="https://training.linuxfoundation.org/training/webassembly-actors-from-cloud-to-edge-lfd134x/">Linux Foundation: WebAssembly Actors: From Cloud to Edge</a></li>
</ul>
<h3 id="articles"><a class="header" href="#articles">articles</a></h3>
<ul>
<li><a href="https://wasmcloud.com/blog/wasmcloud_third_anniversary/">Reflections on Three Years of wasmCloud, Kevin Hoffman</a></li>
<li><a href="https://wasmcloud.com/blog/webassembly_components_and_wasmcloud_actors_a_glimpse_of_the_future/">WebAssembly Components and wasmCloud Actors: A Glimpse of the Future, Taylor Thomas</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="architecture"><a class="header" href="#architecture">Architecture</a></h1>
<h2 id="components"><a class="header" href="#components">components</a></h2>
<ul>
<li>
<p>browser runtime</p>
<ul>
<li>javascript wasmCloud runtime deployed as javascript SDK</li>
</ul>
</li>
<li>
<p>user ident/authent</p>
<ul>
<li>OIDC / OAuth</li>
<li>expose service to recover browser runtime host-keys</li>
</ul>
</li>
<li>
<p>ngs</p>
<ul>
<li>NATS network</li>
</ul>
</li>
</ul>
<p><img src="./architecture.drawio.svg" alt="architecture" /></p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                        
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                            </nav>

        </div>

        
        
        
                <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        
        
                <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        
                        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
                
    </body>
</html>
