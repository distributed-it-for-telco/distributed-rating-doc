<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Distributed Rating Engine with wasmCloud</title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="./mdbook-admonish.css">

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "light" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="about.html">About</a></li><li class="chapter-item expanded affix "><li class="part-title">Concepts</li><li class="chapter-item expanded "><a href="CONCEPTS/concepts.html"><strong aria-hidden="true">1.</strong> Concepts</a></li><li class="chapter-item expanded affix "><li class="part-title">Architecture</li><li class="chapter-item expanded "><a href="ARCHITECTURE/architecture.html"><strong aria-hidden="true">2.</strong> Software Architecture</a></li><li class="chapter-item expanded "><a href="ARCHITECTURE/functional-specification.html"><strong aria-hidden="true">3.</strong> Functional Specification</a></li><li class="chapter-item expanded affix "><li class="part-title">Use Cases</li><li class="chapter-item expanded "><a href="USE-CASES/UC-01/index.html"><strong aria-hidden="true">4.</strong> UC-01: Customer product inventory</a></li><li class="chapter-item expanded "><a href="USE-CASES/UC-02/index.html"><strong aria-hidden="true">5.</strong> UC-02: Rate usage - Overview</a></li><li class="chapter-item expanded "><a href="USE-CASES/UC-03/index.html"><strong aria-hidden="true">6.</strong> UC-03: Rate usage - Regular</a></li><li class="chapter-item expanded "><a href="USE-CASES/UC-04/index.html"><strong aria-hidden="true">7.</strong> UC-04: Rate usage - Threshold</a></li><li class="chapter-item expanded "><a href="USE-CASES/UC-05/index.html"><strong aria-hidden="true">8.</strong> UC-05: Rate usage - Bundle</a></li><li class="chapter-item expanded affix "><li class="part-title">Architecture decision records</li><li class="chapter-item expanded "><a href="ADR/ard001-monorepo_code_organization.html"><strong aria-hidden="true">9.</strong> Monorepo code organization</a></li><li class="chapter-item expanded affix "><li class="part-title">How-to</li><li class="chapter-item expanded "><a href="HOW-TO/kickstart.html"><strong aria-hidden="true">10.</strong> WasmCloud Kickstart</a></li><li class="chapter-item expanded "><a href="HOW-TO/smithy-notes.html"><strong aria-hidden="true">11.</strong> Smithy</a></li><li class="chapter-item expanded affix "><li class="part-title">Handbook</li><li class="chapter-item expanded "><a href="HANDBOOK/kv-store-management.html"><strong aria-hidden="true">12.</strong> Key-Value store management</a></li><li class="chapter-item expanded "><a href="HANDBOOK/link-management.html"><strong aria-hidden="true">13.</strong> Link management</a></li><li class="chapter-item expanded "><a href="HANDBOOK/shutdown-host.html"><strong aria-hidden="true">14.</strong> Shutdown host</a></li><li class="chapter-item expanded affix "><li class="part-title">Archives</li><li class="chapter-item expanded "><a href="ARCHIVE/rationale.html"><strong aria-hidden="true">15.</strong> Rationale</a></li><li class="chapter-item expanded "><a href="ARCHIVE/requirements.html"><strong aria-hidden="true">16.</strong> Requirements</a></li><li class="chapter-item expanded "><a href="ARCHIVE/model.html"><strong aria-hidden="true">17.</strong> Model</a></li><li class="chapter-item expanded "><a href="ARCHIVE/model-solution1.html"><strong aria-hidden="true">18.</strong> Solution 1</a></li><li class="chapter-item expanded "><a href="ARCHIVE/about-wasmcloud.html"><strong aria-hidden="true">19.</strong> About wasmCloud</a></li><li class="chapter-item expanded "><a href="ARCHIVE/architecture.html"><strong aria-hidden="true">20.</strong> wasmCloud Architecture</a></li><li class="chapter-item expanded "><a href="ARCHIVE/prototype-architecture.html"><strong aria-hidden="true">21.</strong> Prototype Architecture</a></li><li class="chapter-item expanded "><a href="ARCHIVE/technical-requirements.html"><strong aria-hidden="true">22.</strong> Technical requirements</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Distributed Rating Engine with wasmCloud</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/distributed-it-for-telco" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="about-the-distributed-rating-project"><a class="header" href="#about-the-distributed-rating-project">About the distributed-rating project</a></h1>
<p>Mermaid test</p>
<pre class="mermaid">graph TD;
    A--&gt;B;
    A--&gt;C;
    B--&gt;D;
    C--&gt;D;
</pre>
<p>Admonish test</p>
<div id="admonition-info" class="admonition admonish-info">
<div class="admonition-title">
<p>Info</p>
<p><a class="admonition-anchor-link" href="about.html#admonition-info"></a></p>
</div>
<div>
<p>A beautifully styled message.</p>
</div>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="concepts"><a class="header" href="#concepts">Concepts</a></h1>
<h2 id="third-party-management"><a class="header" href="#third-party-management">third party management</a></h2>
<ul>
<li>definitions
<ul>
<li>service vendor: customer-facing tier, manages the customer subscription, billing and payments</li>
<li>service provider: provides a technical service, also acts as a service vendor in B2B2X scenarios</li>
</ul>
</li>
</ul>
<h3 id="basic-case-the-service-vendor-is-the-service-provider"><a class="header" href="#basic-case-the-service-vendor-is-the-service-provider">basic case: the service vendor is the service provider</a></h3>
<ul>
<li>
<p>key ideas</p>
<ul>
<li>usage rating is done client-side via a <strong>rating agent</strong> deployed inside the service client app</li>
<li>a rating agent also acts as an authorization for consuming the service</li>
<li>a rating agents is the implementation of a commercial offer subscibed by the customer, it is managed like a contract</li>
</ul>
</li>
<li>
<p>communication diagram</p>
<p><img src="CONCEPTS/./sequence-3rdparty-basic.drawio.svg" alt="" /></p>
</li>
</ul>
<h3 id="complex-case-service-vendor-and-service-provider"><a class="header" href="#complex-case-service-vendor-and-service-provider">complex case: service vendor and service provider</a></h3>
<ul>
<li>
<p>key ideas</p>
<ul>
<li>the service vendor subscribes to a service provider (exactly like an end-user customer)</li>
<li>the users rating agent is a composite of service vendor and service provider rating agents</li>
<li>the service provider's rating agent is used as the authorization for consuming the service</li>
<li>end-user usage is uploaded to both service vendor and service provider</li>
</ul>
</li>
<li>
<p>communication diagram: service subscription</p>
<p><img src="CONCEPTS/./sequence-3rdparty-complex-subscription.drawio.svg" alt="" /></p>
</li>
<li>
<p>communication diagram: service usage</p>
<p><img src="CONCEPTS/./sequence-3rdparty-complex-usage.drawio.svg" alt="" /></p>
</li>
</ul>
<blockquote>
<p>and what about provisionning?</p>
</blockquote>
<h2 id="counting-and-rating"><a class="header" href="#counting-and-rating">counting and rating</a></h2>
<ul>
<li>
<p>a rating agent is a program specific a service / a commercial offer / a payment mode</p>
</li>
<li>
<p>its implementation will depend on the use cases</p>
<p><img src="CONCEPTS/./contract-agent.drawio.svg" alt="" /></p>
</li>
</ul>
<h3 id="post-paid"><a class="header" href="#post-paid">post-paid</a></h3>
<p>rating agent will</p>
<ul>
<li>authorize the customer to consume the service</li>
<li>generate <strong>rated proofs of service usage</strong> that will be aggregated on the customer bill (maintained by the service vendor)</li>
</ul>
<h3 id="prepaid--bucket-management"><a class="header" href="#prepaid--bucket-management">prepaid / bucket management</a></h3>
<p>rating agent will</p>
<ul>
<li>manage a <strong>stateful service bucket</strong> and consume it according to customer usage</li>
<li>report on the consuption of the service bucket</li>
<li>authorize the customer to consume the service</li>
<li>generates rated proofs of service usage, used for auditing / fraud detection</li>
</ul>
<h3 id="µ-payments"><a class="header" href="#µ-payments">µ-payments</a></h3>
<p>rating agent will</p>
<ul>
<li>trigger payment request and expect payment proof before allowing the usage of the service</li>
<li>authorize the customer to consume the service</li>
<li>generates rated proofs of service usage, used for auditing / fraud detection</li>
</ul>
<h2 id="agent-mandatory-traits"><a class="header" href="#agent-mandatory-traits">agent mandatory traits</a></h2>
<ul>
<li>authorizer trait: <code>authorize(identity) -&gt; key</code></li>
<li>rater trait: <code>rate(usage) -&gt; void</code></li>
</ul>
<h3 id="basic-case"><a class="header" href="#basic-case">basic case</a></h3>
<p><img src="CONCEPTS/./contract-agent-detailed.drawio.svg" alt="" /></p>
<h3 id="composite-case"><a class="header" href="#composite-case">composite case</a></h3>
<p><img src="CONCEPTS/./contract-agent-detailed-composite.drawio.svg" alt="" /></p>
<ul>
<li>note that there is &quot;shortcut&quot; in <code>3. get vendor identity</code>. It does not really return an identity but a &quot;vendor service subscription&quot; authorization token. Check next paragraph</li>
</ul>
<h2 id="identity-management"><a class="header" href="#identity-management">identity management</a></h2>
<p>The IAM have been simplified in the previous diagrams.</p>
<p>We distinguish</p>
<ul>
<li>Client identity (OIDC profile, OAuth token)</li>
<li>Client service subscription authorization token (OAuth token): traded from the client identity, represents the fact that the client has subscribed to the service, regardless its right to access the service (for instance with an empty bucket on a prepaid service)</li>
</ul>
<p>And the same for Service Vendors (which are Clients of Service Providers)</p>
<p>The authorizer trait signature is <code>authorize(service subscription authorization token) -&gt; key</code></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="software-architecture"><a class="header" href="#software-architecture">Software Architecture</a></h1>
<h2 id="actors"><a class="header" href="#actors">Actors</a></h2>
<pre class="mermaid">flowchart LR

  vod(VOD Application)
  subgraph common [Common Sub-lattice]
    authz(Client AuthZ Service)
    coordinator(Rating Coordinator)
    crypto(Crypto Provider)
    facade(&quot;Customer Product &lt;br&gt; Inventory Facade&quot;)
    gateway(API gateway)
    httpd(HTTP server provider)
  end
  subgraph orange [Orange Sub-lattice]
    orange_agent_http(&quot;HTTP client Provider &lt;br&gt; (fetch auth keys)&quot;)
    orange_agent_kv(&quot;KV Provider &lt;br&gt; (agent, conf, buckets)&quot;)
    orange_agent(&quot;Orange VOD &lt;br&gt; Rating Agent&quot;)
    orange_collector_kv(KV/SQL Provider)
    orange_collector(&quot;Usage Collector&quot;)
    orange_inventory_kv(KV Provider)
    orange_inventory(&quot;Orange Customer &lt;br&gt; Product Inventory&quot;)
  end
  subgraph partner_x [Partner X Sub-lattice]
    partner_x_agent(&quot;Partner X VOD &lt;br&gt; Rating Agent&quot;)
    partner_x_inventory(&quot;Partner X Customer &lt;br&gt; Product Inventory&quot;)
  end
  subgraph partner_y [Partner Y Sub-lattice]
    partner_y_agent(&quot;Partner Y VOD &lt;br&gt; Rating Agent&quot;)
    partner_y_inventory(&quot;Partner Y Customer &lt;br&gt; Product Inventory&quot;)
  end

  coordinator --&gt; orange_agent
  coordinator --&gt; partner_x_agent
  coordinator --&gt; partner_y_agent
  crypto -.-&gt; authz
  facade --&gt;|Search|orange_inventory
  facade --&gt;|Search|partner_x_inventory
  facade --&gt;|Search|partner_y_inventory
  gateway --&gt; authz
  gateway --&gt; coordinator
  gateway --&gt; facade
  gateway &lt;-.- httpd
  orange_agent --&gt; orange_collector
  orange_agent &lt;-.- orange_agent_http
  orange_agent &lt;-.- orange_agent_kv
  orange_collector_kv -.-&gt; orange_collector
  orange_inventory_kv -.-&gt; orange_inventory
  vod --&gt; httpd
  
  classDef domain fill:#fffff7,stroke-dasharray:10,stroke-width:2px,font-weight:bold
  class common,orange,partner_x,partner_y domain

  classDef offer fill:#d6e8d5
  class vod,orange_agent,partner_x_agent,partner_y_agent offer

  classDef provider fill:#ffe6cc
  class crypto,httpd,orange_agent_http,orange_agent_kv,orange_collector_kv,orange_inventory_kv provider

  classDef actor fill:#dae8fc
  class authz,gateway,facade,coordinator,orange_collector,orange_inventory,partner_x_inventory,partner_y_inventory actor
</pre>
<div class="table-wrapper"><table><thead><tr><th>Legend</th><th></th></tr></thead><tbody>
<tr><td>ORANGE</td><td>Capability Providers</td></tr>
<tr><td>BLUE</td><td>Non offer-dependent Actors</td></tr>
<tr><td>GREEN</td><td>Offer-dependent Actors <br><ins><em>There is as many actor types as offers</em></ins></td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="functional-specification"><a class="header" href="#functional-specification">Functional Specification</a></h1>
<p><strong>TABLE OF CONTENT</strong></p>
<ul>
<li><a href="ARCHITECTURE/functional-specification.html#introduction">Introduction</a>
<ul>
<li><a href="ARCHITECTURE/functional-specification.html#context">Context</a></li>
<li><a href="ARCHITECTURE/functional-specification.html#assumptions">Assumptions</a></li>
</ul>
</li>
<li><a href="ARCHITECTURE/functional-specification.html#charging--billing">Charging &amp; Billing</a></li>
<li><a href="ARCHITECTURE/functional-specification.html#charging-and-billing-within-etom">Charging and Billing within eTOM</a>
<ul>
<li><a href="ARCHITECTURE/functional-specification.html#product-usage-management">Product Usage Management</a></li>
<li><a href="ARCHITECTURE/functional-specification.html#product-rating--rate-assignment">Product Rating &amp; Rate Assignment</a></li>
<li><a href="ARCHITECTURE/functional-specification.html#product-balance-management">Product Balance Management</a></li>
<li><a href="ARCHITECTURE/functional-specification.html#bill-calculation">Bill Calculation</a></li>
<li><a href="ARCHITECTURE/functional-specification.html#managed-entities">Managed entities</a>
<ul>
<li><a href="ARCHITECTURE/functional-specification.html#customer-product-inventory">Customer Product Inventory</a></li>
<li><a href="ARCHITECTURE/functional-specification.html#rated-usage-inventory">Rated Usage Inventory</a></li>
</ul>
</li>
<li><a href="ARCHITECTURE/functional-specification.html#system-personas">System Personas</a>
<ul>
<li><a href="ARCHITECTURE/functional-specification.html#customer">Customer</a></li>
<li><a href="ARCHITECTURE/functional-specification.html#vendor">Vendor</a></li>
<li><a href="ARCHITECTURE/functional-specification.html#provider">Provider</a></li>
<li><a href="ARCHITECTURE/functional-specification.html#partner">Partner</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="introduction"><a class="header" href="#introduction">Introduction</a></h2>
<p>The aim of this page is to describe the business aspects for the distributed charging and rating process. The specification should try to describe when possible the similarities between the <em>distributed rating</em> and the charging and billing components in TMF.</p>
<h3 id="context"><a class="header" href="#context">Context</a></h3>
<p><em>Distributed rating</em> aims to explore the use of distributed architecture for the rating and part of the charging process to optimize the utilization of the various infrastructure components. For reference the software architecture for the stream can be found <a href="ARCHITECTURE/./architecture.html">here</a>.</p>
<h3 id="assumptions"><a class="header" href="#assumptions">Assumptions</a></h3>
<p>Given the fact that this part is a research activity, this component will aim to comply with the TMF guidelines while allowing room for the needs of its innovative nature. in the first evolution the system may mock any external components to expedite the research activities.</p>
<p>The first evolution should focus on products provided over IP through a client application to facilitate the tracking of their usage through the client application.</p>
<h2 id="charging--billing"><a class="header" href="#charging--billing">Charging &amp; Billing</a></h2>
<p><img src="ARCHITECTURE/./charging_billing_overview.svg" alt="Charging &amp; Billing BPM" /></p>
<p>The process called &quot;Billing&quot; consists of a set of different processes, each working on one type of data:</p>
<ul>
<li><strong>Charging</strong>
in charge of controlling the usage and decrementation of bundles. It is part of the &quot;Factory&quot; platform and uses the Charging rules and features described at the Product level.</li>
<li><strong>Rating</strong>
which valuates the usage tickets sent by the Charging. It is part of the &quot;Offer &amp; Products&quot; platform and uses the tariffs and tariff plans described in the Offers to determine the tariff codes (InstalledTariff) that will be used to make the invoice.</li>
<li><strong>Bill</strong>
alculation, which calculates the billable items (AppliedTariff) that will be sent to billing to be put on the bill. It is part of the &quot;Offer &amp; Products&quot; platform and uses the rates and tariff plan described in the Offers</li>
<li><strong>Invoicing</strong>
which establishes the invoice from billable items received. It is part of the &quot;Party&quot; platform and uses commercial catalog information to calculate invoice elements and layout.</li>
</ul>
<p>Part of the charging and rating will be distributed in the new architecture, the rating component should then feed the generated tariff to the billing component. There's no direct impact from the invoicing component so it will not be discussed in this document's scope.</p>
<h2 id="charging-and-billing-within-etom"><a class="header" href="#charging-and-billing-within-etom">Charging and Billing within eTOM</a></h2>
<p>Below are listed level 2 business processes that are related to Product rating &amp; Bill Calculation from within the eTOM business process framework, these processes should be used as a guide while distributing the operations on the new architecture.</p>
<h3 id="product-usage-management"><a class="header" href="#product-usage-management">Product Usage Management</a></h3>
<p>The Product Usage management processes encompass the functions required to guide, distribute, mediate, summarize, accumulate, and analyze Product Usage records. These processes may occur in real-time, near real-time (i.e. just at the end of the usage), or may be executed on a periodic basis.</p>
<p>Conventionally the usage is collected on the network component and forwarded to be processed in the usage management component.</p>
<p>In the <em>distributed rating</em>, the Client SDK should do the usage collection and forward it to the <em>Rating Agent</em> to be processed in real-time.</p>
<p>Below is the data schema of the product usage management as defined in TMF-635, the main entity used in the usage management process is the Usage and UsageSpecification</p>
<pre class="mermaid">%%{init: {'theme': 'base', 'themeVariables': {
  'lineColor': '#a8201a',
  'primaryColor': '#fae5c7',
  'primaryBorderColor': '#0f8b8d'
}}}%%
classDiagram
  direction LR
  class RelatedParty{
    URI href
    String id
    String name
    String role
    String @type
    String @baseType
    String @referredType
    URI @schemaLocation
  }
  class UsageSpecificationRef{
    URI href
    String id
    String name
    String @type
    String @baseType
    String @referredType
    URI @schemaLocation
  }
  class Usage{
    URI href
    String id
    String usageType
    Date usageDate
    UsageStatusType status
    String @type
    String @baseType
    URI @schemaLocation
  }
  class UsageStatusType{
    &lt;&lt;Enumeration&gt;&gt;
    received
    rejected
    recycled
    guided
    rated
    rerated
  }
  class UsageCharacteristic{
    String id
    String name
    String valueType
    Any value
    String @type
    String @baseType
    URI @schemaLocation
  }
  class CharacteristicRelationship{
    URI href
    String id
    String relationshipType
    String @type
    String @baseType
    URI @schemaLocation
  }
  RelatedParty &quot;0..*&quot; &lt;--* Usage
  UsageSpecificationRef &quot;0..1&quot; &lt;--* Usage
  Usage -- &quot;1&quot; UsageStatusType
  Usage *--&gt; &quot;0..*&quot; UsageCharacteristic
  UsageCharacteristic *--&gt; &quot;0..*&quot; CharacteristicRelationship
</pre>
<h3 id="product-rating--rate-assignment"><a class="header" href="#product-rating--rate-assignment">Product Rating &amp; Rate Assignment</a></h3>
<p>The purpose of Product Rating &amp; Assignment is to rate a value (monetary or other) to Product Usage or a set of Product Usages and assign the result to a Product and a Billing Account. The charge may be either a credit or a debit and can be handled either online or offline.</p>
<p>Online charging is performed in real-time, necessitating an authorization component that can impact the delivery of the product and enables the operator to provide prepaid products to their customers. Conversely, offline charging takes place after the product has been delivered and does not necessitate real-time processing, and typically pertains to subscription-based products.</p>
<p>in the <em>distributed rating</em>, optimally the process of usage and rating should be done on the edge or the FOG levels to minimize the loud on the infrastructure.</p>
<p>Below is the data schema of the product usage management as defined in TMF-635, the main entity used in the product rating and rate assignment process is the RatedProductUsage entity</p>
<pre class="mermaid">%%{init: {'theme': 'base', 'themeVariables': {
  'lineColor': '#a8201a',
  'primaryColor': '#fae5c7',
  'primaryBorderColor': '#0f8b8d'
}}}%%
classDiagram
  direction LR
  class RelatedParty{
    URI href
    String id
    String name
    String role
    String @type
    String @baseType
    String @referredType
    URI @schemaLocation
  }
  class UsageSpecificationRef{
    URI href
    String id
    String name
    String @type
    String @baseType
    String @referredType
    URI @schemaLocation
  }
  class Usage{
    URI href
    String id
    String usageType
    Date usageDate
    UsageStatusType status
    String @type
    String @baseType
    URI @schemaLocation
  }
  class UsageCharacteristic{
    String id
    String name
    String valueType
    Any value
    String @type
    String @baseType
    URI @schemaLocation
  }
  class CharacteristicRelationship{
    URI href
    String id
    String relationshipType
    String @type
    String @baseType
    URI @schemaLocation
  }
  class UsageStatusType{
    &lt;&lt;Enumeration&gt;&gt;
    received
    rejected
    recycled
    guided
    rated
    rerated
  }
  class RatedProductUsage{
    Money bucketValueConvertedInAmount
    bool isBilled
    bool isTaxExempted
    String offerTariffType
    String ratingAmountType
    Date ratingDate
    Money taxExcludedRatingAmount
    Money taxIncludedRatingAmount
    float taxRate
    String usageRatingTag
    String @type
    String @baseType
    URI @schemaLocation
  }
  class ProductRef{
    URI href
    String id
    String name
    String @type
    String @baseType
    String @referredType
    URI @schemaLocation
  }
  RelatedParty &quot;0..*&quot; &lt;--* Usage
  UsageSpecificationRef &quot;0..1&quot; &lt;--* Usage
  Usage -- &quot;1&quot; UsageStatusType
  Usage *--&gt; &quot;0..*&quot; UsageCharacteristic
  Usage *--&gt; &quot;0..*&quot; RatedProductUsage
  UsageCharacteristic *--&gt; &quot;0..*&quot; CharacteristicRelationship
  RatedProductUsage *--&gt; &quot;0..1&quot; ProductRef
</pre>
<h3 id="product-balance-management"><a class="header" href="#product-balance-management">Product Balance Management</a></h3>
<p>This process is responsible for holding, calculating, applying policies and managing functionality/interfaces for the Product balances, Here the values resulting from rating and the application of discounts are applied to a Product balance. The balance affected by the value may be monetary or other balances such as minutes, points, or tokens.</p>
<p>The <em>Rating Agent</em> should ensure that the balance is impacted and reduce it to match the product usage. The aim is to ensure that the balance is impacted instantly and is managed in a distributed manner. The operations for balance management (like top-up operations) will be out of scope of the first evolution and only the reduction of balance based on usage will be represented.</p>
<p>Below is the data schema of the balance as defined in TMF-654</p>
<pre class="mermaid">%%{init: {'theme': 'base', 'themeVariables': {
  'lineColor': '#a8201a',
  'primaryColor': '#fae5c7',
  'primaryBorderColor': '#0f8b8d'
}}}%%
classDiagram
  direction LR
  class PartyAccountRef{
    String id
    String href
    String name
  }
  class RelatedPartyRef{
    String id
    String href
    String role
    String name
  }
  class BucketBalance{
    [ SID CustomerAccountBalance ]
    String id
    String href
    String name
    String discription
    String bucketType
    TimePeriod validFor
    Quantity remainedAmount
    Quantity reservedAmount
    String status
  }
  class RealizingResourceRef{
    String id
    String href
    String name
    String @type
    String value
  }
  class ProductRef{
    String id
    String href
    String name
  }
  PartyAccountRef &quot;1&quot; --o &quot;1&quot; BucketBalance
  RelatedPartyRef &quot;0..*&quot; --o &quot;1&quot; BucketBalance
  BucketBalance &quot;1&quot; o-- &quot;0..*&quot; RealizingResourceRef
  BucketBalance &quot;1&quot; o-- &quot;0..*&quot; ProductRef
  RealizingResourceRef &quot;*&quot; -- &quot;1&quot; ProductRef
</pre>
<h3 id="bill-calculation"><a class="header" href="#bill-calculation">Bill Calculation</a></h3>
<p>Customer Bill Invoice Management processes ensure the bill invoice is created, physically and/or electronically produced and distributed to customers, and that the appropriate taxes, discounts, adjustments, rebates and credits for the products delivered to customers have been applied. These processes are accountable for assuring that enterprise revenue is billed and invoices delivered appropriately to customers.</p>
<p>These processes are responsible for, but not limited to:</p>
<ul>
<li>Establishment and application of taxes and charges to the products delivered to customers;</li>
<li>Application of the adjustment (adjustment decision done in Customer Bill Inquiry Handling);</li>
<li>Creation of accurate Customer bill invoices including all adjustments, rebates, discounts, credits, etc.</li>
<li>Production &amp; distribution of Customer bill in physical and/or electronic form to customers in accordance with the billing cycle;</li>
<li>Forecasting of physical resources associated with Customer bill production, such as paper and envelope quantities;</li>
<li>Alignment and management of promotional material insertion into distributed Customer bills</li>
<li>Establishment and management of third party arrangements to support Customer bill invoice generation, production and distribution.</li>
</ul>
<p>The implementation of the Bill Calculation component is out of scope of the <em>distributed rating</em> however the system should ensure that it can generate Proof of Usages and rated events that can be forwarded to the Bill calculation component - through events or shared storage - to support post paid business scenarios. The support for aggregated rating will not be addressed in the first release and can be included in later evolution due to the technical complexity associated with it.</p>
<h3 id="managed-entities"><a class="header" href="#managed-entities">Managed entities</a></h3>
<h4 id="customer-product-inventory"><a class="header" href="#customer-product-inventory">Customer Product Inventory</a></h4>
<p>The customer product inventory component holds the information about the customer and his installed products. it's used to track all the products that the customer has subscribed to as well as their cost. in the first release the customer inventory will be a simple key-value store that holds the customer id as the key and party information with a list of their installed product in the value. the figure below show the schema of the data stored in the value.</p>
<pre class="mermaid">%%{init: {'theme': 'base', 'themeVariables': {
  'lineColor': '#a8201a',
  'primaryColor': '#fae5c7',
  'primaryBorderColor': '#0f8b8d'
}}}%%
classDiagram
  direction LR
  class Party {
    string id
    string name
  }
  class CustomerInventory {
    Party relatedParty
    List~Product~ products
  }
  class ProductOfferingRef {
    string id
    string name
    string agentId
    Quantity unitOfMeasure
  }
  class Quantity {
    string amount
    string units
  }
  class Product {
    string id
    string partnerId
    string description
    ProductOfferingRef productOffering
    ProductPrice productPrice
  }
  class ProductPrice {
    PriceType priceType
    DataTime validTill
    string description
    Quantity unitOfMeasure
    Price price
  }
  class PriceType {
    &lt;&lt;Enumeration&gt;&gt;
    recurring
    none-recurring
    penalty
    one-time
  }
  class Price {
    string unit
    float value
  }
  Party --o CustomerInventory
  CustomerInventory *-- Product
  ProductOfferingRef --o Product
  ProductOfferingRef *-- Quantity
  Product o-- ProductPrice
  Quantity --* ProductPrice
  ProductPrice o-- PriceType
  ProductPrice *-- Price
</pre>
<p>productPrice: An amount, usually of money, that represents the actual price paid by a Customer for a purchase, a rent or a lease of a Product. The price is valid for a defined period of time.
price: A money (Money). The amount of money that characterizes the price.</p>
<p>Money sub-resource
A base / value business entity used to represent money.
unit: A string. Currency (ISO4217 norm uses 3 letters to define the currency).
value: A float. A positive floating point number.</p>
<details id="admonition-customer-product-inventory-field-descriptions" class="admonition admonish-abstract">
<summary class="admonition-title">
<p>Customer product inventory field descriptions</p>
<p><a class="admonition-anchor-link" href="ARCHITECTURE/functional-specification.html#admonition-customer-product-inventory-field-descriptions"></a></p>
</summary>
<div>
<p>RelatedParty sub-resource:
Related Entity reference. A related party defines party or party role linked to a specific entity.</p>
<ul>
<li>name: A string. Name of the related entity.</li>
<li>id: A string. unique identifier.</li>
</ul>
<p>productOffering A product offering reference (ProductOfferingRef). A product offering represents entities that are orderable from the provider of the catalog.</p>
<ul>
<li>name: A string. Name of the related entity.</li>
<li>id: A string. unique identifier.</li>
<li>agentId: the identifier for the agent in charge of rating this offer</li>
</ul>
<p>productPrice: An amount, usually of money, that represents the actual price paid by a Customer for a purchase, a rent or a lease of a Product. The price is valid for a defined period of time.</p>
<ul>
<li>price: A money (Money). The amount of money that characterizes the price.</li>
<li>priceType: A string. A category that describes the price charge, such as recurring, penalty, One time fee and so forth.</li>
<li>unitOfMeasure A quantity (Quantity). A number and unit representing how many (for instance 1 dozen) of an ProductOffering is available at the offered price. Its meaning depends on the priceType. It could be a price, a rate, or a discount.</li>
</ul>
<p>Money sub-resource:
A base / value business entity used to represent money.</p>
<ul>
<li>unit: A string. Currency (ISO4217 norm uses 3 letters to define the currency).</li>
<li>value: A float. A positive floating point number.</li>
</ul>
</div>
</details>
<h4 id="rated-usage-inventory"><a class="header" href="#rated-usage-inventory">Rated Usage Inventory</a></h4>
<p>The rated usage inventory component holds the information about the customer's usage and its associated cost. it's used to hold the rated usage information that can be forwarded later on to the billing component. the figure below show the schema of the rated usage.</p>
<pre class="mermaid">%%{init: {'theme': 'base', 'themeVariables': {
  'lineColor': '#a8201a',
  'primaryColor': '#fae5c7',
  'primaryBorderColor': '#0f8b8d'
}}}%%
classDiagram
  direction TB
  class Party {
    string id
    string name
    string role
    string @referredType
  }
  class RatedUsage {
    string id
    string usageDate
    string description
    string usageType
    string status
    Party relatedParty
    RatedProductUsage ratedProductUsage
    List~UsageCharacteristic~ usageCharacteristics
  }
  class UsageCharacteristic {
    string id
    string name
    string valueType
    string value
  }
  class RatedProductUsage {
    bool isBilled
    string ratingAmountType
    string ratingDate
    BucketValueConvertedInAmount bucketValueConvertedInAmount
    ProductRef productRef
  }
  class BucketValueConvertedInAmount {
    string unit
    int value
  }
  class ProductRef {
    string id
    string name
  }
  Party --o RatedUsage
  UsageCharacteristic --* RatedUsage
  RatedUsage *-- RatedProductUsage
  RatedProductUsage o-- ProductRef
  RatedProductUsage o-- BucketValueConvertedInAmount
</pre>
<details id="admonition-rated-usage-inventory-field-descriptions" class="admonition admonish-abstract">
<summary class="admonition-title">
<p>Rated usage inventory field descriptions</p>
<p><a class="admonition-anchor-link" href="ARCHITECTURE/functional-specification.html#admonition-rated-usage-inventory-field-descriptions"></a></p>
</summary>
<div>
<p>RatedUsage fields:</p>
<ul>
<li>id: A string. unique identifier.</li>
<li>usageDate: A date time (DateTime). Date of usage.</li>
<li>description:  A string. Description of usage.</li>
<li>ratedProductUsage: rated product usages (RatedProductUsage). An occurrence of employing a product for its intended purpose with all rating details.</li>
<li>relatedParty: related party (RelatedParty ). Related Entity reference. A related party defines party or party role linked to a specific entity.</li>
<li>status: A usage status type (UsageStatusType). Possible values for the status of the Usage.</li>
<li>usageCharacteristic: A list of usage characteristics (UsageCharacteristic [*]). Provides the value of a given characteristic.</li>
<li>usageType: A string. Type of usage.</li>
</ul>
<p>Money sub-resource:
A base / value business entity used to represent money.</p>
<ul>
<li>unit: A string. Currency (ISO4217 norm uses 3 letters to define the currency).</li>
<li>value: A float. A positive floating point number.</li>
</ul>
<p>RatedProductUsage sub-resource:
An occurrence of employing a product for its intended purpose with all rating details.</p>
<ul>
<li>bucketValueConvertedInAmount: A money (Money). A base / value business entity used to represent money.</li>
<li>isBilled: A boolean. Boolean indicating if usage have been billed or not.</li>
<li>productRef: A product reference (ProductRef).</li>
<li>ratingAmountType: A string. Type of amount.</li>
<li>ratingDate: A date time (DateTime). Date of usage rating.</li>
<li>usageRatingTag A string. Tag value: [usage]: the usage is always rated outside a usage bundle [included usage]: the usage is rated inside a usage bundle, [non included usage]: the usage bundle is exhausted. The usage is rated outside the usage bundle.</li>
</ul>
<p>RelatedParty sub-resource:
Related Entity reference. A related party defines party or party role linked to a specific entity.</p>
<ul>
<li>name A string. Name of the related entity.</li>
<li>id A string. unique identifier.</li>
<li>role A string. Role played by the related party.</li>
</ul>
<p>UsageCharacteristic sub-resource:
Provides the value of a given characteristic.</p>
<ul>
<li>id: A string. Unique identifier of the characteristic.</li>
<li>name: A string. Name of the characteristic.</li>
<li>valueType: A string. Data type of the value of the characteristic.</li>
</ul>
</div>
</details>
<h3 id="system-personas"><a class="header" href="#system-personas">System Personas</a></h3>
<h4 id="customer"><a class="header" href="#customer">Customer</a></h4>
<p>The end user that is benefiting from the product irrespective of his relation with different entities involved.</p>
<div id="admonition-customer-example" class="admonition admonish-example">
<div class="admonition-title">
<p>Customer Example</p>
<p><a class="admonition-anchor-link" href="ARCHITECTURE/functional-specification.html#admonition-customer-example"></a></p>
</div>
<div>
<ul>
<li>Person requesting to watch a movie on a streaming provider through his teleco account.</li>
<li>Person requesting to use a hosting products from a cloud provider which relies on a teleco products for connectivity</li>
</ul>
</div>
</div>
<h4 id="vendor"><a class="header" href="#vendor">Vendor</a></h4>
<p>The entity that's managing the customer account. a vendor can be reselling a product, building a composite product or providing his own products as well.</p>
<p>Depending on the usecase the same entity can be regarded as vendor, provider or a partner.</p>
<h4 id="provider"><a class="header" href="#provider">Provider</a></h4>
<p>The entity providing their products for partners with a revenue sharing model. providers can also be represented as the Vendor in case of selling directly yo the Customer.</p>
<h4 id="partner"><a class="header" href="#partner">Partner</a></h4>
<p>Describes the relation between Vendors and providers, providers are considered a partner for the vendor that's reselling/composing their products. Providers are also considered partners to other providers if the use other products.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="retrival-of-customer-product-inventory"><a class="header" href="#retrival-of-customer-product-inventory">Retrival of customer product inventory</a></h1>
<div id="admonition-pertaining-to" class="admonition admonish-abstract">
<div class="admonition-title">
<p>Pertaining to</p>
<p><a class="admonition-anchor-link" href="USE-CASES/UC-01/index.html#admonition-pertaining-to"></a></p>
</div>
<div>
<ul>
<li>Customer account type: <strong>ANY</strong></li>
<li>Product offer type: <strong>ANY</strong></li>
</ul>
</div>
</div>
<div id="admonition-customer-use-case" class="admonition admonish-example">
<div class="admonition-title">
<p>Customer Use case</p>
<p><a class="admonition-anchor-link" href="USE-CASES/UC-01/index.html#admonition-customer-use-case"></a></p>
</div>
<div>
<p><strong>As a</strong> customer of a <em>Teleco provider</em><br />
<strong>I want to</strong> list products available to me<br />
<strong>so that I can</strong> use some of them</p>
</div>
</div>
<div id="admonition-vendor-use-case" class="admonition admonish-example">
<div class="admonition-title">
<p>Vendor Use case</p>
<p><a class="admonition-anchor-link" href="USE-CASES/UC-01/index.html#admonition-vendor-use-case"></a></p>
</div>
<div>
<p><strong>As a</strong> vendor providing products <em>over IP</em> through a <em>Teleco provider</em><br />
<strong>I want to</strong> have integration with the Teleco provider product inventory<br />
<strong>so that I can</strong> list the products I provide<br />
<strong>and</strong> make the products available for usage</p>
</div>
</div>
<h2 id="business-processes"><a class="header" href="#business-processes">Business processes</a></h2>
<h3 id="process-model-for-the-retrival-of-customer-product-inventory"><a class="header" href="#process-model-for-the-retrival-of-customer-product-inventory">Process model for the retrival of customer product inventory</a></h3>
<p><img src="USE-CASES/UC-01/./list-bpm.svg" alt="Process model for the retrival of customer product inventory" /></p>
<h3 id="legend"><a class="header" href="#legend">Legend</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Term</th><th>description</th></tr></thead><tbody>
<tr><td><em>Party</em></td><td>A customer that has subscribed to a product</td></tr>
<tr><td><em>Vendor/Partner</em></td><td>An entity that sells products provided by another entity through a partnership agreement</td></tr>
<tr><td><em>Client SDK</em></td><td>The application from which the product are used</td></tr>
<tr><td><em>Product Offer</em></td><td>A product offering represents entities that are orderable from the provider of the catalog</td></tr>
<tr><td><em>Product</em></td><td>An instantiated offer for a specific party</td></tr>
<tr><td><em>Rating agent</em></td><td>The contract for the rating</td></tr>
<tr><td><em>Actor</em></td><td>An instantiated <em>Rating Agent</em></td></tr>
<tr><td><em>Rating coordinator</em></td><td>A component responsible for orchestrating the rating requests to different <em>Rating Agents</em></td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="overview-of-product-usage-rating"><a class="header" href="#overview-of-product-usage-rating">Overview of product usage rating</a></h1>
<div id="admonition-pertaining-to" class="admonition admonish-abstract">
<div class="admonition-title">
<p>Pertaining to</p>
<p><a class="admonition-anchor-link" href="USE-CASES/UC-02/index.html#admonition-pertaining-to"></a></p>
</div>
<div>
<ul>
<li>Customer account type: <strong>ANY</strong></li>
<li>Product offer type: <strong>ANY</strong></li>
</ul>
</div>
</div>
<div id="admonition-vendor-use-case" class="admonition admonish-example">
<div class="admonition-title">
<p>Vendor Use case</p>
<p><a class="admonition-anchor-link" href="USE-CASES/UC-02/index.html#admonition-vendor-use-case"></a></p>
</div>
<div>
<p><strong>As a</strong> Vendor providing products <em>over IP</em> through a <em>Teleco provider</em><br />
<strong>I want to</strong> build new products based on products offered by other vendors<br />
<strong>and</strong> integrate with the rating platform of the <em>Teleco provider</em><br />
<strong>so that I can</strong> rate the usage of products I provide<br />
<strong>and</strong> relay the rating to product dependencies vendors</p>
</div>
</div>
<div id="admonition-teleco-provider-use-case" class="admonition admonish-example">
<div class="admonition-title">
<p>Teleco Provider Use case</p>
<p><a class="admonition-anchor-link" href="USE-CASES/UC-02/index.html#admonition-teleco-provider-use-case"></a></p>
</div>
<div>
<p><strong>As a</strong> Teleco Provider<br />
<strong>I want to</strong> provide products from multiple partners<br />
<strong>and</strong> relay the rating to partner's agent<br />
<strong>so that</strong> I can ensure all partners have rated the product before usage</p>
</div>
</div>
<h2 id="product-composition"><a class="header" href="#product-composition">Product composition</a></h2>
<p>For a composed product that depend on existing products,
the rating platform needs to build product dependency model,
and map it to corresponding agents for product usage rating,
allowing each individual product vendor to rate its products</p>
<p>As shown in the following diagram a <em>Streaming</em> product can use
<em>Network</em>, <em>Storage</em>, and <em>Telemetry</em> products to compose its functionality,
in turn each of its product dependencies may have other dependencies.</p>
<pre class="mermaid">%%{init: {'theme': 'base', 'themeVariables': {
  'lineColor': '#a8201a',
  'primaryColor': '#fae5c7',
  'primaryBorderColor': '#0f8b8d'
}}}%%
flowchart LR
  streaming(Streaming product)
  storage(Storage product)
  network(Network product)
  telemetry(Telemetry product)

  streaming --&gt; storage
  streaming --&gt; network
  streaming --&gt; telemetry
  telemetry --&gt; storage
  telemetry --&gt; network
  storage --&gt; network
  storage --&gt; telemetry

  classDef domain fill:#fffff7
  class streaming domain

  classDef offer fill:#d6e8d5
  class storage offer

  classDef provider fill:#ffe6cc
  class network provider

  classDef actor fill:#dae8fc
  class telemetry actor
</pre>
<h2 id="business-processes-1"><a class="header" href="#business-processes-1">Business processes</a></h2>
<h3 id="product-usage-overview"><a class="header" href="#product-usage-overview">Product usage overview</a></h3>
<p>The process of product usage in the <em>distributed rating</em> system, which is
illustrated in the model below, begins with the client request going through
the <em>Rating Coordinator</em> and each <em>Rating Agent</em> before finally issuing
the <em>Usage Proof</em>, which is collected and stored by the <em>Usage Collector</em>,
focusing on the crucial role of the <em>Rating Coordinator</em> in decoupling
the <em>Rating Agent</em> and standardizing the communication between them.</p>
<p>Also, the process model illustrates the iterative approach used by
the <em>Usage Collector</em> to carry out its main three tasks:</p>
<ol>
<li>Construct the agent dependency graph, by recursively quering each agent for its dependencies.</li>
<li>Validate the usage request by all the agents.</li>
<li>Trigger rating for each agent in order of their dependencies.</li>
</ol>
<p><img src="USE-CASES/UC-02//USE-CASES/UC-02/rating-bpm.svg" alt="Diagram depicting the product usage process" /></p>
<h3 id="legend-1"><a class="header" href="#legend-1">Legend</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Term</th><th>description</th></tr></thead><tbody>
<tr><td><em>Party</em></td><td>A customer that has subscribed to a product</td></tr>
<tr><td><em>Vendor/Partner</em></td><td>An entity that sells products provided by another entity through a partnership agreement</td></tr>
<tr><td><em>Client SDK</em></td><td>The application from which the product are used</td></tr>
<tr><td><em>Product Offer</em></td><td>A product offering represents entities that are orderable from the provider of the catalog</td></tr>
<tr><td><em>Product</em></td><td>An instantiated offer for a specific party</td></tr>
<tr><td><em>Rating agent</em></td><td>The contract for the rating</td></tr>
<tr><td><em>Actor</em></td><td>An instantiated <em>Rating Agent</em></td></tr>
<tr><td><em>Rating coordinator</em></td><td>A component responsible for orchestrating the rating requests to different <em>Rating Agents</em></td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="rating-of-regular-product"><a class="header" href="#rating-of-regular-product">Rating of regular product</a></h1>
<div id="admonition-pertaining-to" class="admonition admonish-abstract">
<div class="admonition-title">
<p>Pertaining to</p>
<p><a class="admonition-anchor-link" href="USE-CASES/UC-03/index.html#admonition-pertaining-to"></a></p>
</div>
<div>
<ul>
<li>Customer account type: <strong>POSTPAID</strong></li>
<li>Product offer type: <strong>REGULAR</strong></li>
</ul>
</div>
</div>
<div id="admonition-customer-use-case" class="admonition admonish-example">
<div class="admonition-title">
<p>Customer Use case</p>
<p><a class="admonition-anchor-link" href="USE-CASES/UC-03/index.html#admonition-customer-use-case"></a></p>
</div>
<div>
<p><strong>As a</strong> customer of a <em>Teleco provider</em> with <em>postpaid</em> account<br />
<strong>I want to</strong> select some regular product from the <em>Teleco provider</em> mobile app<br />
<strong>so that</strong> the cost will be reflected in my bill</p>
</div>
</div>
<div id="admonition-vendor-use-case" class="admonition admonish-example">
<div class="admonition-title">
<p>Vendor Use case</p>
<p><a class="admonition-anchor-link" href="USE-CASES/UC-03/index.html#admonition-vendor-use-case"></a></p>
</div>
<div>
<p><strong>As a</strong> vendor providing products <em>over IP</em> through a <em>Teleco provider</em><br />
<strong>I want to</strong> have integration with the Teleco provider rating process<br />
<strong>so that I can</strong> monitor the usage of the products I provide<br />
<strong>and</strong> track revenue of the products based on usage</p>
</div>
</div>
<div id="admonition-teleco-provider-use-case" class="admonition admonish-example">
<div class="admonition-title">
<p>Teleco Provider Use case</p>
<p><a class="admonition-anchor-link" href="USE-CASES/UC-03/index.html#admonition-teleco-provider-use-case"></a></p>
</div>
<div>
<p><strong>As a</strong> Teleco Provider
<strong>I want to</strong> rate the usage of movie streaming products
<strong>so that</strong> I can charge the customer for his usage.</p>
</div>
</div>
<h2 id="business-processes-2"><a class="header" href="#business-processes-2">Business processes</a></h2>
<h3 id="product-usage-overview-1"><a class="header" href="#product-usage-overview-1">Product usage overview</a></h3>
<p>The process of product usage in the <em>distributed rating</em> system, which is
illustrated in the model below, begins with the client request going through
the <em>Rating Coordinator</em> and each <em>Rating Agent</em> before finally issuing
the <em>Usage Proof</em>, which is collected and stored by the <em>Usage Collector</em>,
focusing on the crucial role of the <em>Rating Coordinator</em> in decoupling
the <em>Rating Agent</em> and standardizing the communication between them.</p>
<p>Also, the process model illustrates the iterative approach used by
the <em>Usage Collector</em> to carry out its main three tasks:</p>
<ol>
<li>Construct the agent dependency graph, by recursively quering each agent for its dependencies.</li>
<li>Validate the usage request by all the agents.</li>
<li>Trigger rating for each agent in order of their dependencies.</li>
</ol>
<p><img src="USE-CASES/UC-03//USE-CASES/UC-02/rating-bpm.svg" alt="Diagram depicting the product usage process" /></p>
<h3 id="regular-product-rating"><a class="header" href="#regular-product-rating">Regular product rating</a></h3>
<p><img src="USE-CASES/UC-03/./rating-bpm.svg" alt="Diagram depicting the rating process of a regular product" /></p>
<h3 id="legend-2"><a class="header" href="#legend-2">Legend</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Term</th><th>description</th></tr></thead><tbody>
<tr><td><em>Party</em></td><td>A customer that has subscribed to a product</td></tr>
<tr><td><em>Vendor/Partner</em></td><td>An entity that sells products provided by another entity through a partnership agreement</td></tr>
<tr><td><em>Client SDK</em></td><td>The application from which the product are used</td></tr>
<tr><td><em>Product Offer</em></td><td>A product offering represents entities that are orderable from the provider of the catalog</td></tr>
<tr><td><em>Product</em></td><td>An instantiated offer for a specific party</td></tr>
<tr><td><em>Rating agent</em></td><td>The contract for the rating</td></tr>
<tr><td><em>Actor</em></td><td>An instantiated <em>Rating Agent</em></td></tr>
<tr><td><em>Rating coordinator</em></td><td>A component responsible for orchestrating the rating requests to different <em>Rating Agents</em></td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="rating-of-threshold-product"><a class="header" href="#rating-of-threshold-product">Rating of threshold product</a></h1>
<div id="admonition-pertaining-to" class="admonition admonish-abstract">
<div class="admonition-title">
<p>Pertaining to</p>
<p><a class="admonition-anchor-link" href="USE-CASES/UC-04/index.html#admonition-pertaining-to"></a></p>
</div>
<div>
<ul>
<li>Customer account type: <strong>POSTPAID</strong></li>
<li>Product offer type: <strong>THRESHOLD</strong></li>
</ul>
</div>
</div>
<div id="admonition-use-case" class="admonition admonish-example">
<div class="admonition-title">
<p>Use case</p>
<p><a class="admonition-anchor-link" href="USE-CASES/UC-04/index.html#admonition-use-case"></a></p>
</div>
<div>
<p><strong>As a</strong> customer of a <em>Teleco provider</em> with <em>postpaid</em> account<br />
<strong>I want to</strong> select some product with <em>threshold</em> product offer<br />
<strong>so that I can</strong> use it from a providers mobile app<br />
<strong>and</strong> the cost will be reflected in my bill</p>
</div>
</div>
<div id="admonition-use-case-1" class="admonition admonish-example">
<div class="admonition-title">
<p>Use case</p>
<p><a class="admonition-anchor-link" href="USE-CASES/UC-04/index.html#admonition-use-case-1"></a></p>
</div>
<div>
<p><strong>As a</strong> <em>Teleco provider</em> with <em>threshold</em> product offer<br />
<strong>I want to</strong> calculate rated usage for it in a distributed manner<br />
<strong>so that I can</strong> be reflected in the customers bill</p>
</div>
</div>
<h2 id="business-processes-3"><a class="header" href="#business-processes-3">Business processes</a></h2>
<h3 id="product-usage-overview-2"><a class="header" href="#product-usage-overview-2">Product usage overview</a></h3>
<p>The process of product usage in the <em>distributed rating</em> system, which is
illustrated in the model below, begins with the client request going through
the <em>Rating Coordinator</em> and each <em>Rating Agent</em> before finally issuing
the <em>Usage Proof</em>, which is collected and stored by the <em>Usage Collector</em>,
focusing on the crucial role of the <em>Rating Coordinator</em> in decoupling
the <em>Rating Agent</em> and standardizing the communication between them.</p>
<p>Also, the process model illustrates the iterative approach used by
the <em>Usage Collector</em> to carry out its main three tasks:</p>
<ol>
<li>Construct the agent dependency graph, by recursively quering each agent for its dependencies.</li>
<li>Validate the usage request by all the agents.</li>
<li>Trigger rating for each agent in order of their dependencies.</li>
</ol>
<p><img src="USE-CASES/UC-04//USE-CASES/UC-02/rating-bpm.svg" alt="Diagram depicting the product usage process" /></p>
<h3 id="threshold-product-rating"><a class="header" href="#threshold-product-rating">Threshold product rating</a></h3>
<p><img src="USE-CASES/UC-04/./rating-bpm.svg" alt="Diagram depicting the rating process of a threshold product" /></p>
<h3 id="legend-3"><a class="header" href="#legend-3">Legend</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Term</th><th>description</th></tr></thead><tbody>
<tr><td><em>Party</em></td><td>A customer that has subscribed to a product</td></tr>
<tr><td><em>Vendor/Partner</em></td><td>An entity that sells products provided by another entity through a partnership agreement</td></tr>
<tr><td><em>Client SDK</em></td><td>The application from which the product are used</td></tr>
<tr><td><em>Product Offer</em></td><td>A product offering represents entities that are orderable from the provider of the catalog</td></tr>
<tr><td><em>Product</em></td><td>An instantiated offer for a specific party</td></tr>
<tr><td><em>Rating agent</em></td><td>The contract for the rating</td></tr>
<tr><td><em>Actor</em></td><td>An instantiated <em>Rating Agent</em></td></tr>
<tr><td><em>Rating coordinator</em></td><td>A component responsible for orchestrating the rating requests to different <em>Rating Agents</em></td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="rating-of-bundle-product-offer"><a class="header" href="#rating-of-bundle-product-offer">Rating of bundle product offer</a></h1>
<div id="admonition-pertaining-to" class="admonition admonish-abstract">
<div class="admonition-title">
<p>Pertaining to</p>
<p><a class="admonition-anchor-link" href="USE-CASES/UC-05/index.html#admonition-pertaining-to"></a></p>
</div>
<div>
<ul>
<li>Customer account type: <strong>POSTPAID</strong></li>
<li>Product offer type: <strong>REGULAR</strong></li>
</ul>
</div>
</div>
<div id="admonition-use-case" class="admonition admonish-example">
<div class="admonition-title">
<p>Use case</p>
<p><a class="admonition-anchor-link" href="USE-CASES/UC-05/index.html#admonition-use-case"></a></p>
</div>
<div>
<p><strong>As a</strong> postpaid customer of a teleco provider<br />
<strong>I want to</strong> select a bundled product of 3 movies for 1 dollar<br />
<strong>so that</strong> I can use this product from a providers mobile app<br />
<strong>and</strong> the cost of this product will be reflected in my bill</p>
</div>
</div>
<div id="admonition-use-case-1" class="admonition admonish-example">
<div class="admonition-title">
<p>Use case</p>
<p><a class="admonition-anchor-link" href="USE-CASES/UC-05/index.html#admonition-use-case-1"></a></p>
</div>
<div>
<p><strong>As a</strong> Teleco Provider<br />
<strong>I want to</strong> sell a bundled product like 3 movies for 1 dollar in a distributed mode<br />
<strong>so that</strong> I will deduct the correct cost from the customer bundle</p>
</div>
</div>
<h2 id="business-processes-4"><a class="header" href="#business-processes-4">Business processes</a></h2>
<h3 id="product-usage-overview-3"><a class="header" href="#product-usage-overview-3">Product usage overview</a></h3>
<p>The process of product usage in the <em>distributed rating</em> system, which is
illustrated in the model below, begins with the client request going through
the <em>Rating Coordinator</em> and each <em>Rating Agent</em> before finally issuing
the <em>Usage Proof</em>, which is collected and stored by the <em>Usage Collector</em>,
focusing on the crucial role of the <em>Rating Coordinator</em> in decoupling
the <em>Rating Agent</em> and standardizing the communication between them.</p>
<p>Also, the process model illustrates the iterative approach used by
the <em>Usage Collector</em> to carry out its main three tasks:</p>
<ol>
<li>Construct the agent dependency graph, by recursively quering each agent for its dependencies.</li>
<li>Validate the usage request by all the agents.</li>
<li>Trigger rating for each agent in order of their dependencies.</li>
</ol>
<p><img src="USE-CASES/UC-05//USE-CASES/UC-02/rating-bpm.svg" alt="Diagram depicting the product usage process" /></p>
<h3 id="bundle-product-rating"><a class="header" href="#bundle-product-rating">Bundle product rating</a></h3>
<p><img src="USE-CASES/UC-05/./rating-bpm.svg" alt="Diagram depicting the rating process of a bundle product" /></p>
<h3 id="legend-4"><a class="header" href="#legend-4">Legend</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Term</th><th>description</th></tr></thead><tbody>
<tr><td><em>Party</em></td><td>A customer that has subscribed to a product</td></tr>
<tr><td><em>Vendor/Partner</em></td><td>An entity that sells products provided by another entity through a partnership agreement</td></tr>
<tr><td><em>Client SDK</em></td><td>The application from which the product are used</td></tr>
<tr><td><em>Product Offer</em></td><td>A product offering represents entities that are orderable from the provider of the catalog</td></tr>
<tr><td><em>Product</em></td><td>An instantiated offer for a specific party</td></tr>
<tr><td><em>Rating agent</em></td><td>The contract for the rating</td></tr>
<tr><td><em>Actor</em></td><td>An instantiated <em>Rating Agent</em></td></tr>
<tr><td><em>Rating coordinator</em></td><td>A component responsible for orchestrating the rating requests to different <em>Rating Agents</em></td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="monorepo-code-organization"><a class="header" href="#monorepo-code-organization">Monorepo code organization</a></h1>
<ul>
<li>Status: proposed</li>
<li>Deciders:</li>
<li>Date: YYYY.MM.DD</li>
</ul>
<p>Technical Story: N/A</p>
<h2 id="context-and-problem-statement"><a class="header" href="#context-and-problem-statement">Context and Problem Statement</a></h2>
<p>Code organization in the distributed-agent prototype</p>
<h2 id="decision-drivers"><a class="header" href="#decision-drivers">Decision Drivers</a></h2>
<p>Simplicity, agility</p>
<h2 id="considered-options"><a class="header" href="#considered-options">Considered Options</a></h2>
<ol>
<li>
<p>one unique repo for interfaces, agents and other artifacts</p>
</li>
<li>
<p>one repo for each artifact</p>
</li>
</ol>
<h2 id="decision-outcome"><a class="header" href="#decision-outcome">Decision Outcome</a></h2>
<ol>
<li>one unique repo for interfaces and agents</li>
</ol>
<h3 id="positive-consequences"><a class="header" href="#positive-consequences">Positive Consequences</a></h3>
<ul>
<li>simple and agile, suited for a prototype</li>
</ul>
<h3 id="negative-consequences"><a class="header" href="#negative-consequences">Negative Consequences</a></h3>
<ul>
<li>only one lifecycle (~release) for all artifacts</li>
</ul>
<p>We will want to reassess this decision in the target implementation</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="kickstart"><a class="header" href="#kickstart">Kickstart</a></h1>
<p>This document to give you kick to start your journey in Wasmcloud world.</p>
<h1 id="table-of-contents"><a class="header" href="#table-of-contents">Table of contents</a></h1>
<ol>
<li><a href="HOW-TO/kickstart.html#introduction">Introduction</a></li>
<li><a href="HOW-TO/kickstart.html#links">Important links</a></li>
<li><a href="HOW-TO/kickstart.html#install">Installation</a>
<ol>
<li><a href="HOW-TO/kickstart.html#cosmonic">Cosmonic</a></li>
<li><a href="HOW-TO/kickstart.html#wash">Wash cli</a></li>
</ol>
</li>
<li><a href="HOW-TO/kickstart.html#constellations">Use Cosmonic constellations</a></li>
</ol>
<br/>
<br/>
<h2 id="introduction-1"><a class="header" href="#introduction-1">Introduction <a name="introduction"></a></a></h2>
<p>This document will take you step by step in your journey in Wasmcloud technology , starting from important links you must check passing by installation &amp; running until testing your 1st actor :tada:</p>
<h2 id="important-links"><a class="header" href="#important-links">Important links <a name="links"></a></a></h2>
<h2 id="installation"><a class="header" href="#installation">Installation <a name="install"></a></a></h2>
<h3 id="cosmonic"><a class="header" href="#cosmonic">Cosmonic <a name="cosmonic"></a></a></h3>
<h3 id="wash"><a class="header" href="#wash">Wash <a name="wash"></a></a></h3>
<h2 id="use-cosmonic-constellations"><a class="header" href="#use-cosmonic-constellations">Use cosmonic constellations <a name="constellations"></a></a></h2>
<div style="break-before: page; page-break-before: always;"></div><h1 id="smithy-notes"><a class="header" href="#smithy-notes">Smithy Notes</a></h1>
<p>This document to give you some notes about smithy with wasmcloud and Rust.</p>
<h1 id="table-of-contents-1"><a class="header" href="#table-of-contents-1">Table of contents</a></h1>
<ol>
<li><a href="HOW-TO/smithy-notes.html#introduction">Introduction</a></li>
<li><a href="HOW-TO/smithy-notes.html#links">Important links</a></li>
<li><a href="HOW-TO/smithy-notes.html#annotation">Annotation traits</a>
<ol>
<li><a href="HOW-TO/smithy-notes.html#codegen">codegen</a></li>
</ol>
</li>
</ol>
<h2 id="introduction-2"><a class="header" href="#introduction-2">Introduction <a name="introduction"></a></a></h2>
<p>Every capability provider has a capability contract - an interface definition - that defines a service and a set of operations it supports. Even actor-to-actor messages, which don't use capability contracts, benefit by well-defined API contracts. In wasmCloud, we define these API contracts in Smithy files.</p>
<h2 id="important-links-1"><a class="header" href="#important-links-1">Important links <a name="links"></a></a></h2>
<p><a href="HOW-TO/smithy-notes.html#https://wasmcloud.com/docs/hosts/abis/wasmbus/interfaces/">Interfaces</a></p>
<h2 id="annotation-traits"><a class="header" href="#annotation-traits">Annotation traits <a name="annotation"></a></a></h2>
<h3 id="codegen"><a class="header" href="#codegen">codegen <a name="codegen"></a></a></h3>
<p>when can we use this traits will be mentioned in this <a href="HOW-TO/smithy-notes.html#https://wasmcloud.com/docs/hosts/abis/wasmbus/interfaces/traits#codegenrust">link</a>
but the only note you need to know is :</p>
<ul>
<li>you should add the import for codegenrust in your smithy file to see the effect of using this trait </li>
</ul>
<blockquote>
<p>use org.wasmcloud.model#codegenRust</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="runbook--manage-ks-store"><a class="header" href="#runbook--manage-ks-store">Runbook : Manage ks store</a></h1>
<h3 id="product-name-"><a class="header" href="#product-name-">Product name :</a></h3>
<ul>
<li>distributed-rating</li>
</ul>
<h3 id="product-version-"><a class="header" href="#product-version-">Product version :</a></h3>
<ul>
<li>All</li>
</ul>
<h3 id="runbook-goals-"><a class="header" href="#runbook-goals-">Runbook Goals :</a></h3>
<ul>
<li>How to manage kv store using cli </li>
</ul>
<h3 id="preconditions"><a class="header" href="#preconditions">Preconditions</a></h3>
<ul>
<li><a href="https://cosmonic.com/docs/user_guide/cosmo_cli">Cosmonic cli</a> installed</li>
<li><a href="https://wasmcloud.com/docs/installation?os=mac">wash</a> installed</li>
<li><a href="https://docs.nats.io/using-nats/nats-tools/nats_cli">NATS cli</a> installed</li>
</ul>
<h3 id="stages-"><a class="header" href="#stages-">Stages :</a></h3>
<ol>
<li><a href="HANDBOOK/kv-store-management.html#stage1">Stage 1</a> : List kv buckets</li>
<li><a href="HANDBOOK/kv-store-management.html#stage2">Stage 2</a> : List all keys in a bucket</li>
<li><a href="HANDBOOK/kv-store-management.html#stage3">Stage 3</a> : Put key and value</li>
<li><a href="HANDBOOK/kv-store-management.html#stage4">Stage 4</a> : Get value using key</li>
</ol>
<hr />
<h2 id="stage-1--list-kv-buckets"><a class="header" href="#stage-1--list-kv-buckets">Stage 1 : List kv buckets <a name="stage1"></a></a></h2>
<p>open your terminal and execute the below command</p>
<blockquote>
<p>nats kv -s connect.cosmonic.sh --creds ~/.cosmo/user.creds ls</p>
</blockquote>
<p>This command will retun the buckets in kv store</p>
<h2 id="stage-2--list-all-keys-in-a-bucket"><a class="header" href="#stage-2--list-all-keys-in-a-bucket">Stage 2 : List all keys in a bucket <a name="stage2"></a></a></h2>
<p>open your terminal and execute the below command</p>
<blockquote>
<p>nats kv -s connect.cosmonic.sh --creds ~/.cosmo/user.creds ls <em><strong>bucket-id</strong></em></p>
</blockquote>
<p><em><strong>bucket-id</strong></em> : is the id of bucket returned from Stage 1 </p>
<h2 id="stage-3--put-key-and-value"><a class="header" href="#stage-3--put-key-and-value">Stage 3 : put key and value <a name="stage3"></a></a></h2>
<p>open your terminal and execute the below command</p>
<blockquote>
<p>nats kv -s connect.cosmonic.sh --creds ~/.cosmo/user.creds put 125b2a01-09a1-4d64-8bfc-5aa222e9c560 <em><strong>key</strong></em> <em><strong>value</strong></em></p>
</blockquote>
<blockquote>
<p>ex nats kv -s connect.cosmonic.sh --creds ~/.cosmo/user.creds put 125b2a01-09a1-4d64-8bfc-5aa222e9c560 customer1 '{\n        &quot;product&quot;: {\n           &quot;id&quot;:1234,\n           &quot;offerId&quot;:534,\n           &quot;description&quot;:&quot;”Video on Demand”&quot;,\n           &quot;productPrice&quot;: {\n              &quot;description&quot;:&quot;”Cost per movie”&quot;,\n              &quot;validTill&quot;:&quot;1/March/2024&quot;,\n              &quot;priceType&quot;:&quot;non-recurring&quot;,\n              &quot;unitOfMeasure&quot;: {\n                 &quot;amount&quot;:&quot;1&quot;,\n                 &quot;units&quot;:&quot;”movie”&quot;\n              },\n              &quot;price&quot;: {\n                 &quot;unit&quot;:&quot;eur&quot;,\n                 &quot;value&quot;:&quot;1&quot;\n              },\n              &quot;ratingAgent&quot;: {}\n           }\n        }\n    }'</p>
</blockquote>
<h2 id="stage-4--get-value-using-key"><a class="header" href="#stage-4--get-value-using-key">Stage 4 : Get value using key <a name="stage4"></a></a></h2>
<p>open your terminal and execute the below command</p>
<blockquote>
<p>nats kv -s connect.cosmonic.sh --creds ~/.cosmo/user.creds get <em><strong>bucket-id</strong></em>  <em><strong>key</strong></em> --raw</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="runbook--link-management"><a class="header" href="#runbook--link-management">Runbook : Link management</a></h1>
<h3 id="product-name--1"><a class="header" href="#product-name--1">Product name :</a></h3>
<ul>
<li>distributed-rating</li>
</ul>
<h3 id="product-version--1"><a class="header" href="#product-version--1">Product version :</a></h3>
<ul>
<li>All</li>
</ul>
<h3 id="runbook-goals--1"><a class="header" href="#runbook-goals--1">Runbook Goals :</a></h3>
<ul>
<li>How to manage links throw wash cli</li>
</ul>
<h3 id="preconditions-1"><a class="header" href="#preconditions-1">Preconditions</a></h3>
<ul>
<li><a href="https://cosmonic.com/docs/user_guide/cosmo_cli">Cosmonic cli</a> installed</li>
<li><a href="https://wasmcloud.com/docs/installation?os=mac">wash</a> installed</li>
</ul>
<h3 id="stages--1"><a class="header" href="#stages--1">Stages :</a></h3>
<ol>
<li><a href="HANDBOOK/link-management.html#stage1">Stage 1</a> : Query Links</li>
<li><a href="HANDBOOK/link-management.html#stage2">Stage 2</a> : Delete Link</li>
<li><a href="HANDBOOK/link-management.html#stage3">Stage 3</a> : Create Link</li>
</ol>
<hr />
<h2 id="stage-1--query-links"><a class="header" href="#stage-1--query-links">Stage 1 : Query Links <a name="stage1"></a></a></h2>
<p>open your terminal and execute the below command</p>
<blockquote>
<p>wash ctl link query -x 125b2a01-09a1-4d64-8bfc-5aa222e9c560 --ctl-port 4222 --ctl-host connect.cosmonic.sh --ctl-credsfile ~/.cosmo/user.creds</p>
</blockquote>
<p>This command will retun the id of the Links</p>
<h2 id="stage-2--delete-link"><a class="header" href="#stage-2--delete-link">Stage 2 : Delete Link <a name="stage2"></a></a></h2>
<p>open your terminal and execute the below command</p>
<blockquote>
<p>wash ctl link del <em><strong>&lt;link_id&gt;</strong></em> wasmcloud:keyvalue -x 125b2a01-09a1-4d64-8bfc-5aa222e9c560 --ctl-port 4222 --ctl-host connect.cosmonic.sh --ctl-credsfile ~/.cosmo/user.creds</p>
</blockquote>
<p><em><strong>link_id</strong></em> : is the id returned from Stage 1 </p>
<h2 id="stage-3--create-link"><a class="header" href="#stage-3--create-link">Stage 3 : Create Link <a name="stage3"></a></a></h2>
<p>open your terminal and execute the below command</p>
<blockquote>
<p>wash ctl link put --link-name <em><strong>&lt;LINK_NAME&gt;</strong></em> [OPTIONS] <em><strong><actor-id></strong></em> <em><strong><provider-id></strong></em> <em><strong><contract-id></strong></em></p>
</blockquote>
<p><em><strong>LINK_NAME</strong></em> : the name of the link you need to create
<em><strong>actor-id</strong></em> : the id of the actor which will use this link
<em><strong>provider-id</strong></em> : the id of the provider which the actor will link to
<em><strong>contract-id</strong></em> : the contract id of this provider</p>
<blockquote>
<p>ex :  wash ctl link put -x 125b2a01-09a1-4d64-8bfc-5aa222e9c560 --ctl-port 4222 --ctl-host connect.cosmonic.sh --ctl-credsfile ~/.cosmo/user.creds --link-name local-redis-to-vod-bucket MCS4KQH3XXYN2CA7TIY4OAWE4Q3J6AZSPWX6BK5EOF7MH2FE76NSGYIF VAKKKUUZH6FWYPS3T6WVAESSPVQMQYJ2IRCXGSHYCOISSIUGCXVJYC6M linkwasmcloud:keyvalue</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="runbook--shutdown-a-host"><a class="header" href="#runbook--shutdown-a-host">Runbook : Shutdown a host</a></h1>
<h3 id="product-name--2"><a class="header" href="#product-name--2">Product name :</a></h3>
<ul>
<li>distributed-rating</li>
</ul>
<h3 id="product-version--2"><a class="header" href="#product-version--2">Product version :</a></h3>
<ul>
<li>All</li>
</ul>
<h3 id="runbook-goals--2"><a class="header" href="#runbook-goals--2">Runbook Goals :</a></h3>
<ul>
<li>Shudown a host in a local machine </li>
</ul>
<h3 id="preconditions-2"><a class="header" href="#preconditions-2">Preconditions</a></h3>
<ul>
<li><a href="https://cosmonic.com/docs/user_guide/cosmo_cli">Cosmonic cli</a> installed</li>
<li><a href="https://wasmcloud.com/docs/installation?os=mac">wash</a> installed</li>
</ul>
<h3 id="stages--2"><a class="header" href="#stages--2">Stages :</a></h3>
<ol>
<li><strong>Stage 1</strong> : Get yout local host id</li>
<li><strong>Stage 2</strong> : Stop the host</li>
</ol>
<hr />
<h2 id="stage-1--get-your-local-host-id"><a class="header" href="#stage-1--get-your-local-host-id">Stage 1 : Get your local host id</a></h2>
<p>open your terminal and execute the below command</p>
<blockquote>
<p>wash ctl get hosts -x 125b2a01-09a1-4d64-8bfc-5aa222e9c560 --ctl-port 4222 --ctl-host connect.cosmonic.sh --ctl-credsfile ~/.cosmo/user.creds</p>
</blockquote>
<p>This command will retun the id of the running hosts</p>
<p><img src="HANDBOOK/img/06_10_00.jpg" alt="example!" /></p>
<h2 id="stage-2--stop-the-host"><a class="header" href="#stage-2--stop-the-host">Stage 2 : Stop the host</a></h2>
<p>open your terminal and execute the below command</p>
<blockquote>
<p>wash ctl stop host <em><strong>&lt;host_id&gt;</strong></em> -x 125b2a01-09a1-4d64-8bfc-5aa222e9c560 --ctl-port 4222 --ctl-host connect.cosmonic.sh --ctl-credsfile ~/.cosmo/user.creds</p>
</blockquote>
<p><em><strong>host_id</strong></em> : is the id returned from Stage 1 </p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="rationale"><a class="header" href="#rationale">Rationale</a></h1>
<h2 id="context-1"><a class="header" href="#context-1">Context</a></h2>
<p>IPCEI CIS WP2</p>
<ul>
<li>Cloud Infrastructure and Services</li>
<li>Work Package #2</li>
<li>Orange submission: open-source and distributed Core Commerce for IT</li>
</ul>
<h2 id="value-proposition"><a class="header" href="#value-proposition">Value proposition</a></h2>
<ul>
<li>
<p>In a complex service ecosystem and/or 5G context, the rating of service usage is highly complex:</p>
<ul>
<li>service providers are no longer those who are in direct contact with the customer or those who invoice the customer, there are aggregators, marketplaces...</li>
<li>the pricing rules for the usage of technical services may be different depending on the reseller (composite services, service bundles, discounts on purchase, on usage)</li>
<li>even more: &quot;à la carte&quot; pricing for each customer</li>
</ul>
</li>
<li>
<p>Rather than uploading raw usage data (~CDR), rated in a centralized rating engine system (or semi-distributed between the various partners who contribute to the final service provided to the customer), we propose to ditribute the rating process to the customer device and upload to the service vendor of usage tickets already valued</p>
<ul>
<li>each of the partners contributes to the specific pricing of the customer, the pricing is made directly at the same time as the consumption of the service</li>
<li>to do a parallel with rights management: it is easier to have components that each carry their authorization model rather than applying the model externally to the entire system</li>
<li>each partner brings (in the form of an agent) the valuation engine of his service, possibly configured / overloaded by a partner reusing this service</li>
<li>&quot;as code&quot; rating engine approach rather than a fixed and parameterized system</li>
</ul>
</li>
<li>
<p>Prerequisites for this scenario are: &quot;reasonably secure&quot; device environment, possibility of deploying code on this environment, ability to detect fraud</p>
</li>
<li>
<p>Orange offers an SDK to its partners allowing them to simply integrate the enhancement of the service into the application used to consume the service</p>
<ul>
<li>the SDK is a wasmcloud-js runtime that can run code (1 or wasmcloud agents) in charge of recovery</li>
<li>the service consumer application feeds the SDK with usage data</li>
</ul>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="requirements"><a class="header" href="#requirements">Requirements</a></h1>
<h2 id="main-problematics"><a class="header" href="#main-problematics">Main problematics</a></h2>
<ul>
<li>
<p>build a model that can support all scenarios of an open service ecosystem (B2B2X)</p>
<ul>
<li>vendors, aggregators, marketplaces, dynamic, as-a-service, recharging...</li>
</ul>
</li>
<li>
<p>establish a shared trust between the 3 main actors (Service Provider, Vendor and Consumer)</p>
<ul>
<li>being able to distribute (crypto) proofs <em>of usage, of subscription...</em></li>
<li>&quot;good enought&quot; security model, especially on the users devices</li>
</ul>
</li>
<li>
<p>fraud detection mecanism</p>
</li>
</ul>
<h2 id="requirements-1"><a class="header" href="#requirements-1">Requirements</a></h2>
<ul>
<li>
<p>the solution </p>
<ul>
<li>cannot rely on DPI to identify trafic usage (cf. HTTP2/3/QUIC)</li>
<li>is over-IP</li>
<li>implement (or is frendly to) fraud detection mecanisms and is auditable</li>
<li>does not require prior human agreement between the service vendor and the service provider (self-service)</li>
</ul>
</li>
<li>
<p>optionnally, the solution should</p>
<ul>
<li>be compatible with a non reliable network (intermitent conncectivity, off-line mode)</li>
</ul>
</li>
</ul>
<h2 id="use-cases"><a class="header" href="#use-cases">Use cases</a></h2>
<p>Some base examples, they could be combined</p>
<ul>
<li>customers sharing the same bucket for a given service (eg. Friends and Family offers)</li>
<li>vendors reselling bundles of services with a different tarification (eg. 30% on Netflix + OCS bundle)</li>
<li>composite offer (eg. free dataplan for watching VOD service)</li>
<li>context dependant offers (eg. free videoconference while being at a special event)</li>
<li>sponsored services (eg. third party offering 20% coupons on VOD for two months)</li>
<li>each customer gets its personalized offer</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="model"><a class="header" href="#model">Model</a></h1>
<h2 id="domain-exploration"><a class="header" href="#domain-exploration">Domain exploration</a></h2>
<ul>
<li>3 main actors
<ul>
<li>Service Consumer</li>
<li>Service Vendor</li>
<li>Service Provider</li>
</ul>
</li>
</ul>
<p><img src="ARCHIVE/./model-overview.drawio.svg" alt="" /></p>
<ul>
<li>
<p>concepts</p>
<ul>
<li>rating engine</li>
<li>proofs
<ul>
<li>subscription</li>
<li>usage</li>
<li>identity</li>
</ul>
</li>
</ul>
</li>
<li>
<p>offers</p>
<ul>
<li>on usage</li>
<li>pre-paid
<ul>
<li>can an monthly subscription be seen as pre-paid?</li>
</ul>
</li>
</ul>
</li>
<li>
<p>payments</p>
<ul>
<li>3 types
<ul>
<li>µ-transaction: no billing, 1 usage = 1 <strong>immediate</strong> payment</li>
<li>post-paid: 1 usage = 1 <strong>future</strong> payment on a bill</li>
<li>pre-paid: w/ bucket, 1 usage = 1 bucket update</li>
</ul>
</li>
<li>in a 3-party interaction (user, vendor, provider)
<ul>
<li>either the provider has to trust the vendor to &quot;recover user's paiments&quot; 
<ul>
<li>needs pre-agreement or a base of trusted vendors) <strong>DONT: incompatible w/ requirements</strong></li>
</ul>
</li>
<li>either the vendor is paying the provider immediatly for the user's usage</li>
<li>either the vendor has already bought a &quot;pre-paid bucket&quot; to the provider</li>
</ul>
</li>
</ul>
</li>
<li>
<p>B2B2C scenarios, bucket delegation</p>
<ul>
<li>the vendor buys pre-paid bucket to the provider
<ul>
<li>it can split it among it's users
<ul>
<li>user is paying the usage directly to the provider</li>
</ul>
</li>
<li>or decide to have an other payment type (µ-payment, billing)
<ul>
<li>vendor is paying the usage to the provider</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="findings"><a class="header" href="#findings">findings</a></h3>
<ul>
<li>billing is a vendors responsibility, not a provider one</li>
<li>it might be simplier (ie. support more scenarios) to always have a user&gt;vendor&gt;provider chain instead of a direct user&gt;provider relation</li>
</ul>
<h3 id="to-be-discussed"><a class="header" href="#to-be-discussed">to be discussed</a></h3>
<ul>
<li>
<p>entities modeling</p>
<ul>
<li>are Service Vendors also service providers?</li>
<li>are service Vendors also service consumers?</li>
<li>implementation note: instead of inheritance we can use traits</li>
</ul>
</li>
<li>
<p>where shoud the usage proof go ?</p>
<ul>
<li>service vendor / provider / both</li>
<li>avoid proxies</li>
</ul>
</li>
<li>
<p>similar / alternative approaches</p>
<ul>
<li><a href="https://www.mavoco.com/cmp-connenctivity-management-platform/connectivity-online-usage-controller/">Distributed IoT Online Rating – The Global Rating Grid @mavoco.com</a></li>
<li>are there research papers on the subject?</li>
<li>Shine (Orange internal project) third party use-cases</li>
</ul>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="solution-1"><a class="header" href="#solution-1">Solution 1</a></h1>
<p>proposed solution (WIP)</p>
<h2 id="third-party-management-1"><a class="header" href="#third-party-management-1">third party management</a></h2>
<ul>
<li>definitions
<ul>
<li>service vendor: customer-facing tier, manages the customer subscription, billing and payments</li>
<li>service provider: provides a technical service, also acts as a service vendor in B2B2X scenarios</li>
</ul>
</li>
</ul>
<h3 id="basic-case-the-service-vendor-is-the-service-provider-1"><a class="header" href="#basic-case-the-service-vendor-is-the-service-provider-1">basic case: the service vendor is the service provider</a></h3>
<ul>
<li>
<p>key ideas</p>
<ul>
<li>usage rating is done client-side via a <strong>rating agent</strong> deployed inside the service client app</li>
<li>a rating agent also acts as an authorization for consuming the service</li>
<li>a rating agents is the implementation of a commercial offer subscibed by the customer, it is managed like a contract</li>
</ul>
</li>
<li>
<p>communication diagram</p>
<p><img src="ARCHIVE/./sequence-3rdparty-basic.drawio.svg" alt="" /></p>
</li>
</ul>
<h3 id="complex-case-service-vendor-and-service-provider-1"><a class="header" href="#complex-case-service-vendor-and-service-provider-1">complex case: service vendor and service provider</a></h3>
<ul>
<li>
<p>key ideas</p>
<ul>
<li>the service vendor subscribes to a service provider (exactly like an end-user customer)</li>
<li>the users rating agent is a composite of service vendor and service provider rating agents</li>
<li>the service provider's rating agent is used as the authorization for consuming the service</li>
<li>end-user usage is uploaded to both service vendor and service provider</li>
</ul>
</li>
<li>
<p>communication diagram: service subscription</p>
<p><img src="ARCHIVE/./sequence-3rdparty-complex-subscription.drawio.svg" alt="" /></p>
</li>
<li>
<p>communication diagram: service usage</p>
<p><img src="ARCHIVE/./sequence-3rdparty-complex-usage.drawio.svg" alt="" /></p>
</li>
</ul>
<blockquote>
<p>and what about provisionning?</p>
</blockquote>
<h2 id="counting-and-rating-1"><a class="header" href="#counting-and-rating-1">counting and rating</a></h2>
<ul>
<li>
<p>a rating agent is a program specific a service / a commercial offer / a payment mode</p>
</li>
<li>
<p>its implementation will depend on the use cases</p>
<p><img src="ARCHIVE/./contract-agent.drawio.svg" alt="" /></p>
</li>
</ul>
<h3 id="post-paid-1"><a class="header" href="#post-paid-1">post-paid</a></h3>
<p>rating agent will</p>
<ul>
<li>authorize the customer to consume the service</li>
<li>generate <strong>rated proofs of service usage</strong> that will be aggregated on the customer bill (maintained by the service vendor)</li>
</ul>
<h3 id="prepaid--bucket-management-1"><a class="header" href="#prepaid--bucket-management-1">prepaid / bucket management</a></h3>
<p>rating agent will</p>
<ul>
<li>manage a <strong>stateful service bucket</strong> and consume it according to customer usage</li>
<li>report on the consuption of the service bucket</li>
<li>authorize the customer to consume the service</li>
<li>generates rated proofs of service usage, used for auditing / fraud detection</li>
</ul>
<h3 id="µ-payments-1"><a class="header" href="#µ-payments-1">µ-payments</a></h3>
<p>rating agent will</p>
<ul>
<li>trigger payment request and expect payment proof before allowing the usage of the service</li>
<li>authorize the customer to consume the service</li>
<li>generates rated proofs of service usage, used for auditing / fraud detection</li>
</ul>
<h2 id="agent-mandatory-traits-1"><a class="header" href="#agent-mandatory-traits-1">agent mandatory traits</a></h2>
<ul>
<li>authorizer trait: <code>authorize(identity) -&gt; key</code></li>
<li>rater trait: <code>rate(usage) -&gt; void</code></li>
</ul>
<h3 id="basic-case-1"><a class="header" href="#basic-case-1">basic case</a></h3>
<p><img src="ARCHIVE/./contract-agent-detailed.drawio.svg" alt="" /></p>
<h3 id="composite-case-1"><a class="header" href="#composite-case-1">composite case</a></h3>
<p><img src="ARCHIVE/./contract-agent-detailed-composite.drawio.svg" alt="" /></p>
<ul>
<li>note that there is &quot;shortcut&quot; in <code>3. get vendor identity</code>. It does not really return an identity but a &quot;vendor service subscription&quot; authorization token. Check next paragraph</li>
</ul>
<h2 id="identity-management-1"><a class="header" href="#identity-management-1">identity management</a></h2>
<p>The IAM have been simplified in the previous diagrams.</p>
<p>We distinguish</p>
<ul>
<li>Client identity (OIDC profile, OAuth token)</li>
<li>Client service subscription authorization token (OAuth token): traded from the client identity, represents the fact that the client has subscribed to the service, regardless its right to access the service (for instance with an empty bucket on a prepaid service)</li>
</ul>
<p>And the same for Service Vendors (which are Clients of Service Providers)</p>
<p>The authorizer trait signature is <code>authorize(service subscription authorization token) -&gt; key</code></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="about-wasmcloud"><a class="header" href="#about-wasmcloud">About wasmCloud</a></h1>
<p><img src="https://cosmonic.com/images/blogs/2022/wasmcloud-from-edge-to-cloud.png" alt="" /></p>
<h2 id="pros--cons"><a class="header" href="#pros--cons">Pros &amp; Cons</a></h2>
<p>wasmCloud pro &amp; cons of in the context of this prototype</p>
<ul>
<li>
<p><strong>pros</strong></p>
<ul>
<li>robust and ubiquous connectivity, network mesh over IP (inherited from NATS)</li>
<li>zero-trust by design (as long as the runtime is secure): signed nodes, payloads &amp; communications</li>
<li>efficient</li>
<li>event driven model, scalable, multi-region friendly</li>
<li>clean split between pure functions (ie. wasmCloud Actors) and internal states / outside world (ie. wasmCloud CapabilityProviders)</li>
<li>node runtime support many different hosts (vm, docker, k8s, browsers...)</li>
<li>polyglot platform (mostly Rust for now)</li>
</ul>
</li>
<li>
<p><strong>cons</strong></p>
<ul>
<li>young technology (in the CNCF sandbox, but quite active)</li>
<li>opinionated PaaS approach
<ul>
<li>no oob support from hyperscalers</li>
</ul>
</li>
<li>wip on orchestration / observability</li>
<li>important learning curve on development stack
<ul>
<li>rust as main programming language</li>
<li>cannot (or difficult to) leverage on existing rust framework</li>
<li>sometimes cryptic error messages</li>
<li>lack of extensive documentation</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>recommandations for this prototype</strong></p>
<ul>
<li>use wasmCloud &quot;at the egde&quot;, do not try to implement the whole solution with wasmCloud</li>
</ul>
</li>
</ul>
<h2 id="main-concepts"><a class="header" href="#main-concepts">Main concepts</a></h2>
<div class="table-wrapper"><table><thead><tr><th>concept</th><th>caracteristics</th></tr></thead><tbody>
<tr><td>host</td><td>or node, runtime on a host, erlang VM</td></tr>
<tr><td>lattice</td><td>meshed netork, NATS</td></tr>
<tr><td>actors</td><td>wasm payloads, stateless functions, implementing an interface</td></tr>
<tr><td>capability providers</td><td>wasm payloads, stateful and attached to a node, offering services</td></tr>
<tr><td>links</td><td>declarative links between actors and capability providers</td></tr>
<tr><td>interface</td><td>functionnal interface of an actor / capability</td></tr>
</tbody></table>
</div>
<p>the wasmCloud dashboard
<img src="https://wasmcloud.com/images/blogs/ngs-global/dashboard.png" alt="dashboard" /></p>
<h2 id="resources"><a class="header" href="#resources">Resources</a></h2>
<h3 id="main-sites"><a class="header" href="#main-sites">main sites</a></h3>
<ul>
<li><a href="https://wasmcloud.com/">wasmcloud.com</a> - links, articles</li>
<li><a href="https://wasmcloud.dev/">wasmcloud.dev</a> - product documentation</li>
<li><a href="https://cosmonic.com/">cosmonic.com</a> - the company that supports the opensource</li>
<li><a href="https://nats.io">nats.io</a></li>
</ul>
<h3 id="documentation-and-trainings"><a class="header" href="#documentation-and-trainings">documentation and trainings</a></h3>
<ul>
<li><a href="https://wasmcloud.dev/overview/">wasmCloud doc</a></li>
<li><a href="https://docs.nats.io/">NATS doc</a></li>
<li><a href="https://labs.cosmonic.com/">Cosmonic: Introduction to wasmCloud &amp; WebAssembly basics</a></li>
<li><a href="https://training.linuxfoundation.org/training/webassembly-actors-from-cloud-to-edge-lfd134x/">Linux Foundation: WebAssembly Actors: From Cloud to Edge</a></li>
</ul>
<h3 id="articles"><a class="header" href="#articles">articles</a></h3>
<ul>
<li><a href="https://wasmcloud.com/blog/wasmcloud_third_anniversary/">Reflections on Three Years of wasmCloud, Kevin Hoffman</a></li>
<li><a href="https://wasmcloud.com/blog/webassembly_components_and_wasmcloud_actors_a_glimpse_of_the_future/">WebAssembly Components and wasmCloud Actors: A Glimpse of the Future, Taylor Thomas</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="architecture"><a class="header" href="#architecture">Architecture</a></h1>
<h2 id="components"><a class="header" href="#components">components</a></h2>
<ul>
<li>
<p>browser runtime</p>
<ul>
<li>javascript wasmCloud runtime deployed as javascript SDK</li>
</ul>
</li>
<li>
<p>user ident/authent</p>
<ul>
<li>OIDC / OAuth</li>
<li>expose service to recover browser runtime host-keys</li>
</ul>
</li>
<li>
<p>ngs</p>
<ul>
<li>NATS network</li>
</ul>
</li>
</ul>
<p><img src="ARCHIVE/./architecture.drawio.svg" alt="architecture" /></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="prototype-architecture"><a class="header" href="#prototype-architecture">Prototype Architecture</a></h1>
<h2 id="actor-model"><a class="header" href="#actor-model">actor model</a></h2>
<p><img src="ARCHIVE/prototype-architecture.drawio.svg" alt="" /></p>
<h2 id="git-repos"><a class="header" href="#git-repos">git repos</a></h2>
<pre><code>├── generic
│   ├── agent-api-provider
│   ├── agent-storage-provider
│   └── collector-provider
├── interface
│   ├── agent-storage-interface
│   ├── authorizer-interface
│   ├── collector-interface
│   └── rater-interface
├── specific-orange
│   ├── orange-offer1-agent
│   └── orange-offer1-authorization-provider
└── specific-vendor1
    ├── vendor1-offer1-agent
    └── vendor1-offer1-authorization-provider
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="technical-requirements-and-questions-wip"><a class="header" href="#technical-requirements-and-questions-wip">Technical requirements and questions (WIP)</a></h1>
<h2 id="project-specific"><a class="header" href="#project-specific">project specific</a></h2>
<h3 id="fraud--risk-analysis"><a class="header" href="#fraud--risk-analysis">fraud / risk analysis</a></h3>
<ul>
<li>
<p>is there a risk of a rating-agent doing non-legitimate modifications of its associated bucket / an other bucket?</p>
</li>
<li>
<p>if those risks are too high, can we have &quot;server-side&quot; rating agent proxy to mitigate them?</p>
</li>
</ul>
<h3 id="stateless-agents"><a class="header" href="#stateless-agents">stateless agents</a></h3>
<ul>
<li>how to manage efficiently agents configuration in a stateless word? (caching mechanisms / via dedicated local capability providers?)</li>
</ul>
<h3 id="interagent-communication"><a class="header" href="#interagent-communication">interagent communication</a></h3>
<ul>
<li>how to ensure an actor (rating agent for instance) only speak to its conterpart (collector agent for instance)</li>
</ul>
<h2 id="wasmcloud-generic"><a class="header" href="#wasmcloud-generic">wasmCloud generic</a></h2>
<h3 id="keep-the-rating-agent-code-public-"><a class="header" href="#keep-the-rating-agent-code-public-">keep the rating agent code public ?</a></h3>
<ul>
<li>link between the source code and the wasmCloud actor on OCI regristry ?</li>
</ul>
<h3 id="message-delivery-guarantee"><a class="header" href="#message-delivery-guarantee">message delivery guarantee</a></h3>
<ul>
<li>by design &quot;naked NATS&quot; does <a href="https://docs.nats.io/nats-concepts/overview/compare-nats">not guarantee message delivery</a>, does wasmCloud implement it?</li>
</ul>
<h3 id="do-interfaces-support-inheritance-"><a class="header" href="#do-interfaces-support-inheritance-">do interfaces support inheritance ?</a></h3>
<h3 id="how-to-use-links"><a class="header" href="#how-to-use-links">how to use links</a></h3>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->
        <script src="mermaid.min.js"></script>
        <script src="mermaid-init.js"></script>

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </div>
    </body>
</html>
