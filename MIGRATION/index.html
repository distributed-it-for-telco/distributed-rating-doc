<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Wasm v1 migration - Distributed Rating Engine with wasmCloud</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href=".././mdbook-admonish.css">


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "light" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Distributed Rating Engine with wasmCloud</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/distributed-it-for-telco" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/distributed-it-for-telco/distributed-rating-doc/edit/main/src/MIGRATION/index.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <ul>
<li>How to use what have been done.</li>
<li>prerequisites ::  what versions of wash / wasm host / (rust targets ?) have to be</li>
<li>commons
<ul>
<li>serialization</li>
<li>error handling</li>
<li>builder</li>
</ul>
</li>
<li>inter-component communications
<ul>
<li>wrpc</li>
<li>build time composition vs runtime composition</li>
</ul>
</li>
<li>wasmcloud vs wasmtime</li>
<li>current difficulties</li>
</ul>
<hr />
<h1 id="this-file-documents-the-summary-of-work-done-in-order-to-migrate-the-application-to-web-assembly-version--v10-and-component-model"><a class="header" href="#this-file-documents-the-summary-of-work-done-in-order-to-migrate-the-application-to-web-assembly-version--v10-and-component-model">This file documents the summary of work done in order to migrate the application to web assembly version &gt; V1.0 and component model</a></h1>
<h2 id="main-changes"><a class="header" href="#main-changes">Main changes:</a></h2>
<ol>
<li>The apotion of The WebAssembly component model as a broad-reaching architecture for building interoperable Wasm libraries, applications, and environments.</li>
<li>smithy interface language(IDL) has been deprecated in favor of <a href="https://github.com/WebAssembly/component-model/blob/main/design/mvp/WIT.md">WIT IDL</a></li>
<li>Access to low level system APIs are granted through WebAssembly System Interfaces <a href="https://wasi.dev/">WASI</a> interfaces, written in wit, as well.</li>
</ol>
<blockquote>
<p><strong>Note</strong> : One of the goals of this migration was to depend mainly on standard APIs and standard runtime (<a href="https://wasmtime.dev/">wasmtime</a>), however, this goal was not possible at the current time, due to a set of reasons explained below</p>
</blockquote>
<hr />
<h2 id="current-standing"><a class="header" href="#current-standing">Current Standing:</a></h2>
<ul>
<li>due to the pause of the project, only these components have been migrated
<ul>
<li>rating agents:
<ul>
<li>aws-stor-rating-agent</li>
<li>orange-vod-metaverse-agent</li>
<li>orange-vod-rating-agent</li>
<li>streaming-rating-agent</li>
<li>video-rating-agent</li>
</ul>
</li>
<li>usage coolectors
<ul>
<li>usage-collector-aws</li>
<li>usage-collector-orange</li>
<li>usage-collector-video-provider</li>
<li>usage-collector-dropbox</li>
<li>usage-collector-orange-connectivity</li>
</ul>
</li>
<li>rating-coordinator</li>
<li>kv-balance-manager (balance-management in new directory)</li>
<li>API-gateway (partially due to the missing of remaining components)</li>
</ul>
</li>
<li>These are the points that needs investigation to be migrated to new version
<ul>
<li>CQRS approach for distributed data
<ul>
<li>the possibility of re-attempting using concordance</li>
<li>or finding an alternate</li>
</ul>
</li>
</ul>
</li>
<li>These are the points that has been marked as "complete but better to investigate for enhancement"
<ul>
<li>Error-handling: fix the error type hierarchy</li>
<li>Builder DSL: two models were implemented that need comparison and selecting one of them</li>
</ul>
</li>
<li>Topics that still needs investigation which does not have impact on migration
<ul>
<li>contract as code</li>
<li>deployment options for the new version
<ul>
<li>The use of purple OS</li>
<li>The possibility of suing IOT devices as a cluster, by utilizing the lightweight characteristics of wasm infrastructure.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="highlights"><a class="header" href="#highlights">Highlights:</a></h2>
<h3 id="1-the-usage-of-wasmcloud-over-wasmtime"><a class="header" href="#1-the-usage-of-wasmcloud-over-wasmtime">1. The usage of wasmcloud over wasmtime</a></h3>
<ul>
<li>The initial plan was to use wasmtime as a runtime for the new app, as wasmtime is the standard wasm runtime, and all other frameworks use it as a base for their runtime. The motivation was to make the code as independant from specific providers to maintain portability.since all providers customize certain features to fit their infrastucture</li>
<li>Unfortunately, wasmtime at the time of writing this documentation is still incomplete and missing some critical features, including some important WASI interfaces which in turn are still in draft phase and not in implementation phase yet.</li>
<li>Before we take the decision to go back to wasmcloud, we tried to find workarounds for the problems, but unfortunately unsuccessfull</li>
<li>More details about this topic can be found at the migration study in the <a href="./initial-study.html">studies</a> file</li>
</ul>
<h3 id="2-the-commons-component"><a class="header" href="#2-the-commons-component">2. The Commons component:</a></h3>
<ul>
<li>in the previous version, common functionalities were exposed to other wasm actors as rust crate, defined in cargo.toml</li>
<li>in the newer version, according to the component model, all bahaviour should be exposed to components other than self through wit-defined interfaces, to ensure portability and interoperability at large scale, therefore, a special component was created which contains both wit interfaces and implementations for such common functionalities.</li>
<li>due to the nature of this comonents, plus some limitations that exists in the runtime environment, the common component is not deployed as a standalone running component, rather, it is composed at build time with each component that depends on it.</li>
<li>more information about the exposed interfaces and how-to use each interface can be found in the README file in the component source code</li>
</ul>
<h3 id="3-inter-component-communication"><a class="header" href="#3-inter-component-communication">3. Inter-component communication</a></h3>
<ul>
<li>Before migrating to wasmcloud, wasmtime supported only one way to communicate between components, that is to compose both components at build time to generate new wasm components which containes all features.</li>
<li>Wasmcloud provided a mechanism to facilitate communication between separately deployed components, through the <a href="https://github.com/bytecodealliance/wrpc">WRPC Project</a>
<ul>
<li>by only referncing the wit interface, wasmcloud is able to make a "behind the scene" wrpc call to the default implementation of that interface, defined in the wadm configuration file, assuming only one implementation exist</li>
<li>in the case where multiple implementations exist, we had to use wasmcloud specific APIs to manage the calls, other wise this would not be feasible</li>
<li>finally, the WRPC project contains some issues affecting component communication using user defined wit-types. mandating build time composition in that case using <a href="https://github.com/bytecodealliance/wac">WAC tool</a>. The composition in that case only is a workaround, not a design decision</li>
<li><span style="font-weight: 700">To summarize</span>: we use runtime linking (wrpc) only to communicate between two deployed components <strong>(by design)</strong>. We use build time linking (composition) when sharing user defined type <strong>(as a wrokaround)</strong>, or when the depenant component is not deployable, like the commons <strong>(by design)</strong></li>
</ul>
</li>
</ul>
<h3 id="4-current-challenges"><a class="header" href="#4-current-challenges">4. Current Challenges</a></h3>
<ul>
<li>Continous evolution of the ecosystem
<ul>
<li>Most wasm projects,including wasmcloud, are not at a stable point, and keeps changing at a pace that causes request revision of the code, and sometimes disturb the development process itslef</li>
<li>examples:
<ul>
<li>many wasi interfaces are still at phase-1 or phase-2, meaning there is no standard implementation, and specific provider implementation is needed like wasmcloud</li>
<li>wasmcloud has made non-backward compatible to the project templates, also switched some dev-tools like wit-deps without explicit migration guide</li>
<li>wasmcloud is quickly adopting new rust targets, which caused disturpance during development cycle</li>
</ul>
</li>
</ul>
</li>
<li>slow learning curve
<ul>
<li>new comers to the eco-system are requied to have in depth knowledge of many items, many of them are not trivial:
<ul>
<li>rust is the de-facto language for wasm developemnt, and even wit IDL quoted many concepts from rust, so a good knowledge of rust concepts is a must</li>
<li>The concepts of component model is a must to know in order to be able to go through and be able to develop across the vast eco system</li>
</ul>
</li>
<li>the laguage used in the documentation is both quite academic and far from being easily readable</li>
<li>the structure of the documentation is pretty poor</li>
<li>the distribution of the repository of the tools for the ecosystem makes it harder to search for anwers properly</li>
</ul>
</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../ADR/ard001-monorepo_code_organization.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../HOW-TO/kickstart.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../ADR/ard001-monorepo_code_organization.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../HOW-TO/kickstart.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../mermaid.min.js"></script>
        <script src="../mermaid-init.js"></script>


    </div>
    </body>
</html>
