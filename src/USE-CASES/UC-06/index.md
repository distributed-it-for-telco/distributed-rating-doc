# UC-06: CQRS - Usage Proof command

In the context of the *distributed rating* system, *event sourcing* plays a
vital role in ensuring a reliable and accurate log of product usage events.
This log serves as a foundation for auditing, monitoring, and enhancing
the performance, scalability, and responsiveness of the system.

While the **Edge** handles the collection, storage, and computation of
necessary information for the *rating* procedure, it is essential to maintain
records of product usage to be consistent throughout the entirety of the system.

The **Cloud** takes responsibility for persisting the records propagated by
the *Edge* and performing data consolidation over multiple sources.
Thus eliminating the need for synchronizing the data model and the
business domain, while also enabling future compensating actions.

## Business processes

{{#include ../UC-02/product-usage-overview.md}}

### Usage Proof command propagation

The *Usage proof* is the command that outlines a product usage event.

![Diagram depicting the Usage Proof propagation process](./rating-bpm.svg)

```admonish example title="Vendor Use case"
**As a** vendor providing products *over IP* through a *Teleco provider*  
**I want to** collect all *Usage Proof* generated by the *Edge*
**so that I can** calculate charges of the products based on usage  
**and** have the ability to analyse the usage data  
```

#### Scenario: Rating Agent issues a Usage Proof

>**Given** the *Rating Agent* had received a valid usage request
>**And** generated a *Usage Proof*
>
>**When** querying the *Usage Collector* at the *Cloud* side for the last record
>
>**Then** it should respond with the correct *Usage Proof* generated by the *Edge*

### Legend

{{#include ../legend.md}}
